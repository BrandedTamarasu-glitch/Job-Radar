---
phase: 10-ux-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - job_radar/banner.py
  - job_radar/__main__.py
  - job_radar/search.py
autonomous: true

must_haves:
  truths:
    - "User sees boxed welcome banner with app name, version, and profile name on every run"
    - "User sees 'Run with --help for options' hint below banner"
    - "User pressing Ctrl+C during wizard or search exits gracefully with 'Interrupted' message, no traceback"
    - "User running --help sees wizard-first explanation, functionally grouped flags, and 2-3 usage examples"
  artifacts:
    - path: "job_radar/banner.py"
      provides: "Boxed welcome banner with profile_name parameter, enhanced error logging with traceback"
      contains: "display_banner"
    - path: "job_radar/__main__.py"
      provides: "Top-level KeyboardInterrupt handler wrapping all execution, profile name extraction for banner"
      contains: "KeyboardInterrupt"
    - path: "job_radar/search.py"
      provides: "Refactored parse_args with argument groups, description, epilog, and examples"
      contains: "add_argument_group"
  key_links:
    - from: "job_radar/__main__.py"
      to: "job_radar/banner.py"
      via: "display_banner(version, profile_name) call"
      pattern: "display_banner.*profile_name"
    - from: "job_radar/search.py"
      to: "argparse"
      via: "RawDescriptionHelpFormatter and add_argument_group()"
      pattern: "RawDescriptionHelpFormatter"
---

<objective>
Add welcome banner with version/profile name, refactor help text with argument groups and examples, and wrap all execution in graceful Ctrl+C handling.

Purpose: Gives non-technical users a friendly launch experience (UX-03), clear CLI guidance (UX-04), and clean exit behavior (UX-05).
Output: Updated banner.py, __main__.py, and search.py parse_args.
</objective>

<execution_context>
@/Users/coryebert/.claude/get-shit-done/workflows/execute-plan.md
@/Users/coryebert/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-ux-polish/10-CONTEXT.md
@.planning/phases/10-ux-polish/10-RESEARCH.md
@job_radar/banner.py
@job_radar/__main__.py
@job_radar/search.py
@job_radar/__init__.py
@job_radar/paths.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance banner.py with boxed welcome banner and improved error logging</name>
  <files>job_radar/banner.py</files>
  <action>
  Update `display_banner()` to accept a `profile_name: str | None = None` parameter. Change the banner style per CONTEXT.md decisions:

  **Boxed banner (primary — when pyfiglet available):**
  - Keep pyfiglet "slant" font for "Job Radar" text
  - After the pyfiglet art, print version line: `  Version {version}`
  - If profile_name provided, print: `  Searching for {profile_name}`
  - After the banner content, print: `  Run with --help for options`
  - Add a blank line after

  **Boxed banner (fallback — when pyfiglet unavailable):**
  - Use `=` characters for top and bottom borders (width 50)
  - Inside the box: `  Job Radar v{version}`
  - If profile_name: `  Searching for {profile_name}`
  - Bottom border with `=` characters
  - Then: `  Run with --help for options`
  - Add a blank line after

  **Enhance `log_error_and_exit()`:**
  - Import `traceback` module at top of file
  - When exception is provided, also write `traceback.format_exc()` to the error log file (not shown to user)
  - Keep the existing user-facing output (friendly message + log file path)

  **Add a new `log_error_to_file()` function** (non-exiting variant):
  - Same signature as `log_error_and_exit` but does NOT call `sys.exit()`
  - Logs to the same error log file with timestamp, message, and optional traceback
  - Returns None (fire-and-forget, used for non-fatal errors like individual source failures)
  - Wrap the file writing in try/except to fail silently if can't write

  Do NOT add colors or symbols to the banner. Plain text only per CONTEXT.md decision.
  </action>
  <verify>
  Run: `python -c "from job_radar.banner import display_banner, log_error_to_file; display_banner('1.1', 'Test User'); print('OK')"` and verify boxed banner appears with version, profile name, and help hint.
  Run: `python -c "from job_radar.banner import log_error_to_file; log_error_to_file('test error', ValueError('test')); print('OK')"` and verify it completes without exit.
  </verify>
  <done>
  - display_banner() shows boxed banner with version, profile name (when provided), and help hint on every call
  - log_error_and_exit() writes full traceback to error log file
  - log_error_to_file() logs errors without exiting the program
  - No colors or symbols in banner output
  </done>
</task>

<task type="auto">
  <name>Task 2: Wrap __main__.py with top-level Ctrl+C handling and pass profile name to banner</name>
  <files>job_radar/__main__.py</files>
  <action>
  Restructure `main()` in __main__.py to:

  1. **Move the KeyboardInterrupt handler to wrap EVERYTHING** — currently it only wraps the search call. Restructure so the try/except KeyboardInterrupt wraps the entire function body (banner, wizard, search). The handler should print `"\n\nInterrupted. Goodbye!"` and call `sys.exit(0)`. Exit code 0 because user-initiated interrupt is not an error.

  2. **Add top-level Exception handler** — wrap everything in try/except Exception that catches any unhandled exception, shows a friendly message, and logs details. Use `log_error_and_exit()` from banner.py. Add a last-resort fallback if even logging fails.

  3. **Extract profile name for banner** — after the wizard check but before calling search, attempt to read the profile name. The approach:
     - After the no-wizard pre-parse, try to load the profile path (from args or default location via `paths.get_data_dir()`)
     - If the profile file exists, read just the "name" field from it with json.load()
     - Pass the name to `display_banner(version=__version__, profile_name=name)`
     - If profile doesn't exist yet (first run), call `display_banner(version=__version__)` without profile_name
     - Wrap the profile name extraction in try/except — if anything goes wrong, just show banner without name

  4. **Keep the existing flow** — _fix_ssl_for_frozen() first, then banner, then wizard check, then search. The KeyboardInterrupt handler wraps everything after SSL fix.

  Structure should look like:
  ```python
  def main():
      _fix_ssl_for_frozen()
      try:
          # Extract profile name (best-effort)
          profile_name = _get_profile_name()

          # Display banner
          display_banner(version=__version__, profile_name=profile_name)

          # Wizard check (existing logic)
          ...

          # Search
          search_main()

      except KeyboardInterrupt:
          print("\n\nInterrupted. Goodbye!")
          sys.exit(0)
      except Exception as e:
          # Friendly error + log
          ...
  ```

  Create a helper `_get_profile_name()` that returns `str | None`:
  - Parse --profile and --no-wizard from sys.argv (reuse existing pre-parse logic)
  - Determine profile path: CLI --profile if provided, else default `get_data_dir() / "profile.json"`
  - If file exists, load JSON and return profile["name"]
  - Return None on any failure (file missing, JSON invalid, key missing)
  - This function must NEVER raise — wrap everything in try/except returning None
  </action>
  <verify>
  Run: `cd "/Users/coryebert/Documents/Job Hunt Python/Project Folder/Job-Radar" && python -m job_radar --no-wizard --dry-run --profile profiles/_template.json 2>&1 | head -20` and verify banner shows with profile name and no tracebacks.
  Test Ctrl+C: The handler is structural — verify by reading the code that KeyboardInterrupt wraps the entire flow.
  </verify>
  <done>
  - KeyboardInterrupt handler wraps entire main() body (wizard + search)
  - Ctrl+C prints friendly message and exits with code 0
  - Banner displays profile name when profile exists
  - Banner displays without profile name on first run (no profile yet)
  - Unhandled exceptions show friendly message and log details
  </done>
</task>

<task type="auto">
  <name>Task 3: Refactor parse_args with argument groups, wizard-first description, and examples</name>
  <files>job_radar/search.py</files>
  <action>
  Refactor the `parse_args()` function in search.py per CONTEXT.md help text decisions:

  1. **Import textwrap** at top of file (add to existing imports).

  2. **Update ArgumentParser constructor:**
     - Set `prog='job-radar'`
     - Set `formatter_class=argparse.RawDescriptionHelpFormatter`
     - Set `description` using `textwrap.dedent()` with wizard-first explanation:
       ```
       Job Radar - Search and score job listings against your profile

       FIRST TIME? Just run without any flags to launch the setup wizard.
       The wizard guides you through creating your profile and preferences.

       RETURNING? Run without flags to search with your saved profile.
       Or use the flags below to customize your search:
       ```
     - Set `epilog` using `textwrap.dedent()` with examples:
       ```
       Examples:
         job-radar                          Launch wizard (first run) or search
         job-radar --min-score 3.5          Search with higher quality threshold
         job-radar --profile path/to.json   Use a specific profile file

       Docs: https://github.com/coryebert/job-radar
       ```

  3. **Group arguments by function** (not alphabetical). Create these groups and move existing arguments into them:

     **Search Options** (`parser.add_argument_group('Search Options')`):
     - `--min-score` — keep existing, update help to: `'Minimum match score (1-5, default 2.8)'`
     - `--new-only` — keep existing BooleanOptionalAction, update help to: `'Only show new (unseen) results'`
     - `--from` — keep existing, update help to: `'Start date YYYY-MM-DD (default: 48 hours ago)'`
     - `--to` — keep existing, update help to: `'End date YYYY-MM-DD (default: today)'`

     **Output Options** (`parser.add_argument_group('Output Options')`):
     - `--output` — keep existing, update help to: `'Output directory for reports (default: results/)'`
     - `--no-open` — keep existing, update help to: `"Don't auto-open report in browser"`

     **Profile Options** (`parser.add_argument_group('Profile Options')`):
     - `--profile` — keep existing, update help to: `'Path to candidate profile JSON'`
     - `--config` — keep existing, update help to: `'Path to config file (default: auto-detect)'`
     - `--validate-profile` — keep existing, update help to: `'Validate a profile JSON and exit'`

     **Developer Options** (`parser.add_argument_group('Developer Options')`):
     - `--dry-run` — keep existing, update help to: `'Show search queries without fetching'`
     - `--verbose` / `-v` — keep existing, update help to: `'Enable debug logging'`
     - `--no-cache` — keep existing, update help to: `'Disable HTTP response caching'`
     - `--no-wizard` — keep existing, update help to: `'Skip setup wizard (for testing)'`

  4. **Keep --version on the main parser** (not in a group): `parser.add_argument('--version', action='version', version=f'job-radar {__version__}')`

  5. **Keep the config set_defaults logic unchanged** — `if config: parser.set_defaults(**config)` at the end.

  Do NOT change any argument names, types, defaults, or actions — only reorganize into groups and update help text to be one-line descriptions. Do NOT change the return value or calling convention.
  </action>
  <verify>
  Run: `cd "/Users/coryebert/Documents/Job Hunt Python/Project Folder/Job-Radar" && python -m job_radar --help` and verify:
  1. Wizard-first description appears at top
  2. Flags are grouped under "Search Options", "Output Options", "Profile Options", "Developer Options"
  3. Examples appear at bottom
  4. Each flag has a one-line description
  Run: `cd "/Users/coryebert/Documents/Job Hunt Python/Project Folder/Job-Radar" && python -m pytest tests/ -x -q` to ensure no test regressions.
  </verify>
  <done>
  - --help shows wizard-first description explaining interactive wizard and search flow
  - Flags grouped by function: Search Options, Output Options, Profile Options, Developer Options
  - 3 usage examples shown in epilog
  - All flag descriptions are one-line, brief but clear
  - All existing tests pass (no behavioral changes to argument parsing)
  </done>
</task>

</tasks>

<verification>
1. Run `python -m job_radar --help` and confirm grouped flags, wizard description, and examples
2. Run `python -m job_radar --no-wizard --dry-run --profile profiles/_template.json` and confirm boxed banner with version and profile name
3. Verify __main__.py code has KeyboardInterrupt wrapping entire main() body
4. Run `python -m pytest tests/ -x -q` and confirm all existing tests pass
</verification>

<success_criteria>
- Welcome banner shows app name, version, profile name (when available), and --help hint on every launch
- --help output explains wizard-first flow, groups flags by function, shows examples
- Ctrl+C from any point in the app exits with friendly message and code 0, no traceback
- All existing tests continue to pass
</success_criteria>

<output>
After completion, create `.planning/phases/10-ux-polish/10-01-SUMMARY.md`
</output>
