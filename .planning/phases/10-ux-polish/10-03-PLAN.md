---
phase: 10-ux-polish
plan: 03
type: execute
wave: 3
depends_on: ["10-01", "10-02"]
files_modified:
  - tests/test_ux.py
autonomous: true

must_haves:
  truths:
    - "Tests verify banner displays version, profile name, and help hint"
    - "Tests verify --help output contains argument groups and wizard explanation"
    - "Tests verify progress callback fires per source with correct counts"
    - "Tests verify friendly error messages are shown instead of tracebacks"
    - "Tests verify Ctrl+C handler catches KeyboardInterrupt"
  artifacts:
    - path: "tests/test_ux.py"
      provides: "Test suite covering all 5 UX requirements (progress, errors, banner, help, Ctrl+C)"
      min_lines: 100
  key_links:
    - from: "tests/test_ux.py"
      to: "job_radar/banner.py"
      via: "import and call display_banner, log_error_to_file"
      pattern: "from job_radar.banner import"
    - from: "tests/test_ux.py"
      to: "job_radar/search.py"
      via: "import parse_args and test help output"
      pattern: "from job_radar.search import"
    - from: "tests/test_ux.py"
      to: "job_radar/sources.py"
      via: "import fetch_all and test source progress"
      pattern: "from job_radar.sources import"
---

<objective>
Add comprehensive tests for all UX polish features: banner display, help text, progress indicators, error handling, and Ctrl+C handling.

Purpose: Verify all 5 UX requirements work correctly and prevent regressions.
Output: tests/test_ux.py with tests covering UX-01 through UX-05.
</objective>

<execution_context>
@/Users/coryebert/.claude/get-shit-done/workflows/execute-plan.md
@/Users/coryebert/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-ux-polish/10-CONTEXT.md
@.planning/phases/10-ux-polish/10-01-SUMMARY.md
@.planning/phases/10-ux-polish/10-02-SUMMARY.md
@job_radar/banner.py
@job_radar/__main__.py
@job_radar/search.py
@job_radar/sources.py
@tests/conftest.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write tests for banner, help text, and Ctrl+C handling (UX-03, UX-04, UX-05)</name>
  <files>tests/test_ux.py</files>
  <action>
  Create `tests/test_ux.py` with tests for the UX features implemented in Plans 01 and 02. Use pytest and capsys for output capture. Use unittest.mock for patching.

  **Banner tests (UX-03):**

  ```python
  class TestBanner:
      def test_banner_shows_version(self, capsys):
          """Banner displays version string."""
          from job_radar.banner import display_banner
          display_banner(version="1.1")
          output = capsys.readouterr().out
          assert "1.1" in output

      def test_banner_shows_profile_name(self, capsys):
          """Banner displays profile name when provided."""
          from job_radar.banner import display_banner
          display_banner(version="1.1", profile_name="Jane Doe")
          output = capsys.readouterr().out
          assert "Jane Doe" in output

      def test_banner_shows_help_hint(self, capsys):
          """Banner includes --help hint."""
          from job_radar.banner import display_banner
          display_banner(version="1.1")
          output = capsys.readouterr().out
          assert "--help" in output

      def test_banner_without_profile_name(self, capsys):
          """Banner works without profile name (first run)."""
          from job_radar.banner import display_banner
          display_banner(version="1.1")
          output = capsys.readouterr().out
          assert "1.1" in output
          # Should NOT contain "Searching for" when no name
          assert "Searching for" not in output

      def test_banner_fallback_without_pyfiglet(self, capsys):
          """Banner falls back to boxed text when pyfiglet unavailable."""
          from unittest.mock import patch
          from job_radar.banner import display_banner
          with patch.dict('sys.modules', {'pyfiglet': None}):
              # Force ImportError on pyfiglet import
              with patch('builtins.__import__', side_effect=lambda name, *args: (_ for _ in ()).throw(ImportError()) if name == 'pyfiglet' else __import__(name, *args)):
                  display_banner(version="1.1", profile_name="Test User")
          output = capsys.readouterr().out
          assert "1.1" in output
          assert "Test User" in output
          assert "=" in output  # Box border character
  ```

  **Help text tests (UX-04):**

  ```python
  class TestHelpText:
      def test_help_has_wizard_explanation(self, capsys):
          """--help explains the interactive wizard."""
          from job_radar.search import parse_args
          import sys
          from unittest.mock import patch
          with patch.object(sys, 'argv', ['job-radar', '--help']):
              try:
                  parse_args()
              except SystemExit:
                  pass
          output = capsys.readouterr().out
          assert "wizard" in output.lower()

      def test_help_has_argument_groups(self, capsys):
          """--help shows grouped flags."""
          from job_radar.search import parse_args
          import sys
          from unittest.mock import patch
          with patch.object(sys, 'argv', ['job-radar', '--help']):
              try:
                  parse_args()
              except SystemExit:
                  pass
          output = capsys.readouterr().out
          assert "Search Options" in output
          assert "Output Options" in output
          assert "Profile Options" in output

      def test_help_has_examples(self, capsys):
          """--help includes usage examples."""
          from job_radar.search import parse_args
          import sys
          from unittest.mock import patch
          with patch.object(sys, 'argv', ['job-radar', '--help']):
              try:
                  parse_args()
              except SystemExit:
                  pass
          output = capsys.readouterr().out
          assert "Examples" in output
          assert "--min-score" in output

      def test_help_one_line_descriptions(self, capsys):
          """Flag descriptions are brief (one line each)."""
          from job_radar.search import parse_args
          import sys
          from unittest.mock import patch
          with patch.object(sys, 'argv', ['job-radar', '--help']):
              try:
                  parse_args()
              except SystemExit:
                  pass
          output = capsys.readouterr().out
          # Check a few specific flags have brief help
          assert "Minimum match score" in output
          assert "Output directory" in output
  ```

  **Ctrl+C handling tests (UX-05):**

  ```python
  class TestCtrlCHandling:
      def test_keyboard_interrupt_exits_cleanly(self, capsys):
          """KeyboardInterrupt results in friendly message, not traceback."""
          from unittest.mock import patch, MagicMock
          from job_radar.__main__ import main
          # Mock search_main to raise KeyboardInterrupt
          with patch('job_radar.__main__._fix_ssl_for_frozen'):
              with patch('job_radar.search.main', side_effect=KeyboardInterrupt):
                  with pytest.raises(SystemExit) as exc_info:
                      main()
              assert exc_info.value.code == 0
          output = capsys.readouterr().out
          # Should have friendly message
          assert "interrupt" in output.lower() or "goodbye" in output.lower()

      def test_keyboard_interrupt_no_traceback(self, capsys):
          """Ctrl+C should never show a Python traceback."""
          from unittest.mock import patch
          from job_radar.__main__ import main
          with patch('job_radar.__main__._fix_ssl_for_frozen'):
              with patch('job_radar.search.main', side_effect=KeyboardInterrupt):
                  with pytest.raises(SystemExit):
                      main()
          output = capsys.readouterr().out + capsys.readouterr().err
          assert "Traceback" not in output
  ```

  **Error logging tests (UX-02 — banner.py functions):**

  ```python
  class TestErrorLogging:
      def test_log_error_to_file_does_not_exit(self, tmp_path):
          """log_error_to_file logs but does not call sys.exit."""
          from unittest.mock import patch
          from job_radar.banner import log_error_to_file
          log_file = tmp_path / "test-error.log"
          with patch('job_radar.banner.get_log_file', return_value=log_file):
              # Should NOT raise SystemExit
              log_error_to_file("test error message", ValueError("test"))
          assert log_file.exists()
          content = log_file.read_text()
          assert "test error message" in content

      def test_log_error_and_exit_exits_with_code_1(self, tmp_path):
          """log_error_and_exit exits with code 1."""
          from unittest.mock import patch
          from job_radar.banner import log_error_and_exit
          log_file = tmp_path / "test-error.log"
          with patch('job_radar.banner.get_log_file', return_value=log_file):
              with pytest.raises(SystemExit) as exc_info:
                  log_error_and_exit("fatal error")
          assert exc_info.value.code == 1

      def test_log_error_writes_traceback(self, tmp_path):
          """Error log includes traceback when exception is provided."""
          from unittest.mock import patch
          from job_radar.banner import log_error_to_file
          log_file = tmp_path / "test-error.log"
          try:
              raise ValueError("test exception for traceback")
          except ValueError as e:
              with patch('job_radar.banner.get_log_file', return_value=log_file):
                  log_error_to_file("error occurred", exception=e)
          content = log_file.read_text()
          assert "ValueError" in content
  ```

  Include proper imports at the top of the file:
  ```python
  """Tests for UX polish features (Phase 10).

  Covers: progress indicators (UX-01), friendly errors (UX-02),
  welcome banner (UX-03), help text (UX-04), Ctrl+C handling (UX-05).
  """
  import pytest
  import sys
  from unittest.mock import patch, MagicMock
  ```

  Adapt the test implementations based on the actual code from Plans 01 and 02. The exact assert strings should match what was actually implemented. Read the modified files before writing tests to ensure assertions match reality.
  </action>
  <verify>
  Run: `cd "/Users/coryebert/Documents/Job Hunt Python/Project Folder/Job-Radar" && python -m pytest tests/test_ux.py -v` to verify all new tests pass.
  Run: `cd "/Users/coryebert/Documents/Job Hunt Python/Project Folder/Job-Radar" && python -m pytest tests/ -x -q` to verify no regressions in existing tests.
  </verify>
  <done>
  - All banner tests pass (version, profile name, help hint, fallback)
  - All help text tests pass (wizard explanation, argument groups, examples)
  - All Ctrl+C tests pass (clean exit, no traceback)
  - All error logging tests pass (non-exiting log, exiting log, traceback in file)
  - All existing test suite tests still pass
  </done>
</task>

</tasks>

<verification>
1. Run `python -m pytest tests/test_ux.py -v` — all new UX tests pass
2. Run `python -m pytest tests/ -x -q` — full test suite passes (including existing tests)
3. Count test classes: at least 4 (banner, help, ctrl-c, error logging)
4. Count test functions: at least 12 covering all 5 UX requirements
</verification>

<success_criteria>
- tests/test_ux.py exists with tests covering all 5 UX requirements
- All tests in test_ux.py pass
- Full test suite (all test files) passes with no regressions
- Tests verify observable behaviors (output content), not implementation details
</success_criteria>

<output>
After completion, create `.planning/phases/10-ux-polish/10-03-SUMMARY.md`
</output>
