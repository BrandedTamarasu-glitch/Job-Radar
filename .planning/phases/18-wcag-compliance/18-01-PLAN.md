---
phase: 18-wcag-compliance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - job_radar/report.py
autonomous: true

must_haves:
  truths:
    - "Keyboard user can skip to main content with single Tab press"
    - "Screen reader announces semantic page structure with ARIA landmarks (header, main, footer)"
    - "Screen reader can navigate job listing table with proper header/cell associations via scope attributes"
    - "Score badges announce as 'Score 4.2 out of 5.0' (full context, not just '4.2/5.0')"
    - "NEW badges announce as 'New listing, not seen in previous searches' (contextual meaning)"
    - "All interactive elements show visible focus indicators for keyboard navigation"
    - "All text meets 4.5:1 contrast minimum (WCAG AA standard)"
    - "ARIA live region announces status changes and toast-equivalent messages to screen readers"
  artifacts:
    - path: "job_radar/report.py"
      provides: "WCAG 2.1 Level AA compliant HTML report generation"
      contains: "skip-link"
    - path: "job_radar/report.py"
      provides: "Semantic HTML structure with ARIA landmarks"
      contains: "role=\"banner\""
    - path: "job_radar/report.py"
      provides: "Accessible table with scope attributes"
      contains: "scope=\"col\""
    - path: "job_radar/report.py"
      provides: "Contextual screen reader text for badges"
      contains: "visually-hidden"
  key_links:
    - from: "job_radar/report.py (_generate_html_report)"
      to: "HTML output"
      via: "skip link as first focusable element in body"
      pattern: "skip-link.*#main-content"
    - from: "job_radar/report.py (_html_results_table)"
      to: "HTML table headers"
      via: "scope attributes on th elements"
      pattern: "scope=\"col\""
    - from: "job_radar/report.py (_html_recommended_section)"
      to: "screen reader announcements"
      via: "visually-hidden spans around score and NEW badge values"
      pattern: "visually-hidden"
    - from: "job_radar/report.py (_generate_html_report)"
      to: "ARIA live region"
      via: "status-announcer div with aria-live=polite"
      pattern: "status-announcer.*aria-live"
---

<objective>
Add WCAG 2.1 Level AA compliance to the HTML report generator covering semantic structure, skip navigation, ARIA landmarks, accessible tables, contextual screen reader text for badges, focus indicators for all interactive elements, ARIA live regions for dynamic content, and contrast-compliant colors.

Purpose: Makes HTML job reports accessible to keyboard-only users and screen reader users (A11Y-01 through A11Y-07, A11Y-10)
Output: Modified report.py generating fully accessible HTML reports
</objective>

<execution_context>
@/home/corye/.claude/get-shit-done/workflows/execute-plan.md
@/home/corye/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-wcag-compliance/18-RESEARCH.md
@.planning/phases/16-application-flow-essentials/16-01-SUMMARY.md
@.planning/phases/17-application-status-tracking/17-01-SUMMARY.md
@job_radar/report.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add semantic HTML structure, skip link, and ARIA landmarks</name>
  <files>job_radar/report.py</files>
  <action>
Modify `_generate_html_report()` to restructure the HTML template with WCAG 2.1 Level AA compliance. All changes are in the f-string template within this function.

**Skip Navigation Link (A11Y-01):**
- Add as FIRST element inside `<body>`: `<a href="#main-content" class="visually-hidden-focusable">Skip to main content</a>`
- Use Bootstrap's built-in `.visually-hidden-focusable` class (hidden until focused via Tab, then appears). Do NOT use custom `.skip-link` CSS -- Bootstrap handles this correctly.

**Semantic Structure with ARIA Landmarks (A11Y-02):**
- Wrap the `<h1>` and info alert in `<header role="banner">` with the container div inside it
- Wrap the main content sections (profile, recommended, results table, manual URLs) in `<main id="main-content" role="main">` with its own container div
- Add `<footer role="contentinfo">` at the bottom with "Generated by Job Radar" text and timestamp
- Each content section already uses cards/divs -- add `aria-labelledby` pointing to their heading IDs
- Add unique IDs to section headings: `id="profile-heading"`, `id="recommended-heading"`, `id="results-heading"`, `id="manual-heading"`
- Wrap profile section in `<section aria-labelledby="profile-heading">`
- Wrap recommended section in `<section aria-labelledby="recommended-heading">`
- Wrap results table section in `<section aria-labelledby="results-heading">`
- Wrap manual URLs section in `<section aria-labelledby="manual-heading">`

**ARIA Live Region for Dynamic Content:**
- Add empty ARIA live region as last element before closing `</main>` or `</body>`:
  ```html
  <div id="status-announcer" role="status" aria-live="polite" aria-atomic="true" class="visually-hidden"></div>
  ```
- In the status change JavaScript (Application status management script), after the notyf.success/error calls, also update `document.getElementById('status-announcer').textContent = message;` and clear after 1 second with setTimeout
- In the clipboard JavaScript, after notyf toast calls, also update the status-announcer with the same message text
- This ensures screen readers get announcements for ALL dynamic actions (clipboard copies, status changes)

**Contrast Fixes (A11Y-07):**
- Add CSS overrides in the `<style>` block for Bootstrap's default colors that fail 4.5:1:
  - `.text-muted` override: change from Bootstrap's default #6c757d (fails on white) to `#595959` (passes 4.5:1 on white background)
  - `.badge.bg-warning` text: ensure dark text with `color: #212529 !important;` (yellow background needs dark text)
  - `.badge.bg-secondary` text: verify white text passes on #6c757d background (it does at ~4.6:1)
  - `.shortcut-hint` color: use the same contrast-safe muted color `#595959`
  - `[data-bs-theme="dark"] .text-muted` override: use `#adb5bd` (passes 4.5:1 on dark backgrounds)
  - Link color `a` ensure default Bootstrap blue #0d6efd passes on white (it does at 4.6:1 -- keep default)
  - `.alert-info` text: ensure readable (Bootstrap default passes)

**Focus Indicators for ALL Interactive Elements (A11Y-06):**
- Expand the existing `.job-item:focus-visible` CSS rule (already present from Phase 16)
- Add focus-visible rules for EVERY interactive element type:
  ```css
  a:focus-visible {
    outline: 2px solid #0d6efd;
    outline-offset: 2px;
    text-decoration: underline;
  }
  .btn:focus-visible {
    outline: 2px solid currentColor;
    outline-offset: 2px;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }
  .dropdown-item:focus {
    outline: 2px solid #0d6efd;
    outline-offset: -2px;
  }
  .dropdown-toggle:focus-visible {
    outline: 2px solid #0d6efd;
    outline-offset: 2px;
  }
  ```
- Keep existing `.job-item:focus-visible` rule unchanged

**Important constraints:**
- Maintain ALL existing functionality (copy buttons, status dropdowns, keyboard shortcuts, Notyf toasts, dark mode)
- Keep inline CSS/JS pattern for single-file HTML portability
- Use `role` attributes alongside HTML5 semantic elements for maximum screen reader compatibility (older screen readers need explicit roles)
- Do NOT change the Markdown report generator at all
- Existing tests in test_report.py must still pass -- do not change element class names or data attributes
  </action>
  <verify>
Run: `python -c "from job_radar.report import generate_report; print('import OK')"`
Run: `cd /home/corye/Claude/Job-Radar && python -m pytest tests/test_report.py -v`
Grep generated HTML (via test output or manual generation) for:
- "visually-hidden-focusable" (skip link)
- 'role="banner"' (header landmark)
- 'role="main"' (main landmark)
- 'role="contentinfo"' (footer landmark)
- "status-announcer" (ARIA live region)
- "#595959" (contrast-safe muted color)
  </verify>
  <done>
HTML report contains skip navigation link as first focusable element, semantic header/main/footer with ARIA roles, section landmarks with aria-labelledby, ARIA live region for dynamic announcements, contrast-compliant color overrides, and focus-visible indicators on all interactive element types. All existing tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add accessible table structure and contextual screen reader text for badges</name>
  <files>job_radar/report.py</files>
  <action>
Modify `_html_results_table()` and `_html_recommended_section()` to add proper table accessibility and contextual screen reader text.

**Accessible Table Headers (A11Y-03):**
In `_html_results_table()`:
- Add `scope="col"` to ALL `<th>` elements in the thead:
  ```html
  <th scope="col">#</th>
  <th scope="col">Score</th>
  <th scope="col">New</th>
  <th scope="col">Status</th>
  ...
  ```
- Add `<th scope="row">` for the row number cell (first `<td>{i}</td>` becomes `<th scope="row">{i}</th>`)
- Add `<caption>` element describing the table purpose:
  ```html
  <caption class="visually-hidden">Job search results sorted by relevance score, highest first</caption>
  ```
- Add `aria-describedby` on the `<table>` element is NOT needed since we have `<caption>` (caption is preferred over aria-describedby for tables)

**Score Badge Screen Reader Text (A11Y-04):**
In `_html_results_table()` score badge cell:
- Change from: `<span class="badge {badge_class}">{score:.1f}/5.0</span>`
- Change to: `<span class="badge {badge_class}"><span class="visually-hidden">Score </span>{score:.1f}<span class="visually-hidden"> out of 5.0</span></span>`
- Screen reader will announce: "Score 4.2 out of 5.0" instead of "4.2/5.0"

In `_html_recommended_section()` score badge in card header:
- Change from: `<span class="badge {badge_class} score-badge">{score_val:.1f}/5.0</span>`
- Change to: `<span class="badge {badge_class} score-badge"><span class="visually-hidden">Score </span>{score_val:.1f}<span class="visually-hidden"> out of 5.0</span></span>`

**NEW Badge Screen Reader Text (A11Y-05):**
In `_html_results_table()` new badge cell:
- Change from: `'<span class="badge bg-primary rounded-pill">NEW</span>'`
- Change to: `'<span class="badge bg-primary rounded-pill"><span class="visually-hidden">New listing, not seen in previous searches. </span>NEW</span>'`
- The `.visually-hidden` text provides context; sighted users still see just "NEW"

In `_html_recommended_section()` new tag in card header:
- Change from: `' <span class="badge bg-primary">NEW</span>'`
- Change to: `' <span class="badge bg-primary"><span class="visually-hidden">New listing, not seen in previous searches. </span>NEW</span>'`

**Link Accessibility:**
In `_html_results_table()` for "View" links:
- Add aria-label describing the destination: `aria-label="View {job.title} at {job.company}, opens in new tab"`
- Add `rel="noopener"` to external links for security

In `_html_recommended_section()` for source links:
- Add aria-label: `aria-label="View on {job.source}, opens in new tab"`
- Add `rel="noopener"` to external links

**Status Dropdown Accessibility:**
- The status dropdowns already have `aria-label="Change application status"` (from Phase 17) -- keep this
- Add `role="listbox"` is NOT needed (Bootstrap dropdown handles this)
- Verify each dropdown-item has meaningful text (they do: "Applied", "Interviewing", etc.)

**Important:** When changing score badge content, the visual appearance must remain identical. The `.visually-hidden` content is invisible to sighted users but read by screen readers. Test by ensuring the raw HTML still shows "4.2" as visible text.
  </action>
  <verify>
Run: `cd /home/corye/Claude/Job-Radar && python -m pytest tests/test_report.py -v`
Generate a test report and verify with grep:
- `scope="col"` appears in table headers (should appear 11 times, one per column)
- `scope="row"` appears in table rows
- `<caption` appears in the table
- `visually-hidden` appears multiple times (score context, NEW context)
- "Score " and " out of 5.0" appear as visually-hidden spans
- "New listing, not seen in previous searches" appears
- `aria-label="View` appears on links
- `rel="noopener"` appears on external links
  </verify>
  <done>
Results table has scope attributes on all th elements, caption describing table purpose, row headers with scope="row". Score badges have "Score X out of 5.0" screen reader text. NEW badges have "New listing, not seen in previous searches" screen reader context. All external links have descriptive aria-labels and rel="noopener". All existing tests pass.
  </done>
</task>

</tasks>

<verification>
1. `python -c "from job_radar.report import generate_report"` succeeds (no import errors)
2. `python -m pytest tests/test_report.py -v` -- ALL existing tests pass
3. Generated HTML contains skip link (`visually-hidden-focusable`)
4. Generated HTML contains ARIA landmarks (`role="banner"`, `role="main"`, `role="contentinfo"`)
5. Generated HTML contains accessible table (`scope="col"`, `scope="row"`, `<caption>`)
6. Generated HTML contains screen reader text (`visually-hidden` spans for scores and NEW badges)
7. Generated HTML contains ARIA live region (`status-announcer`)
8. Generated HTML contains contrast-safe colors (`#595959`)
9. Generated HTML contains focus indicators for all interactive element types
</verification>

<success_criteria>
- All 10 A11Y requirements addressed in HTML report (A11Y-01 through A11Y-07 directly; A11Y-10 prepared for)
- All existing test_report.py tests pass without modification
- HTML report maintains identical visual appearance for sighted users
- Single-file HTML portability preserved (all CSS/JS inline)
- Screen readers receive full context for scores ("Score 4.2 out of 5.0") and NEW badges
- Keyboard users can skip to main content and see focus indicators on all interactive elements
</success_criteria>

<output>
After completion, create `.planning/phases/18-wcag-compliance/18-01-SUMMARY.md`
</output>
