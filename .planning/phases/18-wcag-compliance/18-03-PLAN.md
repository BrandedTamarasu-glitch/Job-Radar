---
phase: 18-wcag-compliance
plan: 03
type: execute
wave: 2
depends_on: ["18-01"]
files_modified:
  - tests/test_report.py
autonomous: false

must_haves:
  truths:
    - "Tests verify skip navigation link exists in HTML output"
    - "Tests verify ARIA landmarks (banner, main, contentinfo) exist"
    - "Tests verify table has scope attributes and caption"
    - "Tests verify score badges have 'out of 5.0' screen reader text"
    - "Tests verify NEW badges have contextual screen reader text"
    - "Tests verify ARIA live region exists for announcements"
    - "HTML report achieves Lighthouse accessibility score >=95 (human verified)"
  artifacts:
    - path: "tests/test_report.py"
      provides: "Accessibility test coverage for HTML reports"
      contains: "test_html_report_skip_link"
  key_links:
    - from: "tests/test_report.py"
      to: "job_radar/report.py"
      via: "generate_report() call then HTML content assertions"
      pattern: "generate_report.*html_content"
---

<objective>
Add automated tests for all HTML accessibility features implemented in Plan 01, plus a human verification checkpoint for Lighthouse scoring and screen reader testing.

Purpose: Ensures accessibility features don't regress in future changes and validates the target Lighthouse score (A11Y-10)
Output: New test functions in test_report.py, human-verified Lighthouse score
</objective>

<execution_context>
@/home/corye/.claude/get-shit-done/workflows/execute-plan.md
@/home/corye/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-wcag-compliance/18-01-SUMMARY.md
@job_radar/report.py
@tests/test_report.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add accessibility test cases to test_report.py</name>
  <files>tests/test_report.py</files>
  <action>
Add new test functions to `tests/test_report.py` that verify all WCAG 2.1 Level AA features from Plan 01. Use the existing `sample_profile`, `sample_scored_results`, and `sample_manual_urls` fixtures. Follow the established pattern: call `generate_report()`, read HTML content, assert string patterns.

**Add these test functions:**

1. `test_html_report_skip_navigation_link` -- Verify:
   - `visually-hidden-focusable` class exists in HTML
   - `#main-content` href target exists
   - Skip link appears before main content (check ordering in HTML string)

2. `test_html_report_aria_landmarks` -- Verify:
   - `role="banner"` exists (header landmark)
   - `role="main"` exists (main content landmark)
   - `role="contentinfo"` exists (footer landmark)
   - `id="main-content"` exists (skip link target)

3. `test_html_report_section_landmarks` -- Verify:
   - `aria-labelledby="profile-heading"` exists
   - `aria-labelledby="recommended-heading"` or similar exists
   - `aria-labelledby="results-heading"` or similar exists
   - `id="profile-heading"` exists
   - `<section` tag is used

4. `test_html_report_accessible_table_headers` -- Verify:
   - `scope="col"` appears in table header row (at least 5 occurrences for the columns)
   - `scope="row"` appears in table body (row number headers)
   - `<caption` element exists inside the table
   - Caption text describes table purpose

5. `test_html_report_score_badge_screen_reader_text` -- Verify:
   - Score badges contain "visually-hidden" spans
   - Text "Score " appears before the numeric value (within visually-hidden span)
   - Text " out of 5.0" appears after the numeric value (within visually-hidden span)
   - Both recommended section cards AND results table contain this pattern

6. `test_html_report_new_badge_screen_reader_text` -- Verify:
   - NEW badges contain "visually-hidden" span
   - Text "New listing, not seen in previous searches" appears
   - Both recommended section cards AND results table contain this pattern

7. `test_html_report_aria_live_region` -- Verify:
   - `id="status-announcer"` exists
   - `aria-live="polite"` exists
   - `aria-atomic="true"` exists
   - `role="status"` exists
   - Element has `visually-hidden` class

8. `test_html_report_focus_indicators_all_elements` -- Verify:
   - CSS contains `a:focus-visible` rule
   - CSS contains `.btn:focus-visible` rule
   - CSS contains `.dropdown-item:focus` rule
   - CSS contains `.dropdown-toggle:focus-visible` rule
   - Existing `.job-item:focus-visible` rule still present

9. `test_html_report_contrast_safe_colors` -- Verify:
   - CSS contains `#595959` (contrast-safe muted text color)
   - `.text-muted` override exists in the style block

10. `test_html_report_external_links_accessibility` -- Verify:
   - External links have `rel="noopener"` attribute
   - External links have `aria-label` attributes with descriptive text

Each test follows the same pattern as existing tests:
```python
def test_html_report_something(sample_profile, sample_scored_results, sample_manual_urls, tmp_path):
    result = generate_report(
        profile=sample_profile,
        scored_results=sample_scored_results,
        manual_urls=sample_manual_urls,
        sources_searched=["Dice"],
        from_date="2026-02-06",
        to_date="2026-02-09",
        output_dir=str(tmp_path),
    )
    html_content = Path(result["html"]).read_text()
    assert "expected_pattern" in html_content
```
  </action>
  <verify>
Run: `cd /home/corye/Claude/Job-Radar && python -m pytest tests/test_report.py -v`
All tests pass, including both existing tests and new accessibility tests.
Count new test functions: should be 10 new tests.
  </verify>
  <done>
10 new accessibility test functions added to test_report.py. All tests pass (existing + new). Tests cover: skip link, ARIA landmarks, section landmarks, table accessibility, score badge screen reader text, NEW badge screen reader text, ARIA live region, focus indicators, contrast-safe colors, and external link accessibility.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Lighthouse accessibility score and screen reader verification</name>
  <files>tests/test_report.py</files>
  <action>
Human verification checkpoint. Present the user with instructions to run Lighthouse accessibility audit and test keyboard navigation. No automated action needed -- all implementation was completed in Plans 01 and 02.
  </action>
  <verify>
User confirms Lighthouse accessibility score >= 95 and keyboard navigation works.
  </verify>
  <done>
User has verified: Lighthouse score >= 95, skip link works, focus indicators visible on all elements, contrast is readable, NO_COLOR disables terminal colors.
  </done>
  <what-built>
    Complete WCAG 2.1 Level AA accessibility compliance for HTML job reports including:
    - Skip navigation link (Tab to skip to main content)
    - Semantic HTML structure with ARIA landmarks
    - Accessible table with scope attributes and caption
    - Score badges with "Score X out of 5.0" screen reader context
    - NEW badges with "New listing, not seen in previous searches" context
    - Focus indicators on all interactive elements
    - Contrast-safe colors (4.5:1 minimum)
    - ARIA live region for dynamic content announcements
    - NO_COLOR support for terminal accessibility
    - --no-color CLI flag
  </what-built>
  <how-to-verify>
    **Step 1: Generate a test report**
    ```
    cd /home/corye/Claude/Job-Radar
    python -m job_radar --profile profiles/[your-profile].json --output /tmp/a11y-test
    ```
    (Or if no profile exists: create a minimal test profile first)

    **Step 2: Run Lighthouse accessibility audit**
    1. Open the generated HTML report in Chrome
    2. Open DevTools (F12)
    3. Go to Lighthouse tab
    4. Select ONLY "Accessibility" category
    5. Select "Desktop" device
    6. Click "Analyze page load"
    7. Target: Score >= 95

    **Step 3: Verify keyboard navigation**
    1. Press Tab once -- skip link should appear ("Skip to main content")
    2. Press Enter -- focus should jump to main content area
    3. Continue tabbing -- every button, link, and dropdown should show visible focus indicator
    4. Press Tab through entire page -- no focus should "disappear" on any element

    **Step 4: Verify contrast (visual check)**
    1. All text should be clearly readable
    2. No light gray text on white background
    3. Badge text should be readable (especially yellow "Offer" badge)

    **Step 5: Verify NO_COLOR**
    ```
    NO_COLOR=1 python -m job_radar --help
    ```
    Output should have no ANSI color codes (no colored text).

    **Expected results:**
    - Lighthouse score >= 95
    - Skip link works on first Tab press
    - All interactive elements show focus indicators
    - All text is clearly readable
    - NO_COLOR disables terminal colors
  </how-to-verify>
  <resume-signal>Type "approved" with Lighthouse score, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `python -m pytest tests/test_report.py -v` -- ALL tests pass (existing + 10 new)
2. Lighthouse accessibility score >= 95 (human verified)
3. Keyboard navigation works end-to-end (human verified)
4. NO_COLOR environment variable works (human verified)
</verification>

<success_criteria>
- 10 new accessibility tests pass in test_report.py
- All existing tests still pass (no regressions)
- Lighthouse accessibility score >= 95 confirmed by user
- Keyboard navigation verified by user
- Phase 18 complete -- v1.3.0 milestone achieved
</success_criteria>

<output>
After completion, create `.planning/phases/18-wcag-compliance/18-03-SUMMARY.md`
</output>
