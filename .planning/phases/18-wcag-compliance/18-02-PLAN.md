---
phase: 18-wcag-compliance
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - job_radar/search.py
autonomous: true

must_haves:
  truths:
    - "CLI output colors meet contrast requirements for colorblind users"
    - "NO_COLOR environment variable disables all terminal colors"
    - "Color information is always paired with text indicators (never color-only)"
    - "CLI wizard prompts are documented for screen reader compatibility"
  artifacts:
    - path: "job_radar/search.py"
      provides: "NO_COLOR support and colorblind-safe terminal output"
      contains: "NO_COLOR"
  key_links:
    - from: "job_radar/search.py (_colors_supported)"
      to: "_Colors class"
      via: "NO_COLOR environment variable check"
      pattern: "NO_COLOR"
    - from: "job_radar/search.py (_Colors)"
      to: "terminal output"
      via: "ANSI codes disabled when NO_COLOR set"
      pattern: "NO_COLOR.*_enabled"
---

<objective>
Add terminal accessibility to the CLI: NO_COLOR environment variable support, colorblind-safe color usage, and text indicators paired with colors so information is never conveyed by color alone.

Purpose: Makes CLI output accessible to colorblind users and users who need plain text output (A11Y-08, A11Y-09)
Output: Modified search.py with accessible terminal color handling
</objective>

<execution_context>
@/home/corye/.claude/get-shit-done/workflows/execute-plan.md
@/home/corye/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-wcag-compliance/18-RESEARCH.md
@job_radar/search.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add NO_COLOR support and colorblind-safe terminal output</name>
  <files>job_radar/search.py</files>
  <action>
Modify `_colors_supported()` and `_Colors` class and CLI output to support colorblind users and NO_COLOR standard.

**NO_COLOR Support (A11Y-09 + community standard):**
In `_colors_supported()` function, add check as the FIRST condition (before any other checks):
```python
def _colors_supported() -> bool:
    """Check if the terminal supports ANSI escape codes."""
    # Respect NO_COLOR standard (https://no-color.org/)
    if os.environ.get("NO_COLOR") is not None:
        return False
    if not sys.stdout.isatty():
        return False
    # ... rest of existing function
```

This single change disables ALL ANSI colors when NO_COLOR is set to any value (even empty string), per the no-color.org standard. The `_Colors` class already checks `_colors_supported()` to set all color codes to empty strings, so this propagates automatically.

**Add --no-color CLI flag (A11Y-09):**
In `parse_args()`, add to the Output Options group:
```python
output_group.add_argument(
    "--no-color",
    action="store_true",
    help="Disable colored output (also respects NO_COLOR env var)",
)
```

In `main()`, after `args = parse_args(config)`, add BEFORE any output:
```python
# Handle --no-color flag by setting NO_COLOR env var
if args.no_color:
    os.environ["NO_COLOR"] = "1"
    # Reinitialize color codes
    _Colors._enabled = False
    _Colors.RESET = ""
    _Colors.BOLD = ""
    _Colors.GREEN = ""
    _Colors.YELLOW = ""
    _Colors.RED = ""
    _Colors.CYAN = ""
    _Colors.DIM = ""
```

**Colorblind-Safe Color Usage (A11Y-09):**
Audit all terminal output in `main()` for color-only information:

1. **Score color in top results** (line ~703): Currently uses green/yellow/dim based on score. This is ALREADY paired with the numeric score `[4.2/5.0]`, so colorblind users can still read the score. No change needed -- color is decorative, not informational.

2. **New/Seen counts** (line ~625): `{C.GREEN}{new_count} new{C.RESET}, {C.DIM}{seen_count} previously seen{C.RESET}` -- the text labels "new" and "previously seen" already convey meaning. Color is decorative. No change needed.

3. **"[NEW]" tag on results** (line ~701): Already uses text "[NEW]" alongside green color. No change needed.

4. **Dealbreaker count** (line ~687): Uses `{C.RED}{dealbreaker_count}{C.RESET}` -- add text indicator: change to `{C.RED}{dealbreaker_count} filtered{C.RESET}` (the word "filtered" was already implicit from the label "Dealbreakers:").

5. **Error messages** (lines ~227-253 in load_profile): Use `{C.RED}Error:{C.RESET}` -- the word "Error" already provides text indicator. No change needed.

6. **Warning messages** (lines ~277-280): Use `{C.YELLOW}Warning:{C.RESET}` -- the word "Warning" already provides text indicator. No change needed.

7. **Step progress** (lines ~565-649): Use `{C.BOLD}Step N:{C.RESET}` -- bold is not color-dependent. No change needed.

**Conclusion on colorblind safety:** The existing CLI output already pairs colors with text labels in almost all cases. The only pattern to verify is that no output line relies SOLELY on color to convey information. After the audit, the existing patterns are already colorblind-safe. The main addition is NO_COLOR support to completely disable colors.

**Document screen reader compatibility for CLI wizard (A11Y-08):**
The questionary library has no documented screen reader support (per research). Rather than modifying the wizard (risky, low confidence), document the limitation.

In search.py `parse_args()`, update the description or epilog to mention accessibility:
```python
epilog = textwrap.dedent("""\
    Examples:
      job-radar                          Launch wizard (first run) or search
      job-radar --min-score 3.5          Search with higher quality threshold
      job-radar --profile path/to.json   Use a specific profile file
      job-radar --no-color               Disable colored output

    Accessibility:
      Set NO_COLOR=1 to disable all terminal colors.
      Use --profile to bypass the interactive wizard with screen readers.

    Docs: https://github.com/coryebert/job-radar
""")
```

This addresses A11Y-08 by documenting that `--profile` bypasses the interactive wizard (which has unknown screen reader support) and provides a fully accessible path for screen reader users.
  </action>
  <verify>
Run: `cd /home/corye/Claude/Job-Radar && python -c "from job_radar.search import parse_args; print('import OK')"`
Run: `cd /home/corye/Claude/Job-Radar && NO_COLOR=1 python -c "from job_radar.search import _Colors as C; assert C.GREEN == '', f'Expected empty, got: {repr(C.GREEN)}'; print('NO_COLOR works')"`
Run: `cd /home/corye/Claude/Job-Radar && python -m pytest tests/ -v -k "not test_wizard_" --timeout=10` (run all non-wizard tests to check for regressions)
Grep search.py for "NO_COLOR" to confirm the check exists.
Grep search.py for "--no-color" to confirm the CLI flag exists.
  </verify>
  <done>
NO_COLOR environment variable disables all ANSI color codes. --no-color CLI flag provides explicit opt-out. CLI epilog documents accessibility options including --profile bypass for screen reader users. All existing color usage already pairs color with text labels (colorblind-safe). No test regressions.
  </done>
</task>

</tasks>

<verification>
1. `NO_COLOR=1 python -c "from job_radar.search import _Colors; assert _Colors.GREEN == ''"` passes
2. `python -m pytest tests/ -v` passes (no regressions from CLI changes)
3. search.py contains NO_COLOR check in _colors_supported()
4. search.py contains --no-color CLI flag
5. search.py epilog contains accessibility documentation
</verification>

<success_criteria>
- NO_COLOR environment variable completely disables terminal colors
- --no-color CLI flag available as explicit alternative
- All CLI output pairs color with text labels (no color-only information)
- CLI help text documents accessibility options for screen reader users
- No test regressions
</success_criteria>

<output>
After completion, create `.planning/phases/18-wcag-compliance/18-02-SUMMARY.md`
</output>
