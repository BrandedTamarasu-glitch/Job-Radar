---
phase: 22-interactive-features
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [job_radar/report.py]
autonomous: true

must_haves:
  truths:
    - "User can filter jobs by status using checkbox controls (Hide Applied, Hide Rejected, Hide Interviewing, Hide Offer)"
    - "Clicking Show All clears all filters and shows every job"
    - "Filter state persists across browser sessions via localStorage"
    - "Screen readers announce filter count updates via ARIA live region"
    - "Filtered-out jobs are hidden from both visual display and accessibility tree"
  artifacts:
    - path: "job_radar/report.py"
      provides: "Filter UI HTML and JavaScript"
      contains: "job-radar-filter-state"
  key_links:
    - from: "filter checkbox change handler"
      to: "applyFilter function"
      via: "event listener on checkbox change"
      pattern: "addEventListener.*change.*handleFilterChange"
    - from: "applyFilter function"
      to: "localStorage job-radar-application-status"
      via: "reads status map to determine which jobs to hide"
      pattern: "job-radar-application-status"
    - from: "applyFilter function"
      to: "ARIA live region status-announcer"
      via: "announceFilterCount updates textContent"
      pattern: "announceFilterCount"
    - from: "DOMContentLoaded"
      to: "initializeFilters"
      via: "loads saved filter state and applies on page load"
      pattern: "initializeFilters"
---

<objective>
Add status filtering to the HTML report so users can hide jobs by application status (Applied, Rejected, Interviewing, Offer) with filter state persisted to localStorage and ARIA live region announcements for screen readers.

Purpose: Users who have tracked application statuses want to focus on jobs they haven't acted on yet. Filtering hides irrelevant jobs (e.g., already-applied, rejected) from both visual display and screen reader output.

Output: Updated report.py with filter UI controls (Bootstrap checkbox button group) and filter JavaScript (state management, display toggling, localStorage persistence, ARIA announcements).
</objective>

<execution_context>
@/home/corye/.claude/get-shit-done/workflows/execute-plan.md
@/home/corye/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-interactive-features/22-RESEARCH.md
@.planning/phases/17-application-status-tracking/17-01-SUMMARY.md
@job_radar/report.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add filter UI controls to HTML report template</name>
  <files>job_radar/report.py</files>
  <action>
Add a filter control bar in the HTML template of generate_report(), placed BEFORE the "All Results" table section (after the recommended cards section, before the `<h2>All Results</h2>` heading). The filter bar must contain:

1. A `<div>` wrapper with `class="mb-4 no-print"` and `role="region" aria-labelledby="filter-heading"` for landmark accessibility.

2. A heading: `<h3 id="filter-heading" class="h5">Filter by Status</h3>`

3. A flex container `<div class="d-flex align-items-center gap-2 flex-wrap">` containing:
   - A Bootstrap 5 button group with `role="group" aria-label="Status filter checkboxes"` containing four checkbox-button pairs:
     - `<input type="checkbox" class="btn-check" id="filter-applied" autocomplete="off">` + `<label class="btn btn-outline-secondary btn-sm" for="filter-applied">Hide Applied</label>`
     - Same pattern for `filter-rejected`, `filter-interviewing`, `filter-offer` with labels "Hide Rejected", "Hide Interviewing", "Hide Offer"
   - A "Show All" button: `<button class="btn btn-outline-primary btn-sm" id="clear-filters" aria-label="Clear all filters and show all jobs">Show All</button>`

4. A help text: `<p class="text-muted small mt-2 mb-0">Filter applies to jobs with status set. Unset jobs are always visible.</p>`

5. A visible filter count display: `<span id="filter-count" class="text-muted small ms-2" aria-hidden="true"></span>` inside the flex container, after the Show All button. This shows "Showing X of Y jobs" visually (screen readers get it from the ARIA live region instead).

IMPORTANT: Use Python f-string with double braces `{{` and `}}` for literal braces in the HTML template, matching the existing pattern in report.py. All HTML attribute values with user data must be html.escape()'d.
  </action>
  <verify>Run `python -c "from job_radar.report import generate_report"` to confirm no syntax errors. Then run `grep -c 'filter-applied' job_radar/report.py` to confirm filter UI elements exist.</verify>
  <done>Filter UI HTML with 4 checkbox-button pairs, Show All button, filter count display, and help text is present in the report template before the All Results table.</done>
</task>

<task type="auto">
  <name>Task 2: Add filter JavaScript with localStorage persistence and ARIA announcements</name>
  <files>job_radar/report.py</files>
  <action>
Add a new `<script>` block in report.py's HTML template AFTER the existing "Application status management" script block. This script implements status filtering with localStorage persistence. Use `var` and `function` declarations (NOT let/const/arrow functions) to match existing JS conventions in report.py. All braces must be doubled (`{{` / `}}`) for Python f-string escaping.

The script must contain these functions:

**Filter State Management:**
- `var filterState = {{ hideApplied: false, hideRejected: false, hideInterviewing: false, hideOffer: false }};` - Default state object.
- `loadFilterState()` - Read `localStorage.getItem('job-radar-filter-state')`, parse JSON, merge with defaults using `Object.assign` pattern. Wrap in try/catch. On error, use defaults and log warning.
- `saveFilterState()` - Write `JSON.stringify(filterState)` to `localStorage.setItem('job-radar-filter-state')`. Wrap in try/catch. On QuotaExceededError, show `notyf.error('Storage quota exceeded')`.

**Filter Application:**
- `applyFilter()` - Core filtering function:
  1. Query all elements with `[data-job-key]` attribute.
  2. Read the application status map from `localStorage.getItem('job-radar-application-status')` (existing key from Phase 17). Wrap in try/catch.
  3. For each job element: get its `data-job-key`, look up status in the status map, check if that status should be hidden based on `filterState`.
  4. If hidden: set `element.style.display = 'none'` and `element.setAttribute('aria-hidden', 'true')`.
  5. If visible: set `element.style.display = ''` and `element.removeAttribute('aria-hidden')`.
  6. Count visible jobs.
  7. Call `announceFilterCount(visibleCount, totalCount)`.
  8. Update the visible count display: `document.getElementById('filter-count').textContent = visibleCount === totalCount ? '' : 'Showing ' + visibleCount + ' of ' + totalCount + ' jobs'`.

**ARIA Announcements:**
- `announceFilterCount(visibleCount, totalCount)` - Update existing `#status-announcer` live region:
  1. If visibleCount === totalCount: message = "Showing all X jobs"
  2. Else: message = "Showing X of Y jobs"
  3. Set `announcer.textContent = message`
  4. Clear after 1000ms with `setTimeout` so repeated changes re-announce (screen readers ignore duplicate text).

**Event Handlers:**
- `handleFilterChange(event)` - On checkbox change:
  1. Get checkbox id, derive state key (e.g., `filter-applied` -> `hideApplied`).
  2. Set `filterState[stateKey] = checkbox.checked`.
  3. Call `saveFilterState()` then `applyFilter()`.
- `clearAllFilters()` - Reset all filterState booleans to false, save, update checkbox UI, apply filter, show `notyf.success('All filters cleared')` toast and announce to screen reader.

**Initialization:**
- `initializeFilters()` - Called on DOMContentLoaded:
  1. Call `loadFilterState()`.
  2. Set checkbox `.checked` states from loaded filterState.
  3. Attach `change` event listeners to all 4 filter checkboxes calling `handleFilterChange`.
  4. Attach `click` event listener to `#clear-filters` calling `clearAllFilters`.
  5. Call `applyFilter()` to apply persisted filter state on page load.

**Integration with existing status change handler:**
- Find the existing status change handler in the "Application status management" script (the function that handles dropdown status changes, around the `handleStatusChange` or dropdown click handler area). Add a call to `applyFilter()` at the end of the status change handler, so that when a user changes a job's status to one that's currently filtered, the job immediately hides. This is a SMALL edit to the existing script block - just add `if (typeof applyFilter === 'function') applyFilter();` after the status badge is rendered and localStorage is saved.

CRITICAL: The filter script must run AFTER the status management script (which defines `notyf`, `hydrateApplicationStatus`, etc.) since it references those globals. Place it as the last `<script>` block before `</body>`.
  </action>
  <verify>Run `python -c "from job_radar.report import generate_report"` to confirm no syntax errors. Then run `grep -c 'initializeFilters\|applyFilter\|loadFilterState\|saveFilterState\|job-radar-filter-state' job_radar/report.py` to confirm all filter functions exist (should be >= 5 matches).</verify>
  <done>Filter JavaScript is present with: loadFilterState/saveFilterState for localStorage persistence, applyFilter for display toggling with aria-hidden, announceFilterCount for ARIA live region updates, handleFilterChange/clearAllFilters for user interaction, initializeFilters for DOMContentLoaded setup, and integration with existing status change handler.</done>
</task>

</tasks>

<verification>
1. `python -c "from job_radar.report import generate_report"` succeeds (no import errors)
2. `python -m pytest tests/test_report.py -x -q` passes (existing tests still pass)
3. `grep 'filter-applied' job_radar/report.py` confirms filter UI exists
4. `grep 'job-radar-filter-state' job_radar/report.py` confirms localStorage key exists
5. `grep 'announceFilterCount' job_radar/report.py` confirms ARIA announcement function exists
6. `grep 'applyFilter' job_radar/report.py` confirms filter application function exists
</verification>

<success_criteria>
- Filter UI HTML with 4 status checkboxes, Show All button, and count display is rendered in report
- Filter JavaScript loads/saves state to localStorage under key 'job-radar-filter-state'
- Filtering hides jobs with display:none and aria-hidden="true"
- ARIA live region announces "Showing X of Y jobs" on filter change
- Changing a job's status re-applies filter immediately
- All existing tests continue to pass
</success_criteria>

<output>
After completion, create `.planning/phases/22-interactive-features/22-01-SUMMARY.md`
</output>
