---
phase: 23-print-ci-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - job_radar/report.py
  - tests/test_report.py
autonomous: true

must_haves:
  truths:
    - "Print view hides interactive elements (copy buttons, status dropdowns, filter controls, export button, keyboard hints)"
    - "Score tier colors preserve in print output via print-color-adjust CSS property"
    - "Print layout prevents job entries from splitting across pages with break-inside: avoid"
    - "Print stylesheet overrides Bootstrap's background-color stripping with higher specificity"
    - "Hero card shadows removed in print to avoid rendering artifacts"
  artifacts:
    - path: "job_radar/report.py"
      provides: "Expanded @media print block with ~30 lines of comprehensive print rules"
      contains: "print-color-adjust: exact"
    - path: "tests/test_report.py"
      provides: "4 test functions verifying print CSS patterns in generated HTML"
      contains: "def test_html_report_print"
  key_links:
    - from: "job_radar/report.py @media print block"
      to: "Interactive element classes (.copy-btn, .dropdown, #export-csv-btn, etc.)"
      via: "display: none !important selectors"
      pattern: "@media print.*display: none !important"
    - from: "job_radar/report.py @media print block"
      to: "Tier color classes (.tier-strong, .tier-rec, .tier-review, .tier-badge-*)"
      via: "print-color-adjust: exact !important"
      pattern: "print-color-adjust: exact !important"
---

<objective>
Expand the existing `@media print` CSS block in report.py from ~5 lines to ~30 lines with comprehensive print rules that hide interactive elements, preserve score tier colors, prevent page breaks inside job entries, and override Bootstrap's background stripping.

Purpose: Users printing the HTML report get a clean, readable output with score colors intact and no interactive chrome (buttons, dropdowns, filters) cluttering the page.
Output: Modified report.py with expanded print CSS + 4 new test functions in test_report.py
</objective>

<execution_context>
@/Users/coryebert/.claude/get-shit-done/workflows/execute-plan.md
@/Users/coryebert/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-print-&-ci-validation/23-RESEARCH.md
@job_radar/report.py (lines 416-422: existing @media print block)
@tests/test_report.py (existing test pattern with sample_profile, sample_scored_results fixtures)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expand @media print CSS block in report.py</name>
  <files>job_radar/report.py</files>
  <action>
Replace the existing @media print block (lines 416-422 in report.py) which currently contains:

```css
@media print {{
  .no-print {{ display: none !important; }}
  body {{ background: white !important; }}
  .card {{ border: 1px solid #ddd !important; }}
  .badge {{ border: 1px solid currentColor; }}
}}
```

With the expanded print stylesheet:

```css
@media print {{
  /* Hide all interactive/navigation chrome */
  .no-print,
  .copy-btn,
  .copy-all-btn,
  .dropdown,
  .shortcut-hint,
  .export-status-btn,
  .btn-check + label,
  .btn-check,
  #clear-filters,
  #export-csv-btn,
  #filter-heading,
  [role="region"][aria-labelledby="filter-heading"] {{
    display: none !important;
  }}

  /* Override Bootstrap background stripping - preserve tier score colors */
  .tier-strong,
  .tier-rec,
  .tier-review,
  .tier-badge-strong,
  .tier-badge-rec,
  .tier-badge-review,
  .badge {{
    print-color-adjust: exact !important;
    -webkit-print-color-adjust: exact !important;
  }}

  /* Prevent job entries from splitting across pages */
  .card,
  .hero-job,
  tr {{
    break-inside: avoid;
    page-break-inside: avoid;
  }}

  /* Clean up print layout */
  body {{ background: white !important; }}
  .card {{ border: 1px solid #ddd !important; box-shadow: none !important; }}
  .hero-job {{ box-shadow: none !important; }}
  .badge {{ border: 1px solid currentColor; }}
}}
```

Note: The double curly braces `{{` and `}}` are required because report.py uses Python f-string formatting, and curly braces must be escaped.

Key changes from the existing block:
1. Expanded hide selectors: adds .copy-btn, .copy-all-btn, .dropdown, .shortcut-hint, .export-status-btn, .btn-check, #clear-filters, #export-csv-btn, #filter-heading, and the filter region
2. NEW: print-color-adjust rules for all tier classes + badges (overrides Bootstrap stripping)
3. NEW: -webkit-print-color-adjust for Safari compatibility
4. NEW: break-inside: avoid + page-break-inside: avoid on .card, .hero-job, tr
5. ENHANCED: .card gets box-shadow: none; .hero-job gets box-shadow: none (removes shadow artifacts)
  </action>
  <verify>
Run: `python -c "from job_radar.report import generate_report; print('import OK')"` to confirm no syntax errors.
Then grep the file: `grep -c 'print-color-adjust' job_radar/report.py` should return >= 2 (both prefixed and unprefixed).
`grep -c 'break-inside: avoid' job_radar/report.py` should return >= 1.
`grep -c 'display: none !important' job_radar/report.py` should show the print hide rule.
  </verify>
  <done>
The @media print block in report.py contains: (1) comprehensive hide selectors for all interactive elements, (2) print-color-adjust: exact for all tier color classes, (3) -webkit-print-color-adjust for Safari, (4) break-inside: avoid and page-break-inside: avoid for cards/rows, (5) box-shadow: none on cards and hero-job elements.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add print CSS tests to test_report.py</name>
  <files>tests/test_report.py</files>
  <action>
Add 4 new test functions at the end of test_report.py, following the existing pattern (use sample_profile, sample_scored_results, sample_manual_urls fixtures + tmp_path; call generate_report; read the HTML file; assert string patterns).

Test functions to add:

1. `test_html_report_print_hides_interactive_elements` - Verify the print media query hides copy buttons, dropdowns, filter controls:
   - Assert `.copy-btn` appears in the CSS (as a selector in @media print)
   - Assert `.dropdown` appears in the CSS
   - Assert `#export-csv-btn` appears in the CSS
   - Assert `#clear-filters` appears in the CSS
   - Assert `.shortcut-hint` appears in the CSS

2. `test_html_report_print_color_adjust` - Verify print-color-adjust preserves tier colors:
   - Assert `print-color-adjust: exact` appears in the HTML
   - Assert `-webkit-print-color-adjust: exact` appears in the HTML
   - Assert `.tier-strong` appears (tier class referenced in print rules)

3. `test_html_report_print_page_break_control` - Verify page break prevention:
   - Assert `break-inside: avoid` appears in the HTML
   - Assert `page-break-inside: avoid` appears in the HTML

4. `test_html_report_print_shadow_removal` - Verify shadows removed in print:
   - Assert `box-shadow: none` appears in the HTML

Each test follows the exact pattern used by test_html_report_export_csv_button and other recent tests: generate report -> read HTML -> assert string patterns.
  </action>
  <verify>
Run: `pytest tests/test_report.py::test_html_report_print_hides_interactive_elements tests/test_report.py::test_html_report_print_color_adjust tests/test_report.py::test_html_report_print_page_break_control tests/test_report.py::test_html_report_print_shadow_removal -v`
All 4 tests must pass.
  </verify>
  <done>
4 new test functions exist in test_report.py that verify: (1) print CSS hides interactive elements, (2) print-color-adjust preserves tier colors, (3) break-inside prevents page splits, (4) box-shadow removed in print. All pass with pytest.
  </done>
</task>

</tasks>

<verification>
1. `python -c "from job_radar.report import generate_report; print('OK')"` - No import errors
2. `pytest tests/test_report.py -k "print" -v` - All 4 print tests pass
3. `pytest tests/test_report.py -v` - Full test suite still passes (no regressions)
4. `grep -c 'print-color-adjust' job_radar/report.py` returns >= 2
5. `grep -c 'break-inside: avoid' job_radar/report.py` returns >= 1
</verification>

<success_criteria>
- The @media print block in report.py is expanded from ~5 lines to ~30 lines
- Interactive elements (copy buttons, dropdowns, filter controls, export button) hidden in print
- Score tier colors preserved via print-color-adjust: exact (both prefixed and unprefixed)
- Page break control prevents splitting job entries across pages
- Bootstrap background stripping overridden with !important
- Hero card shadows removed for clean print output
- 4 new tests pass verifying print CSS patterns
- Full existing test suite still passes
</success_criteria>

<output>
After completion, create `.planning/phases/23-print-&-ci-validation/23-01-SUMMARY.md`
</output>
