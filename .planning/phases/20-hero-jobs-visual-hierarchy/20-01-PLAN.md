---
phase: 20-hero-jobs-visual-hierarchy
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - job_radar/report.py
  - tests/test_report.py
autonomous: true

must_haves:
  truths:
    - "Jobs with score >=4.0 display with elevated card styling (multi-layer shadows, increased padding) visually distinct from 3.5-3.9 cards"
    - "Hero jobs show score badge with 'Top Match' label text alongside numeric score"
    - "Hero job section appears at top of report (before recommended and all-results sections) with its own heading and visual separation"
    - "Focus indicators on hero job cards remain visible with enhanced outline that clears shadow layers"
    - "Dark mode renders hero shadows and badge labels correctly with adapted opacity"
  artifacts:
    - path: "job_radar/report.py"
      provides: "Hero CSS variables, hero-job class, badge-label class, section-divider, focus enhancement, _html_hero_section function, hero/recommended split logic"
      contains: "hero-job"
    - path: "tests/test_report.py"
      provides: "Tests for hero section separation, hero CSS classes, badge labels, section divider, focus indicators"
      contains: "test_html_report_hero"
  key_links:
    - from: "job_radar/report.py (_generate_html_report)"
      to: "_html_hero_section"
      via: "hero list filtered from scored_results where score >= 4.0"
      pattern: "hero.*=.*score.*4\\.0"
    - from: "job_radar/report.py (_html_hero_section)"
      to: "hero-job CSS class"
      via: "class attribute on hero card divs"
      pattern: "hero-job"
    - from: "job_radar/report.py (CSS block)"
      to: "--shadow-hero custom property"
      via: "box-shadow on .hero-job class"
      pattern: "--shadow-hero"
    - from: "job_radar/report.py (_html_hero_section)"
      to: "badge-label span"
      via: "Top Match text in score badge for hero jobs"
      pattern: "badge-label.*Top Match"
---

<objective>
Implement hero job visual hierarchy: elevated card styling with multi-layer shadows, prominent "Top Match" badge labels, a dedicated hero section at the top of the report separated from lower-tier listings, and enhanced focus indicators for accessibility.

Purpose: Users scanning the report should immediately identify their best-matching jobs (score >=4.0) through visual prominence -- shadows that create depth perception, extra padding for breathing room, a "Top Match" label on the score badge, and clear section separation from recommended (3.5-3.9) jobs below.

Output: Updated report.py with hero CSS, hero section Python logic, and tests validating all hero visual elements.
</objective>

<execution_context>
@/home/corye/.claude/get-shit-done/workflows/execute-plan.md
@/home/corye/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-typography-color-foundation/19-01-SUMMARY.md
@.planning/phases/19-typography-color-foundation/19-02-SUMMARY.md
@.planning/phases/20-hero-jobs-visual-hierarchy/20-RESEARCH.md
@job_radar/report.py
@tests/test_report.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add hero CSS and split hero section from recommended in report layout</name>
  <files>job_radar/report.py</files>
  <action>
This task adds hero-specific CSS custom properties and classes to the existing `<style>` block, creates a new `_html_hero_section()` function, and rewires the report layout to show hero jobs separately above recommended jobs.

**CSS additions (in the `<style>` block, after existing tier card styles):**

1. Hero shadow custom property in `:root`:
```css
--shadow-hero:
  0 1px 3px rgba(0, 0, 0, 0.12),
  0 4px 8px rgba(0, 0, 0, 0.08),
  0 8px 16px rgba(0, 0, 0, 0.05);
```

2. Dark mode override for hero shadow (in existing `@media (prefers-color-scheme: dark)` block):
```css
--shadow-hero:
  0 1px 3px rgba(0, 0, 0, 0.3),
  0 4px 8px rgba(0, 0, 0, 0.2),
  0 8px 16px rgba(0, 0, 0, 0.15);
```

3. `.hero-job` class (applies to tier-strong cards in hero section):
```css
.hero-job {
  box-shadow: var(--shadow-hero);
  margin-bottom: 1.5rem;
}
.hero-job .card-body {
  padding: 1.5rem;
}
```

4. `.badge-label` class for "Top Match" text inside score badges:
```css
.badge-label {
  margin-left: 0.5em;
  font-size: 0.85em;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.025em;
}
```

5. `.section-divider` for visual break between hero and recommended sections:
```css
.section-divider {
  height: 1px;
  background: linear-gradient(to right, transparent, #dee2e6 20%, #dee2e6 80%, transparent);
  margin: 3rem 0;
}
```
With dark mode override:
```css
.section-divider {
  background: linear-gradient(to right, transparent, #495057 20%, #495057 80%, transparent);
}
```

6. Enhanced focus indicator for hero cards (clears shadow layers):
```css
.hero-job:focus-visible {
  outline: 3px solid var(--color-tier-strong-border);
  outline-offset: 3px;
}
```

7. Responsive badge label sizing for mobile:
```css
@media (max-width: 576px) {
  .badge-label {
    font-size: 0.7em;
  }
}
```

**Python changes:**

1. In `_generate_html_report()`, split `recommended` into two lists:
   - `hero_jobs = [r for r in scored_results if r["score"]["overall"] >= 4.0]`
   - `recommended = [r for r in scored_results if 3.5 <= r["score"]["overall"] < 4.0]`
   (The existing `recommended` line filters >=3.5; change it to only capture 3.5-3.9)

2. Update the report summary stats line: change `Above threshold (3.5+)` to show both counts, e.g. `Top matches (4.0+): {len(hero_jobs)} | Recommended (3.5+): {len(recommended)}`

3. Update the main content layout in the HTML template to insert the hero section first:
```python
{_html_hero_section(hero_jobs, profile)}
{_html_recommended_section(recommended, profile)}
```
   The hero section appears BEFORE the recommended section. If hero_jobs is non-empty AND recommended is non-empty, insert a `<div class="section-divider" role="separator" aria-hidden="true"></div>` between them.

4. Create `_html_hero_section(hero_jobs: list[dict], profile: dict) -> str`:
   - If `hero_jobs` is empty, return empty string (no section rendered at all -- no empty state needed since recommended section handles that)
   - Structure nearly identical to `_html_recommended_section` but with these differences:
     a. Section heading: `<h2 id="hero-heading" class="h4 mb-3">Top Matches (Score >= 4.0)</h2>` with `aria-labelledby="hero-heading"`
     b. A brief description: `<p class="text-muted mb-4">These jobs are excellent matches for your profile.</p>`
     c. Each card div gets additional class `hero-job` (so `class="card mb-3 job-item hero-job tier-strong"` -- note all hero jobs are tier-strong by definition since score >= 4.0)
     d. Score badge includes a `<span class="badge-label">Top Match</span>` after the score number and visually-hidden text, e.g.:
        `<span class="badge rounded-pill score-badge tier-badge-strong"><span class="visually-hidden">Score </span>4.2<span class="visually-hidden"> out of 5.0, </span><span class="badge-label">Top Match</span></span>`
     e. Copy All button text says "Copy All Top Match URLs" and calls `copyAllHeroUrls(this)` (same pattern as copyAllRecommendedUrls but for hero section)
     f. Numbering starts at 1 for hero cards (independent of recommended section numbering)

5. Update `_html_recommended_section` heading to clarify scope: change `Recommended Roles (Score >= 3.5)` to `Recommended Roles (Score 3.5 - 3.9)`. Update the empty state text similarly. This section no longer contains hero jobs.

6. In the clipboard JavaScript section, add a `copyAllHeroUrls(btn)` function following the same pattern as `copyAllRecommendedUrls` but selecting URLs from the `.hero-jobs-section .job-item` cards.

**Important constraints:**
- Do NOT change the existing `_score_tier()` function -- hero jobs are always tier "strong" already
- Do NOT modify the `_html_results_table()` function -- the all-results table still shows every job including hero-tier ones
- Keep the existing card structure/data attributes pattern (data-job-url, data-score, data-job-key, etc.) for hero cards
- Use `{{` and `}}` for CSS braces inside f-strings (existing pattern in report.py)
- The `hero-job` class is IN ADDITION TO the existing `tier-strong` class, not a replacement
  </action>
  <verify>
Run `python -m pytest tests/test_report.py -x -q` to confirm no existing tests break. Then visually inspect by running: `python -c "from job_radar.report import _score_tier; assert _score_tier(4.2) == 'strong'"` to confirm tier logic unchanged. Grep report.py for `hero-job` class, `--shadow-hero`, `badge-label`, `section-divider`, `_html_hero_section`, and `copyAllHeroUrls` to confirm all elements present.
  </verify>
  <done>
Hero CSS (shadow, padding, badge-label, divider, focus) added to style block. `_html_hero_section()` function renders hero cards with elevated styling and "Top Match" badges. Report layout shows hero section before recommended section with divider between. Recommended section heading updated to "3.5 - 3.9" scope. All existing tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add tests for hero visual hierarchy elements</name>
  <files>tests/test_report.py</files>
  <action>
Add tests validating all hero visual hierarchy elements. Follow the existing test patterns in the file (use `sample_profile`, `sample_scored_results`, `sample_manual_urls` fixtures, generate HTML report via `generate_report()`, read the HTML file content).

**Important:** The `sample_scored_results` fixture must include at least one job with score >= 4.0 for hero tests to work. Check the existing fixture -- if it only has scores below 4.0, update it to include at least one result with `"overall": 4.2` so hero section renders. Also ensure at least one result with score 3.5-3.9 so both sections render.

**Tests to add:**

1. `test_html_report_hero_section_exists` -- Verify that when a job has score >= 4.0, the HTML contains `id="hero-heading"` and the text "Top Matches (Score >= 4.0)". Also verify `aria-labelledby="hero-heading"` is present on the section.

2. `test_html_report_hero_card_elevated_styling` -- Verify hero job cards have the `hero-job` CSS class. Check that the HTML output contains a div with both `hero-job` and `tier-strong` classes for the high-scoring job.

3. `test_html_report_hero_shadow_css` -- Verify the CSS `<style>` block contains `--shadow-hero` custom property and `.hero-job` rule with `box-shadow: var(--shadow-hero)`.

4. `test_html_report_hero_badge_label` -- Verify hero job score badges contain `<span class="badge-label">Top Match</span>`. Confirm the badge-label CSS class is defined in the style block.

5. `test_html_report_hero_section_before_recommended` -- Verify the hero section (`id="hero-heading"`) appears BEFORE the recommended section (`id="recommended-heading"`) in the HTML by checking that `html_content.index("hero-heading") < html_content.index("recommended-heading")`.

6. `test_html_report_section_divider` -- Verify a `<div class="section-divider" role="separator" aria-hidden="true">` exists between hero and recommended sections when both have content.

7. `test_html_report_hero_focus_indicator_css` -- Verify the CSS contains `.hero-job:focus-visible` rule with `outline` and `outline-offset` properties.

8. `test_html_report_recommended_heading_updated` -- Verify the recommended section heading now says "Score 3.5 - 3.9" (not "Score >= 3.5") to reflect the scope change.

9. `test_html_report_no_hero_section_when_no_high_scores` -- Create a test with all scores below 4.0 and verify `hero-heading` does NOT appear in the HTML. The recommended section should still render.

10. `test_html_report_hero_dark_mode_shadow` -- Verify the dark mode media query contains an override for `--shadow-hero` with higher opacity values.

**Pattern to follow for each test:**
```python
def test_html_report_hero_xxx(sample_profile, sample_scored_results, sample_manual_urls, tmp_path):
    result = generate_report(
        profile=sample_profile,
        scored_results=sample_scored_results,
        manual_urls=sample_manual_urls,
        sources_searched=["TestSource"],
        from_date="2024-01-01",
        to_date="2024-01-31",
        output_dir=str(tmp_path),
    )
    html_content = Path(result["html"]).read_text()
    # assertions...
```

For the "no hero section" test, create a local scored_results list with all scores below 4.0.
  </action>
  <verify>
Run `python -m pytest tests/test_report.py -x -q` -- all tests pass including the 10 new hero tests. Run `python -m pytest tests/test_report.py -k hero -v` to see all hero-specific tests listed and passing.
  </verify>
  <done>
10 new tests validate: hero section existence, elevated card styling, shadow CSS, badge labels, section ordering, divider, focus indicators, updated recommended heading, no-hero fallback, and dark mode shadow adaptation. All tests pass alongside existing test suite.
  </done>
</task>

</tasks>

<verification>
1. `python -m pytest tests/ -x -q` -- all tests pass (existing + new hero tests)
2. `grep -c "hero-job" job_radar/report.py` returns >= 3 (CSS class def + card usage + focus rule)
3. `grep -c "badge-label" job_radar/report.py` returns >= 2 (CSS class def + badge HTML usage)
4. `grep -c "section-divider" job_radar/report.py` returns >= 2 (CSS class def + HTML usage)
5. `grep -c "--shadow-hero" job_radar/report.py` returns >= 3 (root def + dark mode def + usage)
6. `grep -c "Top Match" job_radar/report.py` returns >= 1 (badge label text)
7. `grep -c "_html_hero_section" job_radar/report.py` returns >= 2 (function def + call site)
8. `grep -c "test_html_report_hero" tests/test_report.py` returns >= 10 (all hero tests)
</verification>

<success_criteria>
- Hero jobs (>=4.0) render in a separate section at the top of the report with "Top Matches" heading
- Hero cards have multi-layer box shadows creating visual depth/elevation
- Hero cards have increased padding (1.5rem vs standard)
- Score badges on hero cards display "Top Match" label alongside numeric score
- Section divider separates hero section from recommended section when both exist
- Recommended section heading updated to "Score 3.5 - 3.9"
- Focus indicators on hero cards enhanced with 3px outline and 3px offset
- Dark mode adapts shadow opacity for visibility
- All existing tests continue to pass
- 10 new hero-specific tests all pass
</success_criteria>

<output>
After completion, create `.planning/phases/20-hero-jobs-visual-hierarchy/20-01-SUMMARY.md`
</output>
