---
phase: 09-report-enhancement
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - job_radar/search.py
  - job_radar/config.py
autonomous: true

must_haves:
  truths:
    - "Search completes and displays HTML path, Markdown path, stats, and browser status"
    - "--no-open flag prevents browser from opening"
    - "auto_open_browser config key controls default browser opening behavior"
    - "Browser opens automatically when jobs found (unless disabled)"
    - "Zero results skip browser opening (per CONTEXT decision)"
    - "Report generation failure exits with non-zero code"
  artifacts:
    - path: "job_radar/search.py"
      provides: "Browser opening integration and report summary messaging"
      contains: "open_report_in_browser"
    - path: "job_radar/config.py"
      provides: "auto_open_browser recognized config key"
      contains: "auto_open_browser"
  key_links:
    - from: "job_radar/search.py"
      to: "job_radar/report.py"
      via: "generate_report() now returns dict instead of string"
      pattern: 'report_result\[.html.\]'
    - from: "job_radar/search.py"
      to: "job_radar/browser.py"
      via: "open_report_in_browser() called after report generation"
      pattern: "open_report_in_browser"
    - from: "job_radar/config.py"
      to: "job_radar/search.py"
      via: "auto_open_browser config key read in search.py"
      pattern: "auto_open_browser"
---

<objective>
Wire HTML report generation and browser opening into the search pipeline with CLI controls and user messaging.

Purpose: Connect the report generation (Plan 01) and browser utility (Plan 01) into the user-facing search flow, adding CLI flags and config options for user control.
Output: Modified search.py with browser integration and friendly post-report messaging. Modified config.py with new recognized key.
</objective>

<execution_context>
@/Users/coryebert/.claude/get-shit-done/workflows/execute-plan.md
@/Users/coryebert/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-report-enhancement/09-CONTEXT.md
@.planning/phases/09-report-enhancement/09-01-SUMMARY.md
@job_radar/search.py
@job_radar/config.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add auto_open_browser to config.py and --no-open flag to search.py</name>
  <files>job_radar/config.py, job_radar/search.py</files>
  <action>
**config.py changes:**

1. Add `"auto_open_browser"` to `KNOWN_KEYS` set. This allows users to set `"auto_open_browser": false` in config.json to permanently disable auto-open.

**search.py changes:**

1. **Replace `--open` flag with `--no-open` flag**:
   - Remove the existing `--open` argument from `parse_args()`
   - Add `--no-open` with `action="store_true"`, help text: "Don't auto-open report in browser"
   - Default behavior is now AUTO-OPEN (the opposite of current). This is the UX the CONTEXT decision specifies.

2. **Import browser module** at top of search.py:
   - Add `from .browser import open_report_in_browser` to the imports section

3. **Update generate_report() call** in `main()` to handle new dict return type:
   - Change `report_path = generate_report(...)` to `report_result = generate_report(...)`
   - Extract paths: `html_path = report_result["html"]`, `md_path = report_result["markdown"]`
   - Extract stats: `report_stats = report_result["stats"]`

4. **Replace the existing summary section** (the block after `# Summary` comment) with enhanced messaging:
   - Print the separator and "SEARCH COMPLETE" header (keep existing style)
   - Print total results, new this run, recommended (3.5+), strong (4.0+) — using report_stats
   - Print dealbreaker count if any
   - Print HTML file path: `Report (HTML):     {html_path}`
   - Print Markdown file path: `Report (Markdown): {md_path}`
   - Print report statistics: `"X jobs found, Y high matches"` format
   - Print top results list (keep existing top 5 display)
   - Print manual URLs count

5. **Add browser opening logic** after the summary:
   - Determine `auto_open` boolean: True unless `args.no_open` is True or config has `auto_open_browser: false`
   - Read config value: `config.get("auto_open_browser", True)` — default True
   - If scored_results is empty (zero jobs), skip browser opening and print "No results to display — skipping browser"
   - Otherwise, call `open_report_in_browser(html_path, auto_open=auto_open)`
   - Based on result dict:
     - If `opened` is True: print `"Report opened in default browser"`
     - If `opened` is False: print `"Browser: {reason}. Open manually: {html_path}"`

6. **Remove the old `_open_file()` function** — it's replaced by browser.py. Also remove the old `if args.open:` block.

7. **Handle report generation errors**: Wrap the `generate_report()` call in try/except. On exception, print error and `sys.exit(1)` (per CONTEXT: report generation failures are critical).

IMPORTANT: Keep the `auto_open_browser` config value accessible in main(). The config dict is already loaded — just pass it through or read from args (since config values get merged via set_defaults).
  </action>
  <verify>
Run: `python -c "from job_radar.search import parse_args, main; print('OK')"`
Run: `python -c "from job_radar.config import KNOWN_KEYS; assert 'auto_open_browser' in KNOWN_KEYS; print('KNOWN_KEYS:', KNOWN_KEYS)"`
  </verify>
  <done>
search.py uses --no-open flag (default is auto-open), calls browser.py for opening, displays both file paths and stats. config.py recognizes auto_open_browser key. Old _open_file() and --open flag removed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire config auto_open_browser into search.py argument resolution</name>
  <files>job_radar/search.py</files>
  <action>
Ensure the `auto_open_browser` config value integrates cleanly with the CLI flag:

1. In `parse_args()`, the `--no-open` flag should NOT be set via config defaults (it's a negative flag). Instead, handle it in `main()`:
   - After parsing args, compute `auto_open`: `auto_open = not args.no_open and config.get("auto_open_browser", True)`
   - This means: CLI `--no-open` always wins (overrides config), config `auto_open_browser: false` disables by default, default is True (open browser)

2. The `config` dict is already available in `main()` from `load_config()`. Use it directly.

3. Pass the computed `auto_open` to the browser opening call:
   ```python
   browser_result = open_report_in_browser(html_path, auto_open=auto_open)
   ```

4. Make sure `auto_open_browser` does NOT appear in `parse_args()` set_defaults — it's not an argparse argument. It only affects the browser opening logic. If the config contains `auto_open_browser`, it will be in the raw config dict but won't be consumed by argparse (which is correct).

NOTE: The config currently uses `parser.set_defaults(**config)` which would set `auto_open_browser` as an arg attribute. That's fine — argparse silently accepts unknown defaults. But for clarity, read it from the raw config dict instead.
  </action>
  <verify>
Run: `python -m pytest tests/ -x -q` — all existing tests must pass
Verify: `python -c "from job_radar.config import KNOWN_KEYS; print(len(KNOWN_KEYS), KNOWN_KEYS)"` — should show 5 keys
  </verify>
  <done>
auto_open_browser config value correctly determines browser behavior: CLI --no-open overrides, config.json default respected, fallback is True (auto-open). Config and CLI resolution clean with no argparse conflicts.
  </done>
</task>

</tasks>

<verification>
1. `python -c "from job_radar.config import KNOWN_KEYS; assert 'auto_open_browser' in KNOWN_KEYS"` — config recognizes new key
2. `python -c "from job_radar.search import parse_args; args = parse_args({}); assert hasattr(args, 'no_open')"` — CLI flag exists
3. `python -m pytest tests/ -x -q` — no regressions
</verification>

<success_criteria>
- --no-open flag available in CLI (replaces --open)
- auto_open_browser in config KNOWN_KEYS
- generate_report() dict return handled in search.py (no crash)
- Browser opens when jobs found and auto-open enabled
- Zero results skip browser opening
- Report paths and stats displayed in terminal after generation
- Report generation failure exits with non-zero code
</success_criteria>

<output>
After completion, create `.planning/phases/09-report-enhancement/09-02-SUMMARY.md`
</output>
