---
phase: 11-distribution-automation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/release.yml
autonomous: true

must_haves:
  truths:
    - "Pushing a git tag starting with 'v' triggers GitHub Actions workflow"
    - "Workflow runs pytest on all three platforms before building"
    - "Workflow builds executables for Windows, macOS, and Linux using existing job-radar.spec"
    - "Build produces platform-specific archives: .zip for Windows/macOS, .tar.gz for Linux"
    - "Archive names follow pattern job-radar-{version}-{platform}.{ext}"
    - "GitHub Release is created automatically with all three archives attached"
    - "Release has auto-generated release notes from commits"
    - "If any platform test or build fails, no release is created"
  artifacts:
    - path: ".github/workflows/release.yml"
      provides: "Complete CI/CD pipeline for multi-platform builds and release creation"
      contains: "on: push: tags:"
  key_links:
    - from: ".github/workflows/release.yml"
      to: "job-radar.spec"
      via: "pyinstaller job-radar.spec --clean"
      pattern: "pyinstaller.*job-radar\\.spec"
    - from: ".github/workflows/release.yml (release job)"
      to: ".github/workflows/release.yml (build job)"
      via: "needs: build dependency chain"
      pattern: "needs:.*build"
---

<objective>
Create the GitHub Actions release workflow that builds Windows, macOS, and Linux executables when a version tag is pushed, then creates a GitHub Release with all platform binaries attached.

Purpose: This is the core CI/CD pipeline that enables automated distribution -- without it, every release requires manual builds on three platforms.
Output: `.github/workflows/release.yml` -- complete workflow file
</objective>

<execution_context>
@/Users/coryebert/.claude/get-shit-done/workflows/execute-plan.md
@/Users/coryebert/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-distribution-automation/11-CONTEXT.md
@.planning/phases/11-distribution-automation/11-RESEARCH.md
@job-radar.spec
@pyproject.toml
@scripts/build.sh
@scripts/build.bat
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub Actions release workflow</name>
  <files>.github/workflows/release.yml</files>
  <action>
Create `.github/workflows/release.yml` with a complete multi-platform release pipeline.

**Workflow structure (3 jobs chained with `needs:`):**

**Job 1: `test`** — Run pytest on all platforms
- Trigger: `on: push: tags: ['v*']`
- Top-level: `permissions: contents: write`
- Matrix: `[ubuntu-latest, windows-latest, macos-latest]` with `fail-fast: false`
- Steps: checkout (actions/checkout@v4), setup Python 3.10 (actions/setup-python@v5), install deps (`pip install -e . && pip install pytest`), run `pytest tests/`

**Job 2: `build`** — Build executables with PyInstaller
- `needs: test` (skip builds if tests fail)
- Matrix: `[ubuntu-latest, windows-latest, macos-latest]` with `fail-fast: false`
- Include matrix entries to define per-platform variables:
  - `ubuntu-latest`: `platform: linux`, `archive_name: job-radar-${{ github.ref_name }}-linux.tar.gz`
  - `windows-latest`: `platform: windows`, `archive_name: job-radar-${{ github.ref_name }}-windows.zip`
  - `macos-latest`: `platform: macos`, `archive_name: job-radar-${{ github.ref_name }}-macos.zip`
- Steps:
  1. Checkout (actions/checkout@v4)
  2. Setup Python 3.10 (actions/setup-python@v5)
  3. Install deps: `pip install pyinstaller && pip install -e .`
  4. Build: `pyinstaller job-radar.spec --clean`
  5. Create archive (Linux): `if: runner.os == 'Linux'` — `cd dist && tar -czf ../job-radar-${{ github.ref_name }}-linux.tar.gz job-radar/`
  6. Create archive (Windows): `if: runner.os == 'Windows'`, shell: pwsh — `cd dist; Compress-Archive -Path job-radar -DestinationPath ..\job-radar-${{ github.ref_name }}-windows.zip`
  7. Create archive (macOS): `if: runner.os == 'macOS'` — `cd dist && zip -r ../job-radar-${{ github.ref_name }}-macos.zip JobRadar.app`
  8. Upload artifact: `actions/upload-artifact@v4` with `name: job-radar-${{ matrix.platform }}` and `path: job-radar-${{ github.ref_name }}-*`

**Job 3: `release`** — Create GitHub Release with all binaries
- `needs: build` (skip release if builds fail)
- `runs-on: ubuntu-latest`
- Steps:
  1. Download all artifacts: `actions/download-artifact@v4`
  2. Create release: `softprops/action-gh-release@v2` with `generate_release_notes: true` and files glob `job-radar-*/job-radar-${{ github.ref_name }}-*`

**Important details from CONTEXT.md decisions:**
- Use Python 3.10 for builds (maximum compatibility per RESEARCH.md recommendation)
- Do NOT use `fail-fast: true` — we want all platforms to report results
- Do NOT use UPX (already disabled in .spec file)
- Do NOT use `--onefile` (spec file uses onedir mode)
- macOS archive uses `zip -r` to preserve symbolic links in .app bundle
- Windows archive uses PowerShell `Compress-Archive`
- Linux archive uses `tar -czf`

**Do NOT:**
- Add code signing steps (deferred to v2)
- Add manual approval gates (CONTEXT.md says fully automated)
- Add caching of pip dependencies (adds complexity, builds are infrequent)
  </action>
  <verify>
Validate the YAML is syntactically correct:
```bash
python -c "import yaml; yaml.safe_load(open('.github/workflows/release.yml'))"
```
If PyYAML is not installed, validate structure manually by checking:
- File starts with `name:` and `on:` keys
- Three jobs defined: test, build, release
- `needs:` chain: build needs test, release needs build
- Matrix includes all three OS runners
- Archive creation has platform-specific `if:` conditions
- `softprops/action-gh-release@v2` used with `generate_release_notes: true`
  </verify>
  <done>
`.github/workflows/release.yml` exists with:
- Tag trigger on `v*` pattern
- 3-job pipeline: test → build → release
- Matrix strategy for ubuntu-latest, windows-latest, macos-latest
- Platform-specific archive creation (zip/tar.gz)
- Artifact naming: `job-radar-{tag}-{platform}.{ext}`
- Release creation with auto-generated notes and all 3 binaries attached
  </done>
</task>

</tasks>

<verification>
1. `.github/workflows/release.yml` exists and is valid YAML
2. Workflow triggers only on `v*` tags (not branches, not PRs)
3. Test job runs pytest on all 3 platforms with fail-fast disabled
4. Build job depends on test job (`needs: test`)
5. Release job depends on build job (`needs: build`)
6. Archive names include `${{ github.ref_name }}` for version and platform suffix
7. `permissions: contents: write` declared at top level
8. `softprops/action-gh-release@v2` used (not deprecated alternatives)
</verification>

<success_criteria>
A complete GitHub Actions workflow exists that, when a `v*` tag is pushed, will:
1. Run pytest on Windows, macOS, and Linux
2. Build executables using the existing job-radar.spec on all three platforms
3. Create platform-specific archives with correct naming
4. Create a GitHub Release with auto-generated notes and all three archives attached
5. Fail the entire release if any platform's tests or builds fail
</success_criteria>

<output>
After completion, create `.planning/phases/11-distribution-automation/11-01-SUMMARY.md`
</output>
