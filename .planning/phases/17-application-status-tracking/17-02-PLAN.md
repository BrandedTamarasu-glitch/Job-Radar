---
phase: 17-application-status-tracking
plan: 02
type: execute
wave: 2
depends_on: ["17-01"]
files_modified:
  - tests/test_report.py
autonomous: false

must_haves:
  truths:
    - "Tests verify status dropdown HTML exists on recommended cards"
    - "Tests verify status dropdown HTML exists on table rows"
    - "Tests verify embedded tracker-status JSON script tag exists"
    - "Tests verify status management JavaScript functions exist"
    - "Tests verify data-job-key attributes on job items"
    - "Human confirms status dropdown changes badge color and shows toast in browser"
    - "Human confirms status persists on page refresh within same file"
    - "Human confirms export downloads JSON with pending updates"
  artifacts:
    - path: "tests/test_report.py"
      provides: "Test coverage for status tracking UI elements"
      contains: "test_html_report_contains_status_dropdown"
  key_links:
    - from: "tests/test_report.py"
      to: "job_radar/report.py"
      via: "generate_report() call in test fixtures"
      pattern: "generate_report"
---

<objective>
Add test coverage for application status tracking UI elements and verify end-to-end functionality in browser.

Purpose: Ensure status dropdowns, badges, embedded data, and JavaScript are correctly generated in HTML reports, and that the full interactive flow works in a real browser.

Output: New tests in test_report.py covering status UI elements, plus human verification of interactive status tracking.
</objective>

<execution_context>
@/home/corye/.claude/get-shit-done/workflows/execute-plan.md
@/home/corye/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-application-status-tracking/17-01-SUMMARY.md
@job_radar/report.py
@tests/test_report.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tests for status tracking UI elements in HTML report</name>
  <files>tests/test_report.py</files>
  <action>
Add 6 new test functions to `tests/test_report.py` using the existing test patterns (same fixtures: `sample_profile`, `sample_scored_results`, `sample_manual_urls`, `tmp_path`). Follow the established pattern from Phase 16 clipboard tests (e.g., `test_html_report_contains_copy_buttons`).

Each test generates an HTML report via `generate_report()` and reads the HTML file content, then asserts expected strings are present.

**Tests to add:**

1. `test_html_report_contains_status_dropdown` — Verify HTML contains `data-status="applied"`, `data-status="interviewing"`, `data-status="rejected"`, `data-status="offer"`, `data-status=""` (clear), and `dropdown-toggle` class. These should appear on recommended cards.

2. `test_html_report_contains_status_column_in_table` — Verify the results table has a "Status" `<th>` header and that table rows contain status dropdown elements (`data-status=` within `<tr>` elements).

3. `test_html_report_contains_tracker_status_embed` — Verify HTML contains `<script type="application/json" id="tracker-status">` tag for embedded status hydration data.

4. `test_html_report_contains_status_javascript` — Verify HTML contains key JavaScript functions: `hydrateApplicationStatus`, `renderStatusBadge`, `STATUS_CONFIG`, `exportPendingStatusUpdates`, `job-radar-application-status` (localStorage key).

5. `test_html_report_contains_job_key_attributes` — Verify HTML contains `data-job-key=` attributes on job items. The key format should match `title.lower().strip()||company.lower().strip()` pattern.

6. `test_html_report_contains_export_button` — Verify HTML contains the export status updates button with class `export-status-btn` and onclick `exportPendingStatusUpdates`.

Run the full test suite with `python -m pytest tests/test_report.py -v` to confirm all tests pass (existing + new). If pytest is not installed, verify via `python -c "from job_radar.report import generate_report; print('import OK')"` and grep verification.
  </action>
  <verify>
Run `python -m pytest tests/test_report.py -v` and confirm all tests pass (existing 18 + 6 new = 24 total). If pytest unavailable, verify test file syntax with `python -m py_compile tests/test_report.py` and grep for all 6 test function names.
  </verify>
  <done>6 new tests covering status dropdown HTML, table status column, embedded tracker JSON, status JavaScript, data-job-key attributes, and export button all pass alongside existing tests.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify status tracking in browser</name>
  <files>results/*.html</files>
  <action>
Generate a fresh HTML report by running a search, then open it in a browser to verify the complete status tracking flow. This is a human verification checkpoint — the executor presents the verification steps to the user and waits for approval.

What was built: Application status tracking with Bootstrap dropdowns, color-coded badges, localStorage persistence, embedded tracker.json hydration, and JSON export. Built on top of Phase 16 clipboard functionality (which remains intact).

Verification steps:

1. **Status dropdown:** Click the "Status" dropdown on any recommended job card. Verify dropdown shows: Applied, Interviewing, Rejected, Offer, divider, Clear Status.

2. **Badge rendering:** Select "Applied" from dropdown. Verify a green "Applied" badge appears on the card header. Select "Interviewing" on another job — verify blue "Interviewing" badge appears. Select "Rejected" — verify red badge. Select "Offer" — verify yellow/warning badge.

3. **Toast notification:** Each status change should show a Notyf toast confirming the action (e.g., "Marked as Applied").

4. **Table row status:** Scroll to "All Results" table. Verify each row has a Status column with dropdown. Change a status in the table — verify badge appears in the table cell.

5. **Page refresh persistence:** Refresh the page (F5). Verify status badges reappear on the same jobs (loaded from localStorage). Note: badges may show pending indicator since tracker.json has not been synced.

6. **Clear status:** Click dropdown on a job with status, select "Clear Status". Verify badge is removed and toast confirms "Status cleared".

7. **Export button:** Click "Export Status Updates" button. Verify a JSON file downloads. Open the file — verify it contains the jobs you marked with their statuses.

8. **No regressions:** Verify copy buttons, keyboard shortcuts (C/A), and toast notifications from Phase 16 still work correctly.
  </action>
  <verify>User types "approved" after confirming all 8 verification steps pass, or describes specific issues found.</verify>
  <done>Human has verified status dropdowns work, badges render with correct colors, status persists on refresh, export downloads valid JSON, and Phase 16 clipboard features are unaffected.</done>
</task>

</tasks>

<verification>
1. All tests in test_report.py pass (24 total: 18 existing + 6 new)
2. Human verified: status dropdowns work, badges render with correct colors, status persists on refresh, export downloads JSON
3. No regressions in Phase 16 clipboard functionality
</verification>

<success_criteria>
- 6 new tests pass alongside all existing tests
- Human confirms status tracking works end-to-end in browser
- Status persists across page refresh via localStorage
- Export produces valid JSON with pending updates
- Phase 16 clipboard features unaffected
</success_criteria>

<output>
After completion, create `.planning/phases/17-application-status-tracking/17-02-SUMMARY.md`
</output>
