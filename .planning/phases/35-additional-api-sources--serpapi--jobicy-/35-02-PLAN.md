---
phase: 35-additional-api-sources--serpapi--jobicy-
plan: 02
type: execute
wave: 2
depends_on: ["35-01"]
files_modified:
  - job_radar/api_setup.py
  - job_radar/api_config.py
  - job_radar/gui/main_window.py
  - tests/test_sources_api.py
autonomous: true

must_haves:
  truths:
    - "CLI setup wizard prompts for SerpAPI API key with inline validation"
    - "CLI setup wizard includes Jobicy section explaining no key required"
    - "GUI Settings tab shows SerpAPI section with API key field and Test button"
    - "GUI Settings tab shows Jobicy section with enable toggle (no key needed)"
    - "GUI displays quota usage labels next to each API source (e.g., '15/100 this minute')"
    - "Quota labels turn orange when usage exceeds 80% of limit"
    - "Tests cover SerpAPI mapper, Jobicy mapper, quota usage, and search pipeline integration"
  artifacts:
    - path: "job_radar/api_setup.py"
      provides: "SerpAPI and Jobicy wizard sections"
      contains: "SerpAPI"
    - path: "job_radar/api_config.py"
      provides: "Updated .env.example template with SERPAPI_API_KEY"
      contains: "SERPAPI_API_KEY"
    - path: "job_radar/gui/main_window.py"
      provides: "SerpAPI/Jobicy API sections, quota display labels, test buttons"
      contains: "serpapi"
    - path: "tests/test_sources_api.py"
      provides: "Tests for SerpAPI/Jobicy mappers, quota tracking, pipeline integration"
      contains: "test_serpapi"
  key_links:
    - from: "job_radar/gui/main_window.py"
      to: "job_radar/rate_limits.py:get_quota_usage"
      via: "import and call for quota display"
      pattern: "get_quota_usage"
    - from: "job_radar/gui/main_window.py"
      to: "job_radar/sources.py"
      via: "test button dispatches to _test_serpapi"
      pattern: "_test_serpapi"
    - from: "tests/test_sources_api.py"
      to: "job_radar/sources.py"
      via: "test imports for mappers and query builder"
      pattern: "map_serpapi_to_job_result|map_jobicy_to_job_result"
---

<objective>
Add SerpAPI and Jobicy to the CLI setup wizard, GUI Settings tab (with test buttons and quota display), and comprehensive test coverage.

Purpose: Complete the user-facing configuration and validation layer so users can set up credentials, see quota usage, and trust the new integrations work correctly.
Output: Updated api_setup.py with new wizard sections, GUI Settings with API sections + quota labels, .env.example updated, and comprehensive tests.
</objective>

<execution_context>
@/Users/coryebert/.claude/get-shit-done/workflows/execute-plan.md
@/Users/coryebert/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan summary (needed for fetcher function signatures and quota utility)
@.planning/phases/35-additional-api-sources--serpapi--jobicy-/35-01-SUMMARY.md

# Key reference files
@job_radar/api_setup.py  # Current wizard pattern (JSearch section at line 111, USAJobs at line 158)
@job_radar/api_config.py  # ensure_env_example() template, get_api_key()
@job_radar/gui/main_window.py  # _add_api_section() at line 893, _test_api_keys() at line 994, _test_jsearch() at line 1034, _save_api_keys() at line 1134
@job_radar/rate_limits.py  # get_quota_usage() added in Plan 01
@tests/test_sources_api.py  # Existing API test patterns

# Phase context
@.planning/phases/35-additional-api-sources--serpapi--jobicy-/35-CONTEXT.md
@.planning/phases/35-additional-api-sources--serpapi--jobicy-/35-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SerpAPI and Jobicy to CLI wizard and credential config</name>
  <files>job_radar/api_setup.py, job_radar/api_config.py</files>
  <action>
  **In job_radar/api_setup.py:**

  1. **Add SerpAPI section** in `setup_apis()` after the USAJobs section (after line 219). Follow the exact JSearch pattern with inline validation:
     ```python
     # Section 5 - SerpAPI
     print("\n" + "=" * 60)
     print("SerpAPI (Google Jobs)")
     print("=" * 60)
     print("Sign up at: https://serpapi.com/")
     print("Note: Free tier limited to 100 searches/month\n")

     try:
         serpapi_key = questionary.text(
             "SERPAPI_API_KEY (press Enter to skip):",
             style=custom_style
         ).ask()

         if serpapi_key is None:  # Ctrl+C
             print("\nSetup cancelled.")
             return

         if serpapi_key.strip():
             # Validate key with test request
             print("  Testing...", end=" ", flush=True)
             try:
                 test_url = "https://serpapi.com/search?engine=google_jobs&q=test&api_key=" + serpapi_key.strip()
                 response = requests.get(test_url, timeout=10)

                 if response.status_code == 200:
                     print("\u2713 Key is valid")
                     credentials["SERPAPI_API_KEY"] = serpapi_key.strip()
                 elif response.status_code in (401, 403):
                     print(f"\u2717 Invalid key (HTTP {response.status_code})")
                     credentials["SERPAPI_API_KEY"] = serpapi_key.strip()
                 else:
                     print(f"\u26a0 Could not validate (HTTP {response.status_code}) \u2014 key saved anyway")
                     credentials["SERPAPI_API_KEY"] = serpapi_key.strip()
             except requests.Timeout:
                 print("\u26a0 Could not validate (timeout) \u2014 key saved anyway")
                 credentials["SERPAPI_API_KEY"] = serpapi_key.strip()
             except requests.RequestException:
                 print("\u26a0 Could not validate (network error) \u2014 key saved anyway")
                 credentials["SERPAPI_API_KEY"] = serpapi_key.strip()

     except KeyboardInterrupt:
         print("\nSetup cancelled.")
         return
     ```

  2. **Add Jobicy info section** after SerpAPI. Jobicy does NOT need an API key, so this is informational only:
     ```python
     # Section 6 - Jobicy (informational, no key required)
     print("\n" + "=" * 60)
     print("Jobicy (Remote Jobs)")
     print("=" * 60)
     print("No API key required - remote job listings are public")
     print("Rate limited to 1 request per hour")
     print("Jobicy will be automatically included in searches\n")
     ```

  3. **Update Summary section** (around line 228) to include SerpAPI:
     ```python
     if "SERPAPI_API_KEY" in credentials:
         print("  \u2713 SerpAPI (Google Jobs)")
     ```
     Also add: `print("  \u2713 Jobicy (Remote Jobs) - no key required")` always (since it's always available).

  4. **Update .env content builder** (around line 262). Add SerpAPI section:
     ```python
     if "SERPAPI_API_KEY" in credentials:
         env_lines.append("# SerpAPI (Google Jobs)\n")
         env_lines.append(f"SERPAPI_API_KEY={credentials['SERPAPI_API_KEY']}\n\n")
     ```

  5. **Update test_apis()** function (around line 318). Add SerpAPI test after USAJobs:
     ```python
     # Test SerpAPI
     print("SerpAPI (Google Jobs):")
     serpapi_key = os.getenv("SERPAPI_API_KEY")

     if not serpapi_key:
         print("  \u2717 Not configured (skipped)\n")
         results["serpapi"] = "skipped"
     else:
         try:
             url = f"https://serpapi.com/search?engine=google_jobs&q=test&api_key={serpapi_key}"
             response = requests.get(url, timeout=10)

             if response.status_code == 200:
                 print("  \u2713 Pass\n")
                 results["serpapi"] = "pass"
             elif response.status_code in (401, 403):
                 print("  \u2717 Fail: Invalid credentials\n")
                 results["serpapi"] = "fail"
             else:
                 print(f"  \u2717 Error: HTTP {response.status_code}\n")
                 results["serpapi"] = "error"

         except requests.Timeout:
             print("  \u2717 Error: Request timeout\n")
             results["serpapi"] = "error"
         except requests.RequestException as e:
             print(f"  \u2717 Error: Network error ({e})\n")
             results["serpapi"] = "error"

     # Jobicy - always available, no key needed
     print("Jobicy (Remote Jobs):")
     print("  \u2713 Public API - always available (rate limited to 1/hour)\n")
     results["jobicy"] = "pass"
     ```

  **In job_radar/api_config.py:**

  6. **Update ensure_env_example()** template content (around line 82). Add SerpAPI entry:
     ```
     # SerpAPI (Google Jobs)
     # Sign up at: https://serpapi.com/
     # Free tier: 100 searches/month
     SERPAPI_API_KEY=
     ```
  </action>
  <verify>
  Run: `python -c "from job_radar.api_setup import setup_apis, test_apis; print('Import OK')"` — should print "Import OK"
  Run: `python -c "
import job_radar.api_config as ac
import inspect
src = inspect.getsource(ac.ensure_env_example)
assert 'SERPAPI_API_KEY' in src, 'SERPAPI_API_KEY not in .env.example template'
print('.env.example template OK')
"` — should print ".env.example template OK"
  Run: `cd /Users/coryebert/Job-Radar && python -m pytest tests/ -x -q --tb=short` — all tests pass
  </verify>
  <done>CLI wizard includes SerpAPI key prompt with inline validation and Jobicy info section. test_apis() validates SerpAPI credentials and reports Jobicy as always available. .env.example template includes SERPAPI_API_KEY.</done>
</task>

<task type="auto">
  <name>Task 2: Add GUI API sections with quota display and test buttons</name>
  <files>job_radar/gui/main_window.py</files>
  <action>
  Make these changes to job_radar/gui/main_window.py:

  1. **Add import** at top of file (with existing imports):
     ```python
     from ..rate_limits import get_quota_usage
     ```

  2. **Add SerpAPI section** in Settings tab (after Authentic Jobs section, around line 847, before the JSearch tip block). Follow the exact pattern of existing _add_api_section() calls:
     ```python
     # SerpAPI section
     self._add_api_section(
         scroll_frame,
         "SerpAPI (Google Jobs)",
         [("SERPAPI_API_KEY", "API Key", "serpapi")],
         "Sign up at: https://serpapi.com/ (100 searches/month free)"
     )

     # Jobicy section (no API key, just info and enable status)
     jobicy_frame = ctk.CTkFrame(scroll_frame, fg_color="transparent")
     jobicy_frame.pack(fill="x", pady=(10, 20), padx=10)

     jobicy_title = ctk.CTkLabel(
         jobicy_frame,
         text="Jobicy (Remote Jobs)",
         font=ctk.CTkFont(size=14, weight="bold")
     )
     jobicy_title.pack(anchor="w", pady=(0, 5))

     jobicy_info = ctk.CTkLabel(
         jobicy_frame,
         text="Public API - no key required (rate limited to 1 request/hour)",
         font=ctk.CTkFont(size=10),
         text_color="gray"
     )
     jobicy_info.pack(anchor="w", pady=(0, 5))

     jobicy_status = ctk.CTkLabel(
         jobicy_frame,
         text="\u2713 Always available",
         text_color="green"
     )
     jobicy_status.pack(anchor="w")

     # Jobicy quota label
     jobicy_quota = ctk.CTkLabel(
         jobicy_frame,
         text="",
         font=ctk.CTkFont(size=10),
         text_color="gray"
     )
     jobicy_quota.pack(anchor="w", pady=(5, 0))
     ```

  3. **Initialize quota labels dict** in the Settings tab setup method (after `self._api_status_labels = {}`, around line 809):
     ```python
     self._quota_labels = {}
     ```

  4. **Add quota labels to _add_api_section()** method. After the status_label creation (around line 992), add a quota display label:
     ```python
     # Quota usage label
     quota_label = ctk.CTkLabel(
         test_frame,
         text="",
         font=ctk.CTkFont(size=10),
         text_color="gray"
     )
     quota_label.pack(side="left", padx=(10, 0))

     # Store quota label reference using first field's backend API name
     # Map field_id to backend API for quota lookup
     backend_api_map = {
         "jsearch": "jsearch",
         "usajobs": "usajobs",
         "adzuna_id": "adzuna",
         "authentic_jobs": "authentic_jobs",
         "serpapi": "serpapi",
     }
     first_field_id = fields[0][2]
     backend_api = backend_api_map.get(first_field_id)
     if backend_api:
         self._quota_labels[backend_api] = quota_label
     ```

     Also store the Jobicy quota label (after creating jobicy_quota in step 2):
     ```python
     self._quota_labels["jobicy"] = jobicy_quota
     ```

  5. **Add update_quota_display() method** to the main window class (after _save_api_keys method):
     ```python
     def update_quota_display(self):
         """Update quota usage displays for all configured APIs.

         Called after each search completes. Queries SQLite buckets directly
         for current window usage. Shows warning color (orange) when >80% used.
         """
         if not hasattr(self, '_quota_labels'):
             return

         for backend_api, label in self._quota_labels.items():
             try:
                 quota_info = get_quota_usage(backend_api)
                 if quota_info:
                     used, limit, period = quota_info
                     percentage = (used / limit) * 100 if limit > 0 else 0

                     # Color based on usage
                     if percentage >= 100:
                         color = "red"
                     elif percentage >= 80:
                         color = "orange"
                     else:
                         color = "gray"

                     self.after(0, lambda l=label, t=f"{used}/{limit} this {period}", c=color: (
                         l.configure(text=t, text_color=c)
                     ))
                 else:
                     self.after(0, lambda l=label: l.configure(text=""))
             except Exception:
                 pass  # Quota display is best-effort
     ```

  6. **Call update_quota_display() after search completes.** Find where search results are processed/displayed (in the search completion handler), and add:
     ```python
     self.update_quota_display()
     ```
     Look for the search worker completion callback (likely in _on_search_complete or similar method) and add the call there. If there is no obvious hook, add it to the search results display path.

  7. **Add _test_serpapi() method** (after _test_authentic_jobs, around line 1132). Follow the exact pattern of _test_jsearch():
     ```python
     def _test_serpapi(self, api_key, status_label):
         """Test SerpAPI key."""
         if not api_key:
             self.after(0, lambda: status_label.configure(text="\u26a0 No API key provided", text_color="orange"))
             return

         try:
             url = f"https://serpapi.com/search?engine=google_jobs&q=test&api_key={api_key}"
             response = requests.get(url, timeout=10)

             if response.status_code == 200:
                 self.after(0, lambda: status_label.configure(text="\u2713 Valid", text_color="green"))
             elif response.status_code in (401, 403):
                 self.after(0, lambda: status_label.configure(text="\u2717 Invalid key", text_color="red"))
             else:
                 self.after(0, lambda: status_label.configure(
                     text=f"\u26a0 HTTP {response.status_code}", text_color="orange"))

         except requests.Timeout:
             self.after(0, lambda: status_label.configure(text="\u26a0 Timeout", text_color="orange"))
         except requests.RequestException as e:
             self.after(0, lambda: status_label.configure(text=f"\u26a0 Error: {e}", text_color="orange"))
     ```

  8. **Update _test_api_keys() dispatch** (around line 1014). Add SerpAPI dispatch:
     ```python
     elif "SERPAPI_API_KEY" in field_values:
         self._test_serpapi(field_values["SERPAPI_API_KEY"], status_label)
     ```

  9. **Update _save_api_keys()** to include SerpAPI in .env content (around line 1196, after Authentic Jobs section):
     ```python
     # SerpAPI section
     content_lines.append("\n# SerpAPI (Google Jobs)")
     content_lines.append("# Sign up at: https://serpapi.com/")
     if "SERPAPI_API_KEY" in existing_vars:
         content_lines.append(f"SERPAPI_API_KEY={existing_vars['SERPAPI_API_KEY']}")
     else:
         content_lines.append("SERPAPI_API_KEY=")
     ```
  </action>
  <verify>
  Run: `python -c "from job_radar.gui.main_window import MainWindow; print('GUI import OK')"` — should print "GUI import OK" (may need display; if import fails due to no display, verify with grep instead)

  Run: `grep -c 'serpapi\|SerpAPI\|jobicy\|Jobicy' /Users/coryebert/Job-Radar/job_radar/gui/main_window.py` — should be >= 15 (multiple references)

  Run: `grep -c 'quota_label\|update_quota_display\|get_quota_usage' /Users/coryebert/Job-Radar/job_radar/gui/main_window.py` — should be >= 8

  Run: `grep -c '_test_serpapi' /Users/coryebert/Job-Radar/job_radar/gui/main_window.py` — should be >= 2 (definition + dispatch)

  Run: `cd /Users/coryebert/Job-Radar && python -m pytest tests/ -x -q --tb=short` — all tests pass
  </verify>
  <done>GUI Settings tab includes SerpAPI section with API key field and Test button, Jobicy section with status info, quota usage labels for all API sources that update after searches, and warning colors at >80% usage.</done>
</task>

<task type="auto">
  <name>Task 3: Add comprehensive tests for new sources and quota tracking</name>
  <files>tests/test_sources_api.py</files>
  <action>
  Add comprehensive tests to tests/test_sources_api.py. Append the following test functions to the existing test file:

  ```python
  # ===== SerpAPI Tests =====

  class TestMapSerpAPIToJobResult:
      """Tests for SerpAPI response mapper."""

      def test_valid_serpapi_item(self):
          """Complete SerpAPI item maps correctly."""
          item = {
              "title": "Software Engineer",
              "company_name": "Google",
              "location": "Mountain View, CA",
              "description": "Build scalable systems",
              "apply_options": [{"title": "Apply", "link": "https://careers.google.com/apply/123"}],
              "detected_extensions": {
                  "posted_at": "2 days ago",
                  "schedule_type": "Full-time",
                  "work_from_home": False,
              },
              "job_id": "abc123",
          }
          job = map_serpapi_to_job_result(item)
          assert job is not None
          assert job.title == "Software Engineer"
          assert job.company == "Google"
          assert job.source == "serpapi"
          assert job.url == "https://careers.google.com/apply/123"
          assert job.employment_type == "Full-time"
          assert job.parse_confidence == "high"

      def test_serpapi_remote_detection(self):
          """Work from home flag sets arrangement to remote."""
          item = {
              "title": "Remote Developer",
              "company_name": "Remote Co",
              "location": "Anywhere",
              "description": "Work from home position",
              "apply_options": [{"link": "https://example.com"}],
              "detected_extensions": {"work_from_home": True},
          }
          job = map_serpapi_to_job_result(item)
          assert job is not None
          assert job.arrangement == "remote"

      def test_serpapi_missing_title(self):
          """Missing title returns None."""
          item = {
              "title": "",
              "company_name": "Corp",
              "apply_options": [{"link": "https://example.com"}],
          }
          assert map_serpapi_to_job_result(item) is None

      def test_serpapi_missing_company(self):
          """Missing company returns None."""
          item = {
              "title": "Engineer",
              "company_name": "",
              "apply_options": [{"link": "https://example.com"}],
          }
          assert map_serpapi_to_job_result(item) is None

      def test_serpapi_missing_url(self):
          """Missing apply URL returns None."""
          item = {
              "title": "Engineer",
              "company_name": "Corp",
              "apply_options": [],
          }
          assert map_serpapi_to_job_result(item) is None

      def test_serpapi_fallback_share_link(self):
          """Falls back to share_link when apply_options empty."""
          item = {
              "title": "Engineer",
              "company_name": "Corp",
              "location": "Remote",
              "description": "A job",
              "apply_options": [],
              "share_link": "https://google.com/jobs/share/123",
          }
          job = map_serpapi_to_job_result(item)
          assert job is not None
          assert job.url == "https://google.com/jobs/share/123"

      def test_serpapi_description_truncation(self):
          """Long descriptions are truncated to 500 chars."""
          item = {
              "title": "Engineer",
              "company_name": "Corp",
              "location": "NYC",
              "description": "x" * 600,
              "apply_options": [{"link": "https://example.com"}],
          }
          job = map_serpapi_to_job_result(item)
          assert job is not None
          assert len(job.description) <= 500


  # ===== Jobicy Tests =====

  class TestMapJobicyToJobResult:
      """Tests for Jobicy response mapper."""

      def test_valid_jobicy_item(self):
          """Complete Jobicy item maps correctly."""
          item = {
              "id": "12345",
              "url": "https://jobicy.com/jobs/12345",
              "jobTitle": "Senior Python Developer",
              "companyName": "Remote Corp",
              "jobGeo": "USA",
              "jobType": "full-time",
              "jobDescription": "<p>Build <b>awesome</b> things with Python.</p>",
              "pubDate": "2026-02-13 10:30:00",
              "annualSalaryMin": "120000",
              "annualSalaryMax": "180000",
              "salaryCurrency": "USD",
          }
          job = map_jobicy_to_job_result(item)
          assert job is not None
          assert job.title == "Senior Python Developer"
          assert job.company == "Remote Corp"
          assert job.source == "jobicy"
          assert job.arrangement == "remote"  # Always remote
          assert "<p>" not in job.description  # HTML stripped
          assert "<b>" not in job.description
          assert "awesome" in job.description
          assert job.salary_min == 120000.0
          assert job.salary_max == 180000.0
          assert "120,000" in job.salary
          assert "180,000" in job.salary

      def test_jobicy_always_remote(self):
          """Jobicy jobs are always marked as remote."""
          item = {
              "jobTitle": "Developer",
              "companyName": "Corp",
              "url": "https://jobicy.com/jobs/1",
              "jobDescription": "A job description",
          }
          job = map_jobicy_to_job_result(item)
          assert job is not None
          assert job.arrangement == "remote"

      def test_jobicy_html_stripping(self):
          """HTML tags are stripped from descriptions."""
          item = {
              "jobTitle": "Dev",
              "companyName": "Corp",
              "url": "https://jobicy.com/jobs/1",
              "jobDescription": "<h1>Title</h1><p>We need a <strong>great</strong> developer.</p><ul><li>Python</li></ul>",
          }
          job = map_jobicy_to_job_result(item)
          assert job is not None
          assert "<" not in job.description
          assert "great" in job.description
          assert "Python" in job.description

      def test_jobicy_missing_title(self):
          """Missing title returns None."""
          item = {
              "jobTitle": "",
              "companyName": "Corp",
              "url": "https://jobicy.com/jobs/1",
          }
          assert map_jobicy_to_job_result(item) is None

      def test_jobicy_missing_company(self):
          """Missing company returns None."""
          item = {
              "jobTitle": "Dev",
              "companyName": "",
              "url": "https://jobicy.com/jobs/1",
          }
          assert map_jobicy_to_job_result(item) is None

      def test_jobicy_empty_description(self):
          """Empty description after HTML stripping returns None."""
          item = {
              "jobTitle": "Dev",
              "companyName": "Corp",
              "url": "https://jobicy.com/jobs/1",
              "jobDescription": "",
              "jobExcerpt": "",
          }
          assert map_jobicy_to_job_result(item) is None

      def test_jobicy_salary_min_only(self):
          """Salary with only minimum formats correctly."""
          item = {
              "jobTitle": "Dev",
              "companyName": "Corp",
              "url": "https://jobicy.com/jobs/1",
              "jobDescription": "A real job",
              "annualSalaryMin": "100000",
              "annualSalaryMax": "",
          }
          job = map_jobicy_to_job_result(item)
          assert job is not None
          assert "100,000" in job.salary

      def test_jobicy_no_salary(self):
          """Missing salary shows 'Not specified'."""
          item = {
              "jobTitle": "Dev",
              "companyName": "Corp",
              "url": "https://jobicy.com/jobs/1",
              "jobDescription": "A job posting",
          }
          job = map_jobicy_to_job_result(item)
          assert job is not None
          assert job.salary == "Not specified"

      def test_jobicy_fallback_to_excerpt(self):
          """Uses jobExcerpt when jobDescription is empty."""
          item = {
              "jobTitle": "Dev",
              "companyName": "Corp",
              "url": "https://jobicy.com/jobs/1",
              "jobDescription": "",
              "jobExcerpt": "A brief excerpt about this job",
          }
          job = map_jobicy_to_job_result(item)
          assert job is not None
          assert "brief excerpt" in job.description


  # ===== Search Pipeline Integration Tests =====

  class TestSearchPipelineSerpAPIJobicy:
      """Tests for SerpAPI and Jobicy integration in search pipeline."""

      def test_build_search_queries_includes_serpapi(self):
          """build_search_queries generates SerpAPI queries."""
          profile = {
              "target_titles": ["Software Engineer"],
              "core_skills": ["python"],
              "target_market": "San Francisco, CA",
          }
          queries = build_search_queries(profile)
          serpapi_queries = [q for q in queries if q["source"] == "serpapi"]
          assert len(serpapi_queries) >= 1
          assert serpapi_queries[0]["query"] == "Software Engineer"

      def test_build_search_queries_includes_jobicy(self):
          """build_search_queries generates Jobicy queries."""
          profile = {
              "target_titles": ["Python Developer", "Backend Engineer"],
              "core_skills": ["python"],
              "target_market": "Remote",
          }
          queries = build_search_queries(profile)
          jobicy_queries = [q for q in queries if q["source"] == "jobicy"]
          assert len(jobicy_queries) >= 1
          assert len(jobicy_queries) <= 2  # Limited to top 2 titles

      def test_serpapi_query_has_location(self):
          """SerpAPI queries include location from profile."""
          profile = {
              "target_titles": ["Engineer"],
              "core_skills": ["python"],
              "target_market": "New York, NY",
          }
          queries = build_search_queries(profile)
          serpapi_queries = [q for q in queries if q["source"] == "serpapi"]
          assert serpapi_queries[0].get("location") == "New York, NY"


  # ===== Rate Limit Config Tests =====

  class TestRateLimitConfigSerpAPIJobicy:
      """Tests for SerpAPI and Jobicy rate limiter configuration."""

      def test_serpapi_in_rate_limits(self):
          """SerpAPI has rate limit configuration."""
          assert "serpapi" in RATE_LIMITS
          rates = RATE_LIMITS["serpapi"]
          assert len(rates) >= 1

      def test_jobicy_in_rate_limits(self):
          """Jobicy has rate limit configuration."""
          assert "jobicy" in RATE_LIMITS
          rates = RATE_LIMITS["jobicy"]
          assert len(rates) >= 1

      def test_serpapi_in_backend_api_map(self):
          """SerpAPI is in BACKEND_API_MAP."""
          assert "serpapi" in BACKEND_API_MAP
          assert BACKEND_API_MAP["serpapi"] == "serpapi"

      def test_jobicy_in_backend_api_map(self):
          """Jobicy is in BACKEND_API_MAP."""
          assert "jobicy" in BACKEND_API_MAP
          assert BACKEND_API_MAP["jobicy"] == "jobicy"
  ```

  Make sure to add the necessary imports at the top of the test file if not already present:
  ```python
  from job_radar.sources import (
      map_serpapi_to_job_result,
      map_jobicy_to_job_result,
      build_search_queries,
  )
  from job_radar.rate_limits import RATE_LIMITS, BACKEND_API_MAP
  ```

  Preserve all existing test classes and functions in the file. Only ADD new tests.
  </action>
  <verify>
  Run: `cd /Users/coryebert/Job-Radar && python -m pytest tests/test_sources_api.py -x -q --tb=short` — all new and existing tests pass

  Run: `cd /Users/coryebert/Job-Radar && python -m pytest tests/test_sources_api.py -k "serpapi or jobicy" --tb=short -v` — all SerpAPI and Jobicy tests pass

  Run: `cd /Users/coryebert/Job-Radar && python -m pytest tests/ -x -q --tb=short` — full test suite passes (zero regressions)
  </verify>
  <done>Comprehensive test coverage: 7 SerpAPI mapper tests, 9 Jobicy mapper tests, 3 search pipeline tests, 4 rate limit config tests. All 23+ new tests pass alongside existing test suite with zero regressions.</done>
</task>

</tasks>

<verification>
1. CLI: `python -c "from job_radar.api_setup import setup_apis; import inspect; src = inspect.getsource(setup_apis); assert 'SerpAPI' in src; assert 'Jobicy' in src; print('CLI wizard OK')"` — confirms SerpAPI and Jobicy in wizard
2. GUI: `grep -c 'serpapi\|SerpAPI\|jobicy\|Jobicy\|quota' /Users/coryebert/Job-Radar/job_radar/gui/main_window.py` — >= 20 references
3. Tests: `cd /Users/coryebert/Job-Radar && python -m pytest tests/ -x -q --tb=short` — all tests pass
4. Tests: `cd /Users/coryebert/Job-Radar && python -m pytest tests/test_sources_api.py -k "serpapi or jobicy" -v` — all new tests pass
5. Quota: `grep 'update_quota_display\|get_quota_usage' /Users/coryebert/Job-Radar/job_radar/gui/main_window.py` — confirms quota display wired
</verification>

<success_criteria>
- CLI wizard prompts for SerpAPI key with inline validation and shows Jobicy as always-available
- GUI Settings tab shows SerpAPI section with test button and Jobicy info section
- Quota labels display "X/Y this period" next to each API source, orange when >80%
- .env.example includes SERPAPI_API_KEY placeholder
- _save_api_keys() persists SerpAPI key to .env
- 23+ new tests covering both mappers, pipeline integration, and rate limit config
- Full test suite (505+ tests) passes with zero regressions
</success_criteria>

<output>
After completion, create `.planning/phases/35-additional-api-sources--serpapi--jobicy-/35-02-SUMMARY.md`
</output>
