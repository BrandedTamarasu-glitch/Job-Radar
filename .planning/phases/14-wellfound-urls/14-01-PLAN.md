---
phase: 14-wellfound-urls
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [job_radar/sources.py, tests/test_sources_api.py]
autonomous: true

must_haves:
  truths:
    - "User sees Wellfound URLs in search report alongside Indeed/LinkedIn/Glassdoor/WWR"
    - "Wellfound URL opens valid search page matching user's role and location"
    - "Remote preference in target_market uses /role/r/ pattern instead of /role/l/"
    - "Terminal output includes Wellfound in manual URL count"
    - "HTML report shows Wellfound links grouped under Wellfound heading"
  artifacts:
    - path: "job_radar/sources.py"
      provides: "generate_wellfound_url() function and _slugify_for_wellfound() helper"
      contains: "generate_wellfound_url"
    - path: "job_radar/sources.py"
      provides: "Wellfound integrated into generate_manual_urls()"
      contains: "Wellfound"
    - path: "tests/test_sources_api.py"
      provides: "Test coverage for Wellfound URL generation"
      contains: "test_wellfound"
  key_links:
    - from: "job_radar/sources.py:generate_wellfound_url"
      to: "job_radar/sources.py:generate_manual_urls"
      via: "generators list tuple"
      pattern: '"Wellfound", generate_wellfound_url'
    - from: "job_radar/sources.py:generate_manual_urls"
      to: "job_radar/report.py:_html_manual_urls_section"
      via: "manual_urls list passed through generate_report"
      pattern: "manual_urls"
---

<objective>
Add Wellfound (formerly AngelList Talent) manual search URL generation to the existing manual URL infrastructure, so users see Wellfound links in their search reports alongside Indeed, LinkedIn, Glassdoor, and We Work Remotely.

Purpose: Fulfills API-03 requirement — "System generates Wellfound manual search URLs (no API available)". Wellfound specializes in startup jobs and equity-heavy roles, complementing existing job sources.

Output: Modified sources.py with Wellfound URL generator integrated into generate_manual_urls(), plus test coverage.
</objective>

<execution_context>
@/Users/coryebert/.claude/get-shit-done/workflows/execute-plan.md
@/Users/coryebert/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-wellfound-urls/14-CONTEXT.md
@.planning/phases/14-wellfound-urls/14-RESEARCH.md

Key existing code to reference:
@job_radar/sources.py — lines 950-1020: existing generate_indeed_url(), generate_linkedin_url(), generate_glassdoor_url(), generate_weworkremotely_url(), generate_manual_urls()
@job_radar/report.py — lines 184-194: Markdown manual URL section (auto-groups by source)
@job_radar/report.py — lines 605-643: HTML _html_manual_urls_section() (auto-groups by source)
@job_radar/search.py — line 645: manual_urls = generate_manual_urls(profile)
@tests/test_sources_api.py — existing API test file (add Wellfound URL tests here)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Wellfound URL generator and integrate into manual URLs</name>
  <files>job_radar/sources.py</files>
  <action>
Add the following to job_radar/sources.py, placed immediately BEFORE the existing generate_indeed_url() function (around line 950):

1. **_slugify_for_wellfound(text: str) -> str** helper function:
   - Convert text to lowercase, strip whitespace
   - Replace spaces with hyphens
   - Remove commas (for locations like "San Francisco, CA" -> "san-francisco-ca")
   - Filter to only alphanumeric + hyphens
   - Collapse consecutive hyphens into single hyphen
   - Strip leading/trailing hyphens
   - This is a private helper (underscore prefix), used by generate_wellfound_url()

2. **generate_wellfound_url(title: str, location: str) -> str** function:
   - Signature matches existing pattern: takes title and location strings, returns URL string
   - Slugify the title using _slugify_for_wellfound()
   - Check if "remote" appears in location (case-insensitive): if yes, return `https://wellfound.com/role/r/{role_slug}`
   - Otherwise, slugify the location and return `https://wellfound.com/role/l/{role_slug}/{location_slug}`
   - Include docstring with URL pattern documentation and examples matching RESEARCH.md patterns

3. **Update generate_manual_urls()** (around line 996):
   - Add ("Wellfound", generate_wellfound_url) to the generators list as the FIRST entry (Wellfound should appear first in manual URLs per CONTEXT.md decision: "Placement: Top of search results")
   - The existing generators loop already handles calling gen_fn(title, location) for each title, so no other changes needed

Important notes:
- Do NOT use urllib.parse.quote() for Wellfound slugs — Wellfound uses raw hyphenated path segments, not percent-encoded values (per RESEARCH.md anti-pattern warning)
- Do NOT add HEAD request validation — Wellfound returns 403 for automated requests (per RESEARCH.md pitfall #2)
- Do NOT add skills to the URL — role-based search is Wellfound's primary pattern (per RESEARCH.md open question #4)
- Match function signature pattern of existing generators (title: str, location: str) -> str for compatibility with generators loop
  </action>
  <verify>
Run: `cd "/Users/coryebert/Documents/Job Hunt Python/Project Folder/Job-Radar" && python -c "from job_radar.sources import generate_wellfound_url, generate_manual_urls; print(generate_wellfound_url('Software Engineer', 'San Francisco, CA')); print(generate_wellfound_url('Backend Developer', 'Remote')); urls = generate_manual_urls({'target_titles': ['Software Engineer'], 'target_market': 'Remote'}); print([u['source'] for u in urls]); print(urls[0])"`

Expected output should show:
- `https://wellfound.com/role/l/software-engineer/san-francisco-ca` for location-based
- `https://wellfound.com/role/r/backend-developer` for remote
- Wellfound appearing first in source list
- URL dict with source="Wellfound"
  </verify>
  <done>
generate_wellfound_url() produces correct URLs for location and remote variants. generate_manual_urls() includes Wellfound as first source. No existing tests broken. Report generation (MD + HTML) automatically picks up Wellfound URLs through existing manual_urls data flow.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add test coverage for Wellfound URL generation</name>
  <files>tests/test_sources_api.py</files>
  <action>
Add Wellfound URL generation tests to tests/test_sources_api.py (the existing API-related test file). Add these test functions at the end of the file:

1. **test_generate_wellfound_url_with_location()** — Verify location-based URL:
   - Input: title="Software Engineer", location="San Francisco, CA"
   - Expected: "https://wellfound.com/role/l/software-engineer/san-francisco-ca"
   - Verifies the /role/l/ pattern and comma removal in location slug

2. **test_generate_wellfound_url_remote()** — Verify remote URL pattern:
   - Input: title="Backend Developer", location="Remote"
   - Expected: "https://wellfound.com/role/r/backend-developer"
   - Verifies the /role/r/ pattern for remote preference

3. **test_generate_wellfound_url_remote_case_insensitive()** — Verify remote detection is case-insensitive:
   - Input: title="Frontend Engineer", location="remote - US"
   - Expected URL starts with "https://wellfound.com/role/r/"
   - Verifies case-insensitive "remote" detection

4. **test_generate_wellfound_url_slug_special_chars()** — Verify slug handles special characters:
   - Input: title="Senior Full-Stack Engineer", location="New York, NY"
   - Expected: URL contains "senior-full-stack-engineer" (preserves existing hyphens) and "new-york-ny"
   - Verifies special character filtering

5. **test_slugify_for_wellfound_edge_cases()** — Test the private slugifier directly:
   - Import _slugify_for_wellfound
   - Test cases: empty string -> "", "  spaces  " -> "spaces", "Multiple   Spaces" -> "multiple-spaces", "Already-Hyphenated" -> "already-hyphenated"

6. **test_generate_manual_urls_includes_wellfound()** — Verify Wellfound in generate_manual_urls():
   - Input: profile with target_titles=["Software Engineer"] and target_market="Remote"
   - Assert "Wellfound" in [u["source"] for u in urls]
   - Assert Wellfound URL contains "wellfound.com"
   - Assert Wellfound appears BEFORE Indeed in the list (first source)

7. **test_generate_manual_urls_wellfound_uses_first_three_titles()** — Verify title limit:
   - Input: profile with target_titles=["A", "B", "C", "D", "E"] and target_market="Remote"
   - Count Wellfound URLs: should be exactly 3 (matching existing [:3] pattern)

Use @pytest.mark.parametrize where it improves readability (e.g., combining the location/remote/case-insensitive tests). Import generate_wellfound_url and _slugify_for_wellfound from job_radar.sources.
  </action>
  <verify>
Run: `cd "/Users/coryebert/Documents/Job Hunt Python/Project Folder/Job-Radar" && python -m pytest tests/test_sources_api.py -v --tb=short -k wellfound`

All wellfound tests should pass. Then run full test suite:
`python -m pytest tests/ -v --tb=short`

All existing tests should still pass (no regressions).
  </verify>
  <done>
7+ test cases covering Wellfound URL generation: location-based URLs, remote URLs, case-insensitive remote detection, special character handling, slug edge cases, integration with generate_manual_urls(), and title count limit. Full test suite passes with zero regressions.
  </done>
</task>

</tasks>

<verification>
1. Run full test suite: `python -m pytest tests/ -v --tb=short` — all tests pass
2. Verify URL generation: `python -c "from job_radar.sources import generate_wellfound_url; print(generate_wellfound_url('Software Engineer', 'San Francisco, CA'))"` — outputs valid URL
3. Verify remote pattern: `python -c "from job_radar.sources import generate_wellfound_url; print(generate_wellfound_url('Backend Developer', 'Remote'))"` — uses /role/r/ pattern
4. Verify integration: `python -c "from job_radar.sources import generate_manual_urls; urls = generate_manual_urls({'target_titles': ['Dev'], 'target_market': 'NYC'}); sources = [u['source'] for u in urls]; print(sources); assert 'Wellfound' in sources"` — Wellfound in manual URLs
5. Verify report auto-picks up Wellfound: No changes needed to report.py or search.py — existing data flow handles it
</verification>

<success_criteria>
- generate_wellfound_url() produces correct URLs for both location and remote variants
- Wellfound appears first among manual sources in generate_manual_urls()
- All 7+ Wellfound-specific tests pass
- Full test suite passes with zero regressions
- No changes to report.py or search.py needed (existing infrastructure handles Wellfound automatically)
- API-03 requirement satisfied: "System generates Wellfound manual search URLs"
</success_criteria>

<output>
After completion, create `.planning/phases/14-wellfound-urls/14-01-SUMMARY.md`
</output>
