---
phase: 21-responsive-layout
plan: 02
type: execute
wave: 2
depends_on:
  - "21-01"
files_modified:
  - tests/test_report.py
autonomous: false

must_haves:
  truths:
    - "Tests verify data-label attributes exist on all table cells"
    - "Tests verify col-* classes exist on hideable columns (th and td)"
    - "Tests verify responsive CSS breakpoint rules at 991px and 767px are present"
    - "Tests verify mobile card CSS (display:block, grid-template-columns) exists"
    - "Tests verify AddTableARIA JavaScript function is present in output"
    - "Tests verify ARIA role assignments in JS (table, row, cell, columnheader, rowheader)"
    - "Tests verify dark mode mobile card styles exist"
    - "Tests verify 44px touch target CSS rule exists"
    - "Tests verify mobile cards show all columns (override tablet hiding with display:block !important)"
    - "Human verified responsive behavior in actual browser at all three breakpoints"
  artifacts:
    - path: "tests/test_report.py"
      provides: "Responsive layout test coverage"
      contains: "test_responsive"
  key_links:
    - from: "tests/test_report.py"
      to: "job_radar/report.py"
      via: "Tests generate HTML output and verify responsive CSS rules, data-label attributes, and ARIA JS"
      pattern: "data-label|col-salary|AddTableARIA|max-width"
---

<objective>
Add test coverage for responsive layout features (data-label attributes, column classes, media queries, mobile card CSS, ARIA restoration, touch targets, dark mode) and verify responsive behavior in browser at all three breakpoints.

Purpose: Ensure responsive layout implementation is correct and will not regress. The responsive behavior involves CSS media queries, HTML attribute additions, and JavaScript ARIA restoration -- all of which need automated verification that the expected patterns exist in the generated HTML output.

Output: New test functions in test_report.py covering all responsive features, plus human-verified responsive behavior.
</objective>

<execution_context>
@/home/corye/.claude/get-shit-done/workflows/execute-plan.md
@/home/corye/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-responsive-layout/21-01-SUMMARY.md
@job_radar/report.py
@tests/test_report.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add responsive layout tests</name>
  <files>tests/test_report.py</files>
  <action>
Add a new test group for responsive layout features in test_report.py. Use the existing `sample_scored_results` fixture and `_generate_html_report()` pattern established in the file. All tests should generate HTML output and assert on the string content.

Add these test functions:

1. **test_responsive_data_labels_on_table_cells** - Generate HTML report, verify each of the 11 table columns has a corresponding `data-label="ColumnName"` attribute in the output. Check for: data-label="#", data-label="Score", data-label="New", data-label="Status", data-label="Title", data-label="Company", data-label="Salary", data-label="Type", data-label="Location", data-label="Snippet", data-label="Link".

2. **test_responsive_column_hide_classes** - Verify the 4 low-priority columns have col-* CSS classes on both th and td elements. Check for `class="col-new"`, `class="col-salary"`, `class="col-type"`, `class="col-snippet"` in the output HTML.

3. **test_responsive_tablet_breakpoint_css** - Verify the CSS output contains a `@media (max-width: 991px)` rule that sets `display: none` for `.col-new`, `.col-salary`, `.col-type`, `.col-snippet`.

4. **test_responsive_mobile_card_css** - Verify the CSS contains a `@media (max-width: 767px)` rule with:
   - `display: block` for table elements
   - `grid-template-columns` for cell layout
   - `content: attr(data-label)` for ::before labels

5. **test_responsive_mobile_shows_all_columns** - Verify the mobile CSS contains `display: block !important` for `.col-new, .col-salary, .col-type, .col-snippet` to override tablet hiding.

6. **test_responsive_aria_restoration_js** - Verify the JavaScript output contains the `AddTableARIA` function with `setAttribute('role', 'table')`, `setAttribute('role', 'row')`, `setAttribute('role', 'cell')`, `setAttribute('role', 'columnheader')`, `setAttribute('role', 'rowheader')`.

7. **test_responsive_touch_targets** - Verify CSS contains `min-height: 44px` and `min-width: 44px` rules within the mobile media query context.

8. **test_responsive_dark_mode_mobile** - Verify CSS contains combined dark mode + mobile rules (prefers-color-scheme: dark combined with max-width: 767px) with appropriate background/border/label color overrides.

9. **test_responsive_tier_borders_mobile** - Verify mobile CSS preserves tier border styles: `tier-strong` with 5px border, `tier-rec` with 4px border, `tier-review` with 3px border within the mobile media query.

10. **test_responsive_no_label_class** - Verify the Link column td has `class="no-label"` and CSS contains `.no-label::before` with `display: none` or equivalent.

Follow the existing test patterns in the file. Use `assert "expected_string" in html_content` style assertions. Import the necessary functions at top of test file if not already imported.
  </action>
  <verify>
Run: `python -m pytest tests/test_report.py -x -q` -- all tests pass including 10 new responsive tests.
Run: `python -m pytest tests/test_report.py -k "responsive" -v` -- all 10 responsive tests listed and pass.
Run: `python -m pytest tests/ -x -q` -- full suite passes (328+ existing + 10 new = 338+).
  </verify>
  <done>10 new test functions verify all responsive layout features: data-label attributes, column classes, tablet/mobile CSS breakpoints, ARIA restoration JS, touch targets, dark mode mobile, tier borders on mobile, and no-label class. All tests pass alongside existing test suite.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify responsive behavior in browser</name>
  <files>job_radar/report.py</files>
  <action>
Human verification of responsive layout at all three breakpoints. Generate a report and test in browser with DevTools device emulation.

Responsive layout for the HTML report with three breakpoints:
- Desktop (>=992px): Full 11-column table
- Tablet (768-991px): 7 columns (4 hidden)
- Mobile (&lt;768px): Stacked card layout with labeled fields

Plus ARIA restoration, tier border preservation, dark mode mobile support, and 44px touch targets.
  </action>
  <verify>
1. Generate a test report: `python -m job_radar --profile profiles/*.json` (or use an existing report in results/)
2. Open the HTML report in a browser
3. Desktop check (>=992px): Verify all 11 columns visible in the table, tier borders on left side of rows
4. Tablet check: Open browser DevTools (F12), toggle device toolbar, set viewport to 800px wide. Verify 4 columns hidden (New, Salary, Type, Snippet), 7 columns visible (#, Score, Status, Title, Company, Location, Link), table still looks like a table
5. Mobile check: Set viewport to 375px wide. Verify table rows become stacked cards, each field shows a bold label (Score:, Title:, Company:, etc.), ALL 11 fields visible including Salary/Type/Snippet, tier borders visible on cards, buttons/dropdowns easily tappable
6. Dark mode check: Toggle dark mode in DevTools (Rendering > prefers-color-scheme: dark). Verify mobile cards have dark backgrounds and readable light text/labels
7. Hero section check: Verify hero cards at top still render correctly at all breakpoints
  </verify>
  <done>Human confirmed responsive behavior works correctly at desktop (all columns), tablet (7 columns), and mobile (stacked cards with all data). Dark mode and tier borders render correctly. Hero section unaffected.</done>
</task>

</tasks>

<verification>
1. `python -m pytest tests/ -x -q` -- all tests pass (338+)
2. `python -m pytest tests/test_report.py -k "responsive" -v` -- 10 responsive tests pass
3. Human verified responsive behavior at desktop, tablet, and mobile viewports
4. Human verified dark mode mobile cards
5. Human verified hero section renders at all breakpoints
</verification>

<success_criteria>
- 10 new responsive layout tests pass
- All existing 328+ tests pass without regression
- Human confirmed desktop view shows all 11 columns
- Human confirmed tablet view hides 4 columns
- Human confirmed mobile view shows stacked cards with all data
- Human confirmed dark mode mobile cards readable
- Human confirmed hero section renders correctly at all breakpoints
</success_criteria>

<output>
After completion, create `.planning/phases/21-responsive-layout/21-02-SUMMARY.md`
</output>
