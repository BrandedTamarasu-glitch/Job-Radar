---
phase: 21-responsive-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - job_radar/report.py
autonomous: true

must_haves:
  truths:
    - "Desktop view (>=992px) displays all 11 table columns with full data"
    - "Tablet view (<992px) hides 4 low-priority columns (Salary, Type, Snippet, New) leaving 7 visible columns"
    - "Mobile view (<768px) transforms table rows into stacked card layout with labeled fields"
    - "Mobile cards show ALL job data including fields hidden at tablet breakpoint"
    - "Screen readers announce table structure correctly due to ARIA role restoration"
    - "Interactive elements (copy buttons, status dropdowns) have 44px minimum touch targets on mobile"
    - "Dark mode renders correctly on mobile card layout (backgrounds, borders, labels)"
    - "Tier borders (5px/4px/3px) carry through to mobile card layout"
  artifacts:
    - path: "job_radar/report.py"
      provides: "Responsive CSS media queries, data-label attributes, col-* classes, ARIA restoration JS"
      contains: "@media (max-width: 991px)"
  key_links:
    - from: "job_radar/report.py CSS"
      to: "job_radar/report.py HTML template"
      via: "col-* classes on th and td elements match CSS display:none rules"
      pattern: "col-(salary|type|snippet|new)"
    - from: "job_radar/report.py CSS mobile"
      to: "job_radar/report.py HTML template"
      via: "data-label attributes on td elements provide ::before content for mobile cards"
      pattern: "data-label="
    - from: "job_radar/report.py JS AddTableARIA"
      to: "job_radar/report.py HTML table"
      via: "JavaScript injects ARIA roles on DOMContentLoaded to restore table semantics after display:block"
      pattern: "setAttribute.*role.*table"
---

<objective>
Implement responsive layout for the HTML report with three viewport breakpoints: desktop (all columns), tablet (reduced columns), and mobile (stacked card layout). Add ARIA role restoration JavaScript to preserve table semantics when CSS display:block is applied at mobile viewport.

Purpose: The HTML report currently renders a fixed-width table that requires horizontal scrolling on smaller screens. This plan makes the report scannable and usable on tablets and phones by hiding low-priority columns at tablet width and transforming the table into labeled cards at mobile width, while preserving accessibility for screen reader users.

Output: Updated report.py with responsive CSS, data-label attributes on all table cells, col-* column classes for tablet hiding, mobile card CSS with dark mode support, and AddTableARIA JavaScript function.
</objective>

<execution_context>
@/home/corye/.claude/get-shit-done/workflows/execute-plan.md
@/home/corye/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-responsive-layout/21-RESEARCH.md
@.planning/phases/19-typography-color-foundation/19-02-SUMMARY.md
@.planning/phases/20-hero-jobs-visual-hierarchy/20-01-SUMMARY.md
@job_radar/report.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add data-label attributes and col-* classes to HTML table template</name>
  <files>job_radar/report.py</files>
  <action>
Modify the table HTML generation in two areas of report.py: the "All Results" table (around line 1730-1776) and the thead/th definitions.

1. **Add col-* CSS classes to thead th elements** (around line 1755-1767):
   The current 11 columns are: #, Score, New, Status, Title, Company, Salary, Type, Location, Snippet, Link.

   The 4 columns to HIDE at tablet (<992px) are: New, Salary, Type, Snippet.
   The 7 columns to KEEP at tablet are: #, Score, Status, Title, Company, Location, Link.

   Add classes to the th elements that will be hidden:
   - `<th scope="col" class="col-new">New</th>`
   - `<th scope="col" class="col-salary">Salary</th>`
   - `<th scope="col" class="col-type">Type</th>`
   - `<th scope="col" class="col-snippet">Snippet</th>`

   Leave these without col-* class (always visible): #, Score, Status, Title, Company, Location, Link.

2. **Add data-label attributes AND matching col-* classes to all td elements** in the table row generation (around line 1730-1744):
   Update each `<td>` to include `data-label="ColumnName"` for mobile card labels AND the matching `col-*` class where applicable:

   - `<th scope="row" data-label="#">{i}</th>` (th stays as-is for row header semantics, add data-label)
   - `<td data-label="Score">{score_badge_accessible}...</td>`
   - `<td data-label="New" class="col-new">{new_badge_accessible}</td>`
   - `<td data-label="Status" class="col-status">{status_dropdown}</td>` (status visible at all sizes, no col-hide needed)
   - `<td data-label="Title"><strong>{title}</strong></td>`
   - `<td data-label="Company">{company}</td>`
   - `<td data-label="Salary" class="col-salary">{salary}</td>`
   - `<td data-label="Type" class="col-type">{emp_type}</td>`
   - `<td data-label="Location">{location}</td>`
   - `<td data-label="Snippet" class="col-snippet">{snippet}</td>`
   - `<td data-label="Link" class="no-label">{link_html}</td>` (no-label class: copy button is self-explanatory, no ::before label needed)

   Use abbreviated labels optimized for mobile (8em label column width): "#", "Score", "New", "Status", "Title", "Company", "Salary", "Type", "Location", "Snippet", "Link".

IMPORTANT: Do NOT change the hero section cards or recommended section cards -- they already stack vertically as Bootstrap cards. Only the "All Results" table needs responsive transformation.
  </action>
  <verify>
Run: `python -m pytest tests/test_report.py -x -q` -- all existing tests pass (no regressions).
Run: `python -c "from job_radar.report import _generate_html_report; print('import ok')"` -- no syntax errors.
Grep: `grep -c 'data-label=' job_radar/report.py` shows 11 occurrences (one per column in the table row).
Grep: `grep -c 'col-salary\|col-type\|col-snippet\|col-new' job_radar/report.py` shows 8+ occurrences (4 in thead + 4 in tbody rows).
  </verify>
  <done>All 11 table cells have data-label attributes. The 4 low-priority columns (New, Salary, Type, Snippet) have col-* classes on both th and td. All existing tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Add responsive CSS media queries, mobile card layout, and ARIA restoration JavaScript</name>
  <files>job_radar/report.py</files>
  <action>
Add three blocks to report.py: responsive CSS in the existing `<style>` block, and ARIA restoration JavaScript in the existing `<script>` block.

**A. Tablet breakpoint CSS** -- Add AFTER the existing print/dark mode styles but BEFORE the closing `</style>` tag. Insert within the existing style block (around line 415-600 area, after the current CSS rules):

```css
/* ---- Responsive Layout ---- */
/* Tablet: hide low-priority columns */
@media (max-width: 991px) {
  .col-new,
  .col-salary,
  .col-type,
  .col-snippet {
    display: none;
  }
}
```

**B. Mobile card layout CSS** -- Add immediately after the tablet rules:

```css
/* Mobile: table to stacked cards */
@media (max-width: 767px) {
  /* Visually hide table headers (keep in DOM for ARIA) */
  thead {
    position: absolute;
    clip: rect(0 0 0 0);
    height: 1px;
    width: 1px;
    overflow: hidden;
    white-space: nowrap;
  }

  /* Convert table elements to block stacking */
  table.table, table.table tbody, table.table tr, table.table td, table.table th {
    display: block;
    width: 100%;
  }

  /* Remove Bootstrap striped/hover on mobile */
  .table-striped > tbody > tr:nth-of-type(odd) > * {
    --bs-table-bg-type: transparent;
  }
  .table-hover > tbody > tr:hover > * {
    --bs-table-bg-state: transparent;
  }

  /* Each row becomes a card */
  table.table tbody tr {
    margin-bottom: 1rem;
    padding: 1rem;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    background: white;
  }

  /* Preserve tier left borders on mobile cards */
  table.table tbody tr.tier-strong {
    border-left: 5px solid var(--color-tier-strong-border);
    background-color: var(--color-tier-strong-bg) !important;
  }
  table.table tbody tr.tier-rec {
    border-left: 4px solid var(--color-tier-rec-border);
    background-color: var(--color-tier-rec-bg) !important;
  }
  table.table tbody tr.tier-review {
    border-left: 3px solid var(--color-tier-review-border);
    background-color: var(--color-tier-review-bg) !important;
  }

  /* Show ALL columns in mobile (override tablet hiding) */
  .col-new,
  .col-salary,
  .col-type,
  .col-snippet {
    display: block !important;
  }

  /* Grid layout for each cell: label + value */
  table.table td,
  table.table th[scope="row"] {
    display: grid;
    grid-template-columns: 7em 1fr;
    gap: 0.5rem;
    padding: 0.5rem 0;
    border-bottom: 1px solid #e9ecef;
    align-items: start;
  }

  table.table td:last-child,
  table.table th[scope="row"]:last-child {
    border-bottom: none;
  }

  /* Label from data-label attribute */
  table.table td::before,
  table.table th[scope="row"]::before {
    content: attr(data-label);
    font-weight: 600;
    color: #6c757d;
    font-size: var(--font-size-small);
  }

  /* Hide label for cells that don't need one (e.g., Link column with self-explanatory button) */
  table.table td.no-label::before {
    display: none;
  }
  table.table td.no-label {
    grid-template-columns: 1fr;
  }

  /* Touch targets: minimum 44x44px for interactive elements */
  table.table td button,
  table.table td select,
  table.table td .btn,
  table.table td .dropdown-toggle {
    min-height: 44px;
    min-width: 44px;
  }

  /* Row number cell: simplify display */
  table.table th[scope="row"] {
    font-weight: 600;
    color: #6c757d;
    font-size: var(--font-size-small);
    padding-top: 0.75rem;
  }
}
```

**C. Dark mode mobile overrides** -- Add nested within the mobile media query OR as a separate combined rule:

```css
/* Dark mode + mobile card adjustments */
@media (prefers-color-scheme: dark) and (max-width: 767px) {
  table.table tbody tr {
    background: #212529;
    border-color: #495057;
  }
  table.table td,
  table.table th[scope="row"] {
    border-bottom-color: #343a40;
  }
  table.table td::before,
  table.table th[scope="row"]::before {
    color: #adb5bd;
  }
}
```

**D. AddTableARIA JavaScript function** -- Add to the existing `<script>` block (before the closing `</script>` tag), alongside the existing clipboard/status JavaScript:

```javascript
// ARIA role restoration for table semantics with display:block
// Source: Adrian Roselli pattern (2018, updated 2023)
function AddTableARIA() {
  try {
    document.querySelectorAll('table').forEach(function(t) { t.setAttribute('role', 'table'); });
    document.querySelectorAll('caption').forEach(function(c) { c.setAttribute('role', 'caption'); });
    document.querySelectorAll('thead, tbody, tfoot').forEach(function(rg) { rg.setAttribute('role', 'rowgroup'); });
    document.querySelectorAll('tr').forEach(function(r) { r.setAttribute('role', 'row'); });
    document.querySelectorAll('td').forEach(function(c) { c.setAttribute('role', 'cell'); });
    document.querySelectorAll('th').forEach(function(h) { h.setAttribute('role', 'columnheader'); });
    document.querySelectorAll('th[scope=row]').forEach(function(rh) { rh.setAttribute('role', 'rowheader'); });
  } catch (e) {
    console.log('AddTableARIA(): ' + e);
  }
}
AddTableARIA();
```

Run AddTableARIA() immediately (not on DOMContentLoaded) since the script block is at the end of the body, AFTER the table is in the DOM. This ensures ARIA roles are set before screen readers parse the content.

IMPORTANT implementation notes:
- Use `table.table` selector specificity to override Bootstrap table defaults without affecting hero/recommended card sections.
- Use `!important` on mobile column show-back to override the tablet hiding.
- The existing `<meta name="viewport" content="width=device-width, initial-scale=1">` is already present (line 315), no changes needed.
- Double-brace `{{` and `}}` all CSS in the f-string (existing pattern in report.py).
- The hero section uses Bootstrap cards that already stack on mobile -- no changes needed there.
  </action>
  <verify>
Run: `python -m pytest tests/test_report.py -x -q` -- all existing tests pass.
Run: `python -c "from job_radar.report import _generate_html_report; print('import ok')"` -- no syntax errors.
Grep: `grep -c 'max-width: 991px\|max-width: 767px' job_radar/report.py` shows 2+ occurrences (tablet + mobile breakpoints).
Grep: `grep -c 'AddTableARIA' job_radar/report.py` shows 2+ occurrences (function def + call).
Grep: `grep -c 'data-label' job_radar/report.py` shows 11+ (from Task 1).
Grep: `grep -c 'min-height: 44px' job_radar/report.py` shows 1+ (touch target rule).
Grep: `grep 'prefers-color-scheme.*dark.*max-width.*767' job_radar/report.py` shows dark mode + mobile combined rule.
  </verify>
  <done>
Tablet view (<992px) hides 4 low-priority columns via CSS display:none on col-* classes. Mobile view (<768px) transforms table rows into stacked cards with grid layout (label column + value column) using data-label ::before pseudo-elements. All columns are visible on mobile (override tablet hiding). Tier borders preserved on mobile cards. Touch targets enforce 44px minimum. Dark mode mobile cards have appropriate backgrounds, borders, and label colors. ARIA roles injected on all table elements to preserve screen reader semantics when display:block is applied.
  </done>
</task>

</tasks>

<verification>
1. `python -m pytest tests/ -x -q` -- all existing tests pass (no regressions)
2. `grep -c 'data-label=' job_radar/report.py` -- 11 occurrences (all table cells labeled)
3. `grep -c 'col-salary\|col-type\|col-snippet\|col-new' job_radar/report.py` -- 8+ (th + td)
4. `grep -c '@media.*max-width.*991\|@media.*max-width.*767' job_radar/report.py` -- 2+ breakpoints
5. `grep -c 'AddTableARIA' job_radar/report.py` -- 2+ (definition + invocation)
6. `grep 'role.*table\|role.*row\|role.*cell\|role.*columnheader\|role.*rowheader' job_radar/report.py` -- ARIA role assignments in JS
7. Generate a test report and open in browser: verify desktop shows all columns, resize to <992px shows 7 columns, resize to <768px shows cards with labels
</verification>

<success_criteria>
- Desktop (>=992px): All 11 table columns visible and functional
- Tablet (<992px): 4 columns hidden (New, Salary, Type, Snippet), 7 visible (#, Score, Status, Title, Company, Location, Link)
- Mobile (<768px): Table rows become stacked cards with labeled fields, ALL data visible including tablet-hidden columns
- Mobile cards preserve tier borders (5px/4px/3px) from Phase 19
- Dark mode mobile cards render with appropriate dark backgrounds and light label text
- Touch targets on mobile are >= 44px for buttons, dropdowns, links
- ARIA roles (table, rowgroup, row, cell, columnheader, rowheader) injected via JavaScript
- All existing 328+ tests pass without regression
</success_criteria>

<output>
After completion, create `.planning/phases/21-responsive-layout/21-01-SUMMARY.md`
</output>
