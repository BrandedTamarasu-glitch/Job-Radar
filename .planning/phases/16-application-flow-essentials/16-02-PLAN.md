---
phase: 16-application-flow-essentials
plan: 02
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - tests/test_report.py
autonomous: false

must_haves:
  truths:
    - "Tests verify copy buttons exist in generated HTML"
    - "Tests verify data-job-url attributes on job items"
    - "Tests verify Notyf CDN links are included"
    - "Tests verify keyboard shortcut JavaScript is embedded"
    - "Tests verify Copy All Recommended button exists"
    - "Tests verify focus indicators CSS is present"
    - "Human confirms copy actions work in browser"
  artifacts:
    - path: "tests/test_report.py"
      provides: "Test coverage for clipboard UI elements in HTML report"
      contains: "copy-btn"
  key_links:
    - from: "tests/test_report.py"
      to: "job_radar/report.py"
      via: "generate_report() function call"
      pattern: "generate_report"
---

<objective>
Add test coverage for the new clipboard/keyboard features and verify the complete flow in a browser.

Purpose: Ensure the HTML structural changes from Plan 01 are correct and that the end-to-end user experience works as expected in a real browser with file:// protocol.

Output: Updated `tests/test_report.py` with new tests covering copy buttons, data attributes, CDN links, and keyboard shortcut JavaScript.
</objective>

<execution_context>
@/home/corye/.claude/get-shit-done/workflows/execute-plan.md
@/home/corye/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-application-flow-essentials/16-01-SUMMARY.md
@job_radar/report.py
@tests/test_report.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tests for clipboard UI elements in HTML report</name>
  <files>tests/test_report.py</files>
  <action>
Add the following test functions to tests/test_report.py, using the existing fixtures (sample_profile, sample_scored_results, sample_manual_urls):

**test_html_report_contains_copy_buttons:**
- Generate a report with sample data (including jobs with score >= 3.5)
- Read the HTML output
- Assert `copy-btn` class appears in the HTML (individual copy buttons)
- Assert `copy-all-btn` class appears (Copy All Recommended button)
- Assert `Copy URL` or `Copy` text appears in button context
- Assert `Copy All Recommended URLs` text appears

**test_html_report_contains_data_attributes:**
- Generate a report with sample data
- Read the HTML output
- Assert `data-job-url="https://example.com/job/1"` appears (from sample fixture)
- Assert `data-score="4.2"` appears (from sample fixture with score 4.2)
- Assert `tabindex="0"` appears on job items

**test_html_report_contains_notyf_cdn:**
- Generate a report with sample data
- Read the HTML output
- Assert `notyf.min.css` appears in HTML (CSS CDN)
- Assert `notyf.min.js` appears in HTML (JS CDN)

**test_html_report_contains_clipboard_javascript:**
- Generate a report with sample data
- Read the HTML output
- Assert `copyToClipboard` function name appears
- Assert `keydown` event listener appears
- Assert `navigator.clipboard` appears (Clipboard API)
- Assert `execCommand` appears (fallback)

**test_html_report_contains_keyboard_shortcut_hints:**
- Generate a report with sample data (with recommended results)
- Read the HTML output
- Assert keyboard shortcut hint text appears (check for `<kbd>C</kbd>` or `<kbd>A</kbd>`)

**test_html_report_focus_styles:**
- Generate a report with sample data
- Read the HTML output
- Assert `focus-visible` appears in the CSS (focus indicator styles)
- Assert `job-item` class appears in CSS context

**test_html_report_copy_button_absent_when_no_url:**
- Create a scored result where `job.url` is empty string `""`
- Generate a report with that result
- Read HTML output
- Verify that no `data-job-url=""` attribute appears with empty value (empty URLs should not get copy buttons)

**test_html_report_no_copy_all_button_when_no_recommended:**
- Generate report with only low-scored results (all below 3.5) using min_score=2.0
- Read HTML output
- Verify the `copy-all-btn` does NOT appear (no recommended jobs means no Copy All button)

All tests follow existing patterns: use tmp_path fixture, call generate_report(), read the HTML file, assert content.
  </action>
  <verify>
Run `python -m pytest tests/test_report.py -v` -- all tests pass (both old and new).
Run `python -m pytest tests/test_report.py -v --tb=short 2>&1 | tail -5` to see summary.
  </verify>
  <done>
8 new test functions added covering: copy buttons presence, data attributes, Notyf CDN, clipboard JavaScript, keyboard hints, focus styles, empty URL handling, and no-recommended edge case. All tests pass alongside the 9 existing tests.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify clipboard functionality in browser</name>
  <action>Human verifies the complete clipboard copy flow works in a real browser with file:// protocol.</action>
  <verify>Human confirms all 8 verification steps pass.</verify>
  <done>All copy actions (single click, Copy All, C key, A key) work correctly with toast feedback.</done>
  <what-built>
Complete clipboard copy functionality in the HTML job report: individual Copy URL buttons on every job card and table row, Copy All Recommended URLs button, keyboard shortcuts (C = copy focused job, A = copy all recommended), toast notifications via Notyf, and WCAG-friendly focus indicators.
  </what-built>
  <how-to-verify>
1. Generate a fresh report: `python -m job_radar --profile profiles/your_profile.json` (or use an existing HTML report in results/)
2. Open the generated HTML file directly in your browser (file:// protocol)
3. **Test Copy URL button:**
   - Find a job card in the Recommended section -- click "Copy URL" button
   - Verify: toast notification appears saying "Job URL copied to clipboard"
   - Verify: button briefly changes to "Copied!" with green background
   - Paste (Ctrl+V) somewhere to confirm URL was copied
4. **Test table row Copy button:**
   - Scroll to "All Results" table -- click "Copy" button on any row
   - Verify: toast notification appears, URL is in clipboard
5. **Test Copy All Recommended:**
   - Click the "Copy All Recommended URLs" button above the recommended section
   - Verify: toast shows count of URLs copied
   - Paste to confirm multiple URLs separated by newlines
6. **Test keyboard shortcut C:**
   - Click on a job card (or Tab to it) to focus it
   - Press the 'C' key
   - Verify: toast appears confirming copy, URL is in clipboard
7. **Test keyboard shortcut A:**
   - Press the 'A' key (no need to focus anything)
   - Verify: all recommended URLs copied (toast shows count)
8. **Test edge cases:**
   - Press 'C' without focusing any job -- should show error toast "No job focused"
   - Press Ctrl+C on selected text -- should work normally (not intercepted)
   - Tab through job items -- verify visible blue focus outline
  </how-to-verify>
  <resume-signal>Type "approved" if all copy actions work correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. `python -m pytest tests/test_report.py -v` -- all tests pass (17+ tests)
2. `python -m pytest tests/ -v` -- full test suite passes (no regression)
3. Human verified: copy buttons, keyboard shortcuts, and toasts work in browser
</verification>

<success_criteria>
- 8 new tests pass covering all clipboard UI elements
- Full test suite (284+ tests) passes with no regressions
- Human confirms: single-click copy, Copy All, C shortcut, A shortcut, toast feedback all work in a file:// browser context
</success_criteria>

<output>
After completion, create `.planning/phases/16-application-flow-essentials/16-02-SUMMARY.md`
</output>
