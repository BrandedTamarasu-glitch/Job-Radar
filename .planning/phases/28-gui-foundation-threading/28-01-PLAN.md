---
phase: 28-gui-foundation-threading
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - job_radar/gui/__init__.py
  - job_radar/gui/main_window.py
  - job_radar/__main__.py
  - pyproject.toml
  - job-radar.spec
autonomous: true

must_haves:
  truths:
    - "Running with no arguments launches a CustomTkinter GUI window (700x500, system theme)"
    - "Running with CLI flags (e.g. --help, --min-score 3.5) uses existing CLI path without GUI"
    - "First launch (no profile) shows welcome screen with Get Started button"
    - "Returning user (profile exists) sees profile summary in Profile tab as default view"
    - "GUI window has header with app name and tabbed layout (Profile / Search tabs)"
  artifacts:
    - path: "job_radar/gui/__init__.py"
      provides: "GUI package marker"
    - path: "job_radar/gui/main_window.py"
      provides: "CustomTkinter main window with tabs, welcome screen, profile summary"
      min_lines: 100
    - path: "job_radar/__main__.py"
      provides: "Dual-mode entry point detection (CLI vs GUI)"
      contains: "len(sys.argv)"
    - path: "pyproject.toml"
      provides: "customtkinter dependency and GUI entry point"
      contains: "customtkinter"
    - path: "job-radar.spec"
      provides: "PyInstaller spec with CustomTkinter support"
  key_links:
    - from: "job_radar/__main__.py"
      to: "job_radar/gui/main_window.py"
      via: "launch_gui() import when no CLI args"
      pattern: "from job_radar\\.gui\\.main_window import launch_gui"
    - from: "job_radar/__main__.py"
      to: "job_radar/search.py"
      via: "existing CLI path when args present"
      pattern: "len\\(sys\\.argv\\) > 1"
    - from: "job_radar/gui/main_window.py"
      to: "job_radar/profile_manager.py"
      via: "load_profile for profile existence check and summary"
      pattern: "from.*profile_manager import"
---

<objective>
Create the GUI package with CustomTkinter main window, dual-mode entry point detection, and dependency/build configuration updates.

Purpose: Establish the visual shell and entry point routing so that double-clicking the executable opens a GUI window, while CLI flags route to the existing terminal experience.

Output: GUI package with main window (700x500, system theme, header, tabbed layout), welcome screen for first-launch, profile summary for returning users, and modified entry point with CLI/GUI auto-detection.
</objective>

<execution_context>
@/home/corye/.claude/get-shit-done/workflows/execute-plan.md
@/home/corye/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-gui-foundation-threading/28-RESEARCH.md

@job_radar/__main__.py
@job_radar/paths.py
@job_radar/profile_manager.py
@job_radar/profile_display.py
@job_radar/wizard.py
@pyproject.toml
@job-radar.spec
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GUI package with main window shell, welcome screen, and profile summary</name>
  <files>
    job_radar/gui/__init__.py
    job_radar/gui/main_window.py
  </files>
  <action>
Create the `job_radar/gui/` directory with two files:

**`job_radar/gui/__init__.py`** — Empty package marker (just a docstring).

**`job_radar/gui/main_window.py`** — CustomTkinter main window class and `launch_gui()` function.

Implementation details for `main_window.py`:

1. **Imports:** `customtkinter as ctk`, `queue`, `from job_radar.paths import get_data_dir`, `from job_radar.profile_manager import load_profile` (for profile detection), `from job_radar import __version__`.

2. **`MainWindow(ctk.CTk)` class:**
   - `__init__`: Set `ctk.set_appearance_mode("system")` and `ctk.set_default_color_theme("blue")`. Configure window: `self.title("Job Radar")`, `self.geometry("700x500")`, `self.minsize(700, 500)` (resizable with minimum). Use grid layout: row 0 = header (weight=0), row 1 = content (weight=1), column 0 weight=1.
   - **Header frame** (row 0): `CTkFrame` with transparent fg_color. Contains `CTkLabel` with text "Job Radar" and font `CTkFont(size=24, weight="bold")`, packed left. Add version label on right side (smaller font, muted color).
   - **Profile detection**: Call `self._has_profile()` method that checks `(get_data_dir() / "profile.json").exists()`. Store result as `self._profile_exists`.
   - **Content routing**: If no profile → call `self._show_welcome_screen()`. If profile exists → call `self._show_main_tabs()`.

3. **`_show_welcome_screen(self)` method:**
   - Create a `CTkFrame` in row 1, centered content using pack with expand.
   - Title: "Welcome to Job Radar" (CTkFont size=20, weight="bold").
   - Paragraph text: "Job Radar searches multiple job boards, scores each listing against your profile, and generates a ranked report — so you focus on the best matches." Use `CTkLabel` with `wraplength=500`.
   - Second paragraph: "Set up your profile to get started. You'll enter your skills, target titles, and preferences." with wraplength=500.
   - "Get Started" button: `CTkButton` with text "Get Started", height=40, width=200. Command should be a placeholder `self._on_get_started` method that prints "Get Started clicked — profile form coming in Phase 29" to console (stub for Phase 29).

4. **`_show_main_tabs(self)` method:**
   - Create `CTkTabview` in row 1, grid sticky="nsew", padx=20, pady=(0, 20).
   - Add tabs: "Profile" and "Search".
   - Set default tab to "Profile" with `tabview.set("Profile")`.
   - **Profile tab content**: Call `self._build_profile_tab(tabview.tab("Profile"))`.
   - **Search tab content**: Call `self._build_search_tab(tabview.tab("Search"))`.

5. **`_build_profile_tab(self, parent)` method:**
   - Load profile using `load_profile(get_data_dir() / "profile.json")`.
   - Create a scrollable frame inside parent.
   - Display profile summary as key-value pairs using `CTkLabel` widgets:
     - Name (bold header)
     - Target Titles (comma-separated)
     - Core Skills (comma-separated)
     - Secondary Skills (comma-separated, if present)
     - Level / Years Experience
     - Location / Arrangement
     - Dealbreakers (comma-separated, if present)
     - Compensation Floor (formatted as $X,XXX if present)
   - Use grid layout: label column (bold, left-aligned) and value column (left-aligned, wrapping).
   - If profile loading fails, show error text "Could not load profile" with red text color.

6. **`_build_search_tab(self, parent)` method:**
   - Placeholder frame with centered content.
   - "Run Search" button: `CTkButton`, initially disabled (`state="disabled"`) if no profile exists. Store as `self._search_button`.
   - Below the button: `CTkLabel` with text "Profile required to run search" in red/warning color, only visible when profile doesn't exist.
   - If profile exists, button is enabled (normal state), and the warning label is hidden.
   - This tab will be expanded in Plan 02 for threading/progress.

7. **`_has_profile(self) -> bool` method:**
   - `return (get_data_dir() / "profile.json").exists()`

8. **`launch_gui()` module-level function:**
   - Creates `MainWindow()` instance and calls `.mainloop()`.

**Design choices (Claude's discretion):**
- Window is resizable with minimum size 700x500.
- Tab names: "Profile" and "Search" (in that order).
- Use indeterminate progress bar (chosen for Phase 28 mock; determinate will be evaluated in Phase 29 with real source counts).
- Welcome screen uses centered vertical layout.
  </action>
  <verify>
Run `python -c "from job_radar.gui.main_window import MainWindow; print('Import OK')"` to confirm the module imports without errors. Verify that `job_radar/gui/__init__.py` and `job_radar/gui/main_window.py` exist and main_window.py has the MainWindow class and launch_gui function.
  </verify>
  <done>
MainWindow class exists with header, tabbed layout (Profile/Search), welcome screen for first launch, profile summary for returning users, and launch_gui() entry point function. Module imports cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire dual-mode entry point and update build configuration</name>
  <files>
    job_radar/__main__.py
    pyproject.toml
    job-radar.spec
  </files>
  <action>
**1. Modify `job_radar/__main__.py` for dual-mode detection:**

Replace the existing `main()` function with dual-mode logic. Keep `_fix_ssl_for_frozen()` and `_get_profile_name()` unchanged.

New `main()` function:
```python
def main():
    _fix_ssl_for_frozen()

    # CLI mode: any arguments present (--help, --profile, etc.)
    if len(sys.argv) > 1:
        _run_cli()
    else:
        # GUI mode: no arguments (double-click or bare invocation)
        _run_gui()
```

**`_run_cli()` function** — Move all existing `main()` body here (banner, wizard prompt, search_main call, KeyboardInterrupt handling). This preserves the entire existing CLI experience unchanged.

**`_run_gui()` function:**
```python
def _run_gui():
    """Launch the desktop GUI window."""
    try:
        from job_radar.gui.main_window import launch_gui
        launch_gui()
    except ImportError as e:
        print(f"GUI dependencies not available: {e}")
        print("Install with: pip install customtkinter")
        print("Falling back to CLI mode...")
        _run_cli()
    except Exception as e:
        try:
            from job_radar.banner import log_error_and_exit
            log_error_and_exit(f"GUI error: {e}", exception=e)
        except Exception:
            print(f"\nGUI error: {e}")
            sys.exit(1)
```

Key design: ImportError fallback to CLI mode if customtkinter is not installed — graceful degradation.

**2. Update `pyproject.toml`:**

- Add `customtkinter` to the `dependencies` list.
- Add a new entry point for GUI mode: under `[project.scripts]`, add `job-radar-gui = "job_radar.__main__:main"` (the same entry point; the `job-radar` script is used by search.py:main directly, so keep it pointing there for backward compatibility). Actually, keep the existing `job-radar = "job_radar.search:main"` unchanged for CLI direct access. Add `[project.gui-scripts]` section with `job-radar-gui = "job_radar.__main__:main"` — this creates a GUI-specific entry point. NOTE: Actually `[project.gui-scripts]` creates windowless executables on Windows. Use this section.
- Update `[tool.setuptools]` packages to include `job_radar.gui`: change to `packages = ["job_radar", "job_radar.gui"]`.

**3. Update `job-radar.spec` for PyInstaller:**

- Remove `'tkinter'` from the `excludes` list (CustomTkinter needs tkinter).
- Add CustomTkinter hidden imports to `hidden_imports` list:
  ```python
  'customtkinter',
  'customtkinter.windows',
  'customtkinter.windows.widgets',
  ```
- Add CustomTkinter theme data files to `added_files` using a dynamic path lookup:
  ```python
  import customtkinter
  ctk_path = Path(customtkinter.__file__).parent
  added_files.append((str(ctk_path / 'assets'), 'customtkinter/assets'))
  ```
  Wrap in try/except ImportError so the spec file still works if customtkinter isn't installed at build time.
- Keep `console=True` on the existing CLI EXE block.
- Add a second EXE block for the GUI executable:
  ```python
  gui_exe = EXE(
      pyz,
      a.scripts,
      [],
      exclude_binaries=True,
      name='job-radar-gui',
      debug=False,
      bootloader_ignore_signals=False,
      strip=False,
      upx=False,
      console=False,   # No console window for GUI mode
      disable_windowed_traceback=False,
      argv_emulation=False,
      target_arch=None,
      codesign_identity=None,
      entitlements_file=None,
      icon='icon.png' if sys.platform == 'win32' else None,
  )
  ```
  Update the COLLECT block to include both executables: add `gui_exe` alongside `exe`.
  </action>
  <verify>
1. Run `python -m job_radar --help` to confirm CLI mode still works (should print help text, NOT launch GUI).
2. Run `python -c "import job_radar.gui; print('GUI package OK')"` to verify the gui subpackage is importable.
3. Verify `pyproject.toml` contains "customtkinter" in dependencies.
4. Verify `job-radar.spec` no longer excludes tkinter and includes customtkinter in hidden_imports.
  </verify>
  <done>
`__main__.py` routes to GUI when no args present and to existing CLI when args are given. `pyproject.toml` includes customtkinter dependency and GUI entry point. `job-radar.spec` supports both CLI and GUI executables with CustomTkinter bundling.
  </done>
</task>

</tasks>

<verification>
1. `python -m job_radar --help` — prints CLI help, no GUI window opens
2. `python -c "from job_radar.gui.main_window import MainWindow, launch_gui; print('OK')"` — imports successfully
3. `grep "customtkinter" pyproject.toml` — dependency present
4. `grep -v "tkinter" job-radar.spec | grep -c "exclude"` — tkinter not in excludes
5. `python -c "import sys; sys.argv = ['test']; from job_radar.__main__ import main"` — no errors on import
</verification>

<success_criteria>
- GUI package exists at job_radar/gui/ with __init__.py and main_window.py
- MainWindow class renders 700x500 window with system theme, header, and Profile/Search tabs
- Welcome screen appears when no profile.json exists
- Profile summary appears in Profile tab when profile.json exists
- Entry point detection: len(sys.argv) > 1 routes to CLI, else to GUI
- pyproject.toml has customtkinter dependency
- PyInstaller spec has separate CLI (console=True) and GUI (console=False) executables
</success_criteria>

<output>
After completion, create `.planning/phases/28-gui-foundation-threading/28-01-SUMMARY.md`
</output>
