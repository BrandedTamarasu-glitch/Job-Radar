---
phase: 15-pdf-resume-parser
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - job_radar/pdf_parser.py
  - pyproject.toml
  - job-radar.spec
autonomous: true

must_haves:
  truths:
    - "PDF validation rejects image-only PDFs with actionable error message"
    - "PDF validation rejects encrypted PDFs with actionable error message"
    - "PDF validation rejects files over 5 MB with actionable error message"
    - "PDF validation rejects corrupted PDFs with actionable error message"
    - "extract_resume_data returns dict with name, years_experience, titles, skills from valid resume PDF"
    - "Missing pdfplumber gracefully sets PDF_SUPPORT=False without crashing"
    - "Non-ASCII characters in names display correctly (UTF-8 encoding works)"
  artifacts:
    - path: "job_radar/pdf_parser.py"
      provides: "PDF validation and resume field extraction"
      exports: ["PDFValidationError", "PDF_SUPPORT", "validate_pdf_file", "extract_resume_data"]
    - path: "pyproject.toml"
      provides: "pdfplumber and python-dateutil dependencies"
      contains: "pdfplumber"
    - path: "job-radar.spec"
      provides: "PyInstaller hidden imports for pdfplumber"
      contains: "pdfplumber"
  key_links:
    - from: "job_radar/pdf_parser.py"
      to: "pdfplumber"
      via: "conditional import with PDF_SUPPORT flag"
      pattern: "import pdfplumber"
    - from: "job_radar/pdf_parser.py"
      to: "dateutil.parser"
      via: "fuzzy date parsing for years of experience calculation"
      pattern: "dateutil_parser.parse"
---

<objective>
Create the core PDF resume parser module with validation and field extraction functions, plus dependency configuration updates.

Purpose: Provides the extraction engine that wizard.py will consume in Plan 02. Isolates all PDF/parsing logic in its own module for clean separation of concerns.
Output: New job_radar/pdf_parser.py module, updated pyproject.toml with new dependencies, updated job-radar.spec with pdfplumber hidden imports.
</objective>

<execution_context>
@/Users/coryebert/.claude/get-shit-done/workflows/execute-plan.md
@/Users/coryebert/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-pdf-resume-parser/15-CONTEXT.md
@.planning/phases/15-pdf-resume-parser/15-RESEARCH.md
@pyproject.toml
@job-radar.spec
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pdf_parser.py module with validation and extraction</name>
  <files>job_radar/pdf_parser.py</files>
  <action>
Create new file `job_radar/pdf_parser.py` implementing the PDF resume parser module. Follow the patterns from 15-RESEARCH.md Pattern 1 closely.

**Module structure:**

1. **Conditional import** at module level:
   ```python
   try:
       import pdfplumber
       PDF_SUPPORT = True
   except ImportError:
       PDF_SUPPORT = False
   ```
   This ensures wizard can still load when pdfplumber is not installed.

2. **PDFValidationError** exception class for all validation failures.

3. **validate_pdf_file(pdf_path: Path) -> None** function:
   - Check PDF_SUPPORT is True (raise PDFValidationError if not)
   - Check file exists
   - Check .pdf extension (case-insensitive)
   - Check file size <= 5 MB (per CONTEXT.md locked decision)
   - Open with `pdfplumber.open(pdf_path, strict_metadata=False)`
   - Check pages > 0
   - Check first page extract_text() returns non-empty string (per CONTEXT.md: "text-extractable" = extract_text() returns non-empty)
   - Catch `pdfplumber.pdfminer.pdfdocument.PDFPasswordIncorrect` -> "This PDF is password-protected..."
   - Catch `pdfplumber.pdfminer.pdfparser.PDFSyntaxError` -> "Unable to read PDF file. The file may be corrupted..."
   - Catch generic Exception -> "Unable to read PDF file: {str(e)}..."
   - Error messages MUST match CONTEXT.md locked decisions exactly

4. **extract_resume_data(pdf_path: str | Path) -> dict** function:
   - Convert to Path, call validate_pdf_file
   - Extract text from ALL pages using `pdfplumber.open(pdf_path, unicode_norm='NFKC')` for UTF-8 normalization (PDF-07)
   - Call private extraction functions, build result dict
   - Only include keys where extraction succeeded (partial success is OK per CONTEXT.md)
   - Return empty dict if ALL extractions fail

5. **_extract_name(text: str) -> str | None**:
   - Scan first 5 lines of text
   - Skip lines with contact info (email patterns @/.com/.edu, phone patterns, URLs, linkedin/phone/tel/email keywords)
   - Skip lines that are all caps AND longer than 20 chars (section headers)
   - Match lines with 2-5 words where each word starts with uppercase (allow lowercase particles: von, van, de, la)
   - Return first match or None

6. **_extract_years_experience(text: str) -> int | None**:
   - Strategy 1: Look for explicit "X years of experience" pattern (regex from RESEARCH.md)
   - Strategy 2: Calculate from work history date ranges
     - Find experience section using header patterns (work experience, employment history, professional experience)
     - Extract date ranges using regex (Month YYYY - Month YYYY, YYYY-YYYY formats)
     - Parse dates with `dateutil.parser.parse(fuzzy=True)`
     - Handle "Present"/"Current" as datetime.now()
     - Sum months across all date ranges, divide by 12, round
   - Return int or None

7. **_extract_job_titles(text: str) -> list[str] | None**:
   - Find experience section using same header patterns
   - Scan first 20 lines of section for title keywords (engineer, developer, architect, manager, analyst, designer, consultant, specialist, lead, senior, junior, principal, staff, director, coordinator)
   - Filter out company name lines (inc, llc, corp, ltd, company)
   - Clean titles: remove date ranges, pipe separators
   - Max 3 titles, each under 80 chars
   - Return list or None

8. **_extract_skills(text: str) -> list[str] | None**:
   - Find skills section using header patterns (skills, core competencies, technologies, tools and technologies)
   - Stop at next major section header (experience, education, projects, certifications)
   - Parse comma/bullet/pipe-separated skills from section text
   - Filter: skip items > 50 chars, skip items with preamble phrases ("include", "such as", "proficient in")
   - Keep items with 1-5 words
   - Max 20 skills
   - Return list or None
  </action>
  <verify>
Run: `python -c "from job_radar.pdf_parser import PDF_SUPPORT, PDFValidationError, validate_pdf_file, extract_resume_data; print('PDF_SUPPORT:', PDF_SUPPORT); print('Imports OK')"` — should print PDF_SUPPORT: True (or False if pdfplumber not yet installed) and no import errors.
  </verify>
  <done>
pdf_parser.py exists with PDFValidationError, PDF_SUPPORT flag, validate_pdf_file(), extract_resume_data(), and four private extraction functions (_extract_name, _extract_years_experience, _extract_job_titles, _extract_skills). All functions have docstrings and handle errors gracefully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update dependencies and PyInstaller configuration</name>
  <files>pyproject.toml, job-radar.spec</files>
  <action>
**pyproject.toml changes:**

Add pdfplumber and python-dateutil to the dependencies list:
```toml
dependencies = ["requests", "beautifulsoup4", "platformdirs>=4.0", "pyfiglet", "colorama", "certifi", "questionary", "python-dotenv", "pyrate-limiter", "rapidfuzz", "pdfplumber>=0.11.9", "python-dateutil>=2.9.0"]
```

Then run `pip install -e .` to install the new dependencies.

**job-radar.spec changes:**

Add pdfplumber and its transitive dependencies to the hidden_imports list. Add these entries after the existing transitive dependencies block:
```python
    # PDF parsing (Phase 15)
    'pdfplumber',
    'pdfminer',
    'pdfminer.high_level',
    'pdfminer.layout',
    'pdfminer.pdfparser',
    'pdfminer.pdfdocument',
    'pdfminer.pdfpage',
    'pdfminer.pdfinterp',
    'pdfminer.converter',
    'pdfminer.cmapdb',
    'pdfminer.psparser',
    'pdfminer.pdftypes',
    'pdfminer.utils',
    'dateutil',
    'dateutil.parser',
```

Also remove 'PIL' from the excludes list since Pillow is already a build dependency and pdfplumber may use it for debugging (it's in optional-dependencies already). Keep 'PIL' in excludes ONLY if you verify pdfplumber doesn't need it at runtime — pdfplumber uses it only for `.to_image()` which we don't call, so keeping 'PIL' in excludes is fine.
  </action>
  <verify>
Run: `pip install -e . && python -c "import pdfplumber; import dateutil; print('pdfplumber:', pdfplumber.__version__); print('dateutil OK')"` — both imports succeed.
Verify spec file: `grep -c 'pdfplumber' job-radar.spec` returns at least 1.
  </verify>
  <done>
pyproject.toml includes pdfplumber>=0.11.9 and python-dateutil>=2.9.0. job-radar.spec hidden_imports includes pdfplumber, pdfminer submodules, and dateutil. Dependencies install successfully.
  </done>
</task>

</tasks>

<verification>
1. `python -c "from job_radar.pdf_parser import PDF_SUPPORT, extract_resume_data; print(PDF_SUPPORT)"` prints True
2. `python -c "import pdfplumber; print(pdfplumber.__version__)"` prints version >= 0.11.9
3. `grep 'pdfplumber' pyproject.toml` shows dependency entry
4. `grep 'pdfplumber' job-radar.spec` shows hidden import entry
5. `grep 'python-dateutil' pyproject.toml` shows dependency entry
</verification>

<success_criteria>
- pdf_parser.py module exists with all public exports (PDFValidationError, PDF_SUPPORT, validate_pdf_file, extract_resume_data)
- Four private extraction functions handle name, years, titles, skills
- Conditional import prevents crash when pdfplumber not installed
- Validation checks: file exists, .pdf extension, 5 MB limit, text-extractable, not encrypted, not corrupted
- Error messages match CONTEXT.md locked decisions
- Unicode normalization with NFKC for international name support
- Dependencies added to pyproject.toml and job-radar.spec
</success_criteria>

<output>
After completion, create `.planning/phases/15-pdf-resume-parser/15-01-SUMMARY.md`
</output>
