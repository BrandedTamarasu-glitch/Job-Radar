# Milestone v2.1.0: Source Expansion & Polish

**Status:** ✅ SHIPPED 2026-02-14
**Phases:** 31-37
**Total Plans:** 18

## Overview

Expand automated job source coverage, give users control over staffing firm scoring, and provide clean uninstall experiences across platforms.

**Target features:**
- Job aggregator API integration (JSearch/SerpAPI) pulling from LinkedIn, Indeed, Glassdoor, and company career pages
- Additional free job board integrations (Jobicy, USAJobs, etc.)
- Better staffing firm filtering with user-configurable scoring preference (boost/neutral/penalize)
- GUI uninstall button that removes app + all config/data/cache
- Platform-native packaging: macOS DMG installer, Windows NSIS installer with Add/Remove Programs
- Tiered source approach: works great without API keys, optional freemium APIs for more volume

## Phases

### Phase 31: Rate Limiter Infrastructure
**Goal:** Fix rate limiter connection leaks and establish shared backend API management before adding new sources

**Dependencies:** None (foundation work)

**Requirements:** INFRA-01, INFRA-02, INFRA-03

**Plans:** 2 plans

Plans:
- [x] 31-01-PLAN.md — Add atexit cleanup and shared backend API rate limiters
- [x] 31-02-PLAN.md — Load rate limit configs from config.json

**Success Criteria:**
1. Rate limiter SQLite connections are cleaned up on app exit with atexit handler
2. Sources sharing the same backend API use a single shared rate limiter instance
3. Rate limit configurations are loaded from config.json instead of hardcoded values
4. Application exits without "database is locked" errors after running searches

---

### Phase 32: Job Aggregator APIs (JSearch, USAJobs)
**Goal:** Users can receive job listings from major aggregator APIs covering LinkedIn, Indeed, Glassdoor, and federal jobs

**Dependencies:** Phase 31 (requires rate limiter infrastructure)

**Requirements:** SRC-01, SRC-02, SRC-05, SRC-06, SRC-08

**Plans:** 4 plans

Plans:
- [x] 32-01-PLAN.md — JSearch + USAJobs fetch functions, response mapping, rate limiter config
- [x] 32-02-PLAN.md — API setup wizard extension + profile schema (federal fields)
- [x] 32-03-PLAN.md — Search pipeline integration (query builder, fetch_all, dedup enhancements)
- [x] 32-04-PLAN.md — GUI API key settings + comprehensive tests

**Success Criteria:**
1. Users can run searches that return results from JSearch API (LinkedIn, Indeed, Glassdoor aggregation)
2. Users can run searches that return results from USAJobs API for federal government jobs
3. Each job listing displays its original source attribution (e.g., "via LinkedIn", "via USAJobs")
4. Duplicate jobs are automatically removed based on exact URL/job ID matching
5. Users can configure API keys for new sources via CLI setup wizard

---

### Phase 33: Scoring Configuration Backend
**Goal:** Profile schema supports user-customizable scoring weights with backward-compatible migration

**Dependencies:** None (backend change independent of sources)

**Requirements:** SCORE-03

**Plans:** 3 plans

Plans:
- [x] 33-01-PLAN.md — Profile schema v2 migration with scoring weights and validation (TDD)
- [x] 33-02-PLAN.md — Scoring engine configurable weights and staffing preference (TDD)
- [x] 33-03-PLAN.md — Wizard integration for v2 profile fields

**Success Criteria:**
1. Existing v1 profiles automatically migrate to v2 schema on first load without data loss
2. Profile schema v2 includes scoring_weights (6 floats summing to 1.0) and staffing_preference (boost/neutral/penalize)
3. Scoring engine uses profile-defined weights instead of hardcoded values
4. Staffing firm jobs receive boost, neutral, or penalty based on user preference
5. Wizard prompts new users for staffing preference and scoring customization option

---

### Phase 34: GUI Scoring Configuration
**Goal:** Users can customize scoring weights and staffing firm preference through GUI controls

**Dependencies:** Phase 33 (requires v2 profile schema and backend scoring changes)

**Requirements:** SCORE-01, SCORE-02, SCORE-04, SCORE-05

**Plans:** 2 plans

Plans:
- [x] 34-01-PLAN.md — ScoringConfigWidget with sliders, dropdown, live preview, and collapsible section
- [x] 34-02-PLAN.md — Settings tab integration and comprehensive tests

**Success Criteria:**
1. Settings tab displays collapsible Scoring Configuration section with 6 weight sliders and staffing preference dropdown
2. Live preview shows sample job score breakdown with weighted components updating in real-time
3. Normalize button adjusts all weights proportionally to sum to 1.0
4. Reset button restores all sliders and dropdown to default values
5. Invalid weight sum shows inline warning (orange text, non-blocking)

---

### Phase 35: Additional API Sources (SerpAPI, Jobicy)
**Goal:** Expand source coverage with alternative aggregator and remote-focused job boards

**Dependencies:** Phases 31, 32 (rate limiter infrastructure, API setup patterns)

**Requirements:** SRC-03, SRC-04, SRC-07

**Plans:** 2 plans

Plans:
- [x] 35-01-PLAN.md — SerpAPI + Jobicy backend: fetch functions, mappers, rate limiter config, search pipeline integration, quota tracking utility
- [x] 35-02-PLAN.md — CLI wizard extension, GUI Settings tab (API sections, test buttons, quota display), comprehensive tests

**Success Criteria:**
1. Users can receive job results from SerpAPI Google Jobs as alternative to JSearch
2. Users can receive job results from Jobicy remote-focused listings
3. GUI displays API quota usage for rate-limited sources (e.g., "15/100 daily searches used")
4. Quota display updates after each search showing current usage vs limit
5. Quota labels turn orange when usage exceeds 80% of limit

---

### Phase 36: GUI Uninstall Feature
**Goal:** Users can cleanly uninstall Job Radar with all config, cache, and data removed

**Dependencies:** None (self-contained feature)

**Requirements:** PKG-01, PKG-02, PKG-03, PKG-06

**Plans:** 2 plans

Plans:
- [x] 36-01-PLAN.md — Core uninstaller backend: backup, deletion, path enumeration, platform-specific cleanup scripts
- [x] 36-02-PLAN.md — GUI uninstall dialogs, Settings tab integration, orchestration flow, integration tests

**Success Criteria:**
1. Users can click "Uninstall" button in GUI Settings tab to remove all app data
2. Uninstall shows confirmation dialog listing exact paths that will be deleted before proceeding
3. Users can create a backup ZIP of profile and config before uninstalling
4. Uninstall works while app is running using two-stage cleanup (delete data now, schedule binary deletion after exit)

---

### Phase 37: Platform-Native Installers
**Goal:** Deliver professional installer experiences for macOS and Windows users

**Dependencies:** Phases 31-36 complete (all features ready for packaging)

**Requirements:** PKG-04, PKG-05

**Plans:** 3 plans

Plans:
- [x] 37-01-PLAN.md — macOS DMG installer with custom background, drag-to-Applications, and .jobprofile file association
- [x] 37-02-PLAN.md — Windows NSIS installer with Modern UI wizard, shortcuts, Add/Remove Programs, and .jobprofile file association
- [x] 37-03-PLAN.md — CI/CD integration, installer README with bypass instructions, and auto-update config infrastructure

**Success Criteria:**
1. macOS users receive a DMG installer with drag-to-Applications folder workflow
2. Windows users receive an NSIS .exe installer with setup wizard and Add/Remove Programs integration
3. Both installers prepared for future code signing (conditional build scripts)
4. CI/CD automated installer builds on GitHub Actions
5. Windows installer creates Start Menu shortcuts and desktop icon (optional)

---

## Milestone Summary

**Key Decisions:**
- Clear limiters before closing connections to prevent segmentation faults from background threads
- BACKEND_API_MAP fallback to source name for backward compatibility
- JSearch source attribution from job_publisher field for accurate source display
- All JSearch sources (linkedin/indeed/glassdoor/jsearch_other) share single rate limiter
- Profile schema v2 with automatic migration (v0→v2, v1→v2) and backup creation
- DEFAULT_SCORING_WEIGHTS matches hardcoded scoring.py to preserve score stability during migration
- Default staffing_preference is 'neutral' (clean slate for users to configure)
- Triple-fallback for scoring weights (profile → defaults → hardcoded .get())
- Staffing preference is post-scoring adjustment to avoid normalization issues
- Proportional normalization preserves relative weight ratios
- SerpAPI conservative 50/min rate limit (free tier has 100 searches/month cap)
- Jobicy 1/hour rate limit per API documentation
- get_quota_usage() queries SQLite bucket directly for real-time quota display
- Best-effort deletion with error collection (continue on failures, return list of errors)
- macOS .app bundle resolution for Trash (walk path upward to find .app directory)
- Cleanup SQLite connections before deletion to prevent "database is locked" errors
- DMG window size 800x500 for better visibility on modern displays
- Conditional code signing for both DMG and NSIS (check env vars, skip if not set)
- Pillow-generated DMG backgrounds and NSIS assets for consistent branding
- .jobprofile file association via CFBundleDocumentTypes (macOS) and registry + SHChangeNotify (Windows)
- NSIS Modern UI 2 for professional wizard UX
- Dual uninstall approach: UninstallString launches GUI with backup, QuietUninstallString uses NSIS silent remove
- icon.ico for NSIS (not PNG) - generate-assets.py converts with multi-size ICO

**Issues Resolved:**
- Fixed "database is locked" errors from unclosed rate limiter connections on app exit
- Implemented shared rate limiters to prevent API quota violations across JSearch display sources
- Resolved score stability concerns during migration with DEFAULT_SCORING_WEIGHTS matching hardcoded values
- Fixed potential double-boost bug by centralizing staffing firm handling in score_job()
- Implemented graceful fallback for corrupted scoring_weights to prevent crashes
- Fixed Gatekeeper/SmartScreen bypass with clear README instructions for unsigned installers

**Issues Deferred:**
- Code signing certificates ($100-400/year per platform) - deferred; conditional infrastructure ready
- Linux DEB/RPM packaging - .tar.gz acceptable for Linux users, focus macOS/Windows first
- Auto-update GUI notification - infrastructure prepared (update_config.py), feature deferred to future phase
- Live score recalculation on slider drag - performance risk with thousands of jobs, use Apply button pattern

**Technical Debt Incurred:**
- None - all features delivered cleanly with comprehensive test coverage

---

_For current project status, see .planning/PROJECT.md_
_For next milestone, see .planning/ROADMAP.md (created by /gsd:new-milestone)_
